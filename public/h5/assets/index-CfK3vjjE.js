import{c as $,f as P,au as fe,bz as z,d as J,aq as N,bA as V,n as Y,r as E,bB as ve,k as p,j as oe,a4 as ae,ab as he,al as le,b as d,aJ as ce,aG as Z,t as ie,m as _,u as be,ak as ge,V as j,R as Oe,aD as Q,p as Te,a2 as pe,bC as ke,Z as W,bD as L,w as ye}from"./index-0ixFw3OK.js";const[Ce,O,X]=$("picker"),se=e=>e.find(a=>!a.disabled)||e[0];function xe(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function B(e,a){a=z(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ee=(e,a,n)=>a!==void 0&&!!e.find(s=>s[n.value]===a);function G(e,a,n){const s=e.findIndex(f=>f[n.value]===a),c=B(e,s);return e[c]}function we(e,a,n){const s=[];let c={[a.children]:e},f=0;for(;c&&c[a.children];){const v=c[a.children],h=n.value[f];if(c=fe(h)?G(v,h,a):void 0,!c&&v.length){const u=se(v)[a.value];c=G(v,u,a)}f++,s.push(v)}return s}function Ee(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Pe(e){return P({text:"text",value:"value",children:"children"},e)}const te=200,ne=300,Se=15,[ue,q]=$("picker-column"),re=Symbol(ue);var Ie=J({name:ue,props:{value:Y,fields:N(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(Y),visibleOptionNum:N(Y)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let s,c,f,v,h;const u=E(),b=E(),r=E(0),m=E(0),k=ve(),C=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=i=>{let t=B(e.options,i);const o=-t*e.optionHeight,l=()=>{t>C()-1&&(t=B(e.options,i));const T=e.options[t][e.fields.value];T!==e.value&&a("change",T)};s&&o!==r.value?h=l:l(),r.value=o},g=()=>e.readonly||!e.options.length,A=i=>{s||g()||(h=null,m.value=te,y(i),a("clickOption",e.options[i]))},x=i=>z(Math.round(-i/e.optionHeight),0,C()-1),M=p(()=>x(r.value)),F=(i,t)=>{const o=Math.abs(i/t);i=r.value+o/.003*(i<0?-1:1);const l=x(i);m.value=+e.swipeDuration,y(l)},S=()=>{s=!1,m.value=0,h&&(h(),h=null)},K=i=>{if(!g()){if(k.start(i),s){const t=Ee(b.value);r.value=Math.min(0,t-H())}m.value=0,c=r.value,f=Date.now(),v=c,h=null}},U=i=>{if(g())return;k.move(i),k.isVertical()&&(s=!0,ce(i,!0));const t=z(c+k.deltaY.value,-(C()*e.optionHeight),e.optionHeight),o=x(t);o!==M.value&&a("scrollInto",e.options[o]),r.value=t;const l=Date.now();l-f>ne&&(f=l,v=t)},I=()=>{if(g())return;const i=r.value-v,t=Date.now()-f;if(t<ne&&Math.abs(i)>Se){F(i,t);return}const l=x(r.value);m.value=te,y(l),setTimeout(()=>{s=!1},0)},w=()=>{const i={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const l=t[e.fields.text],{disabled:T}=t,D=t[e.fields.value],de={role:"button",style:i,tabindex:T?-1:0,class:[q("item",{disabled:T,selected:D===e.value}),t.className],onClick:()=>A(o)},me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return d("li",de,[n.option?n.option(t,o):d("div",me,null)])})};return oe(re),ae({stopMomentum:S}),he(()=>{const i=s?Math.floor(-r.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=B(e.options,i),o=-t*e.optionHeight;s&&t<i&&S(),r.value=o}),le("touchmove",U,{target:u}),()=>d("div",{ref:u,class:q(),onTouchstartPassive:K,onTouchend:I,onTouchcancel:I},[d("ul",{ref:b,style:{transform:`translate3d(0, ${r.value+H()}px, 0)`,transitionDuration:`${m.value}ms`,transitionProperty:m.value?"all":"none"},class:q("wrapper"),onTransitionend:S},[w()])])}});const[De]=$("picker-toolbar"),R={title:String,cancelButtonText:String,confirmButtonText:String},He=["cancel","confirm","title","toolbar"],Me=Object.keys(R);var Ne=J({name:De,props:R,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const s=()=>{if(n.title)return n.title();if(e.title)return d("div",{class:[O("title"),"van-ellipsis"]},[e.title])},c=()=>a("cancel"),f=()=>a("confirm"),v=()=>{var u;const b=(u=e.cancelButtonText)!=null?u:X("cancel");if(!(!n.cancel&&!b))return d("button",{type:"button",class:[O("cancel"),Z],onClick:c},[n.cancel?n.cancel():b])},h=()=>{var u;const b=(u=e.confirmButtonText)!=null?u:X("confirm");if(!(!n.confirm&&!b))return d("button",{type:"button",class:[O("confirm"),Z],onClick:f},[n.confirm?n.confirm():b])};return()=>d("div",{class:O("toolbar")},[n.toolbar?n.toolbar():[v(),s(),h()]])}});const[_e,Fe]=$("picker-group"),Be=Symbol(_e);P({tabs:V(),activeTab:_(0),nextStepText:String,showToolbar:ie},R);const Ve=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:_(44),showToolbar:ie,swipeDuration:_(1e3),visibleOptionNum:_(6)},R),$e=P({},Ve,{columns:V(),modelValue:V(),toolbarPosition:pe("top"),columnsFieldNames:Object});var Re=J({name:Ce,props:$e,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const s=E(),c=E(e.modelValue.slice(0)),{parent:f}=oe(Be),{children:v,linkChildren:h}=be(re);h();const u=p(()=>Pe(e.columnsFieldNames)),b=p(()=>ge(e.optionHeight)),r=p(()=>xe(e.columns,u.value)),m=p(()=>{const{columns:t}=e;switch(r.value){case"multiple":return t;case"cascade":return we(t,u.value,c);default:return[t]}}),k=p(()=>m.value.some(t=>t.length)),C=p(()=>m.value.map((t,o)=>G(t,c.value[o],u.value))),H=p(()=>m.value.map((t,o)=>t.findIndex(l=>l[u.value.value]===c.value[o]))),y=(t,o)=>{if(c.value[t]!==o){const l=c.value.slice(0);l[t]=o,c.value=l}},g=()=>({selectedValues:c.value.slice(0),selectedOptions:C.value,selectedIndexes:H.value}),A=(t,o)=>{y(o,t),r.value==="cascade"&&c.value.forEach((l,T)=>{const D=m.value[T];ee(D,l,u.value)||y(T,D.length?D[0][u.value.value]:void 0)}),W(()=>{a("change",P({columnIndex:o},g()))})},x=(t,o)=>{const l={columnIndex:o,currentOption:t};a("clickOption",P(g(),l)),a("scrollInto",l)},M=()=>{v.forEach(o=>o.stopMomentum());const t=g();return W(()=>{a("confirm",t)}),t},F=()=>a("cancel",g()),S=()=>m.value.map((t,o)=>d(Ie,{value:c.value[o],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>A(l,o),onClickOption:l=>x(l,o),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:o})}},{option:n.option})),K=t=>{if(k.value){const o={height:`${b.value}px`},l={backgroundSize:`100% ${(t-b.value)/2}px`};return[d("div",{class:O("mask"),style:l},null),d("div",{class:[ke,O("frame")],style:o},null)]}},U=()=>{const t=b.value*+e.visibleOptionNum,o={height:`${t}px`};return!e.loading&&!k.value&&n.empty?n.empty():d("div",{ref:s,class:O("columns"),style:o},[S(),K(t)])},I=()=>{if(e.showToolbar&&!f)return d(Ne,Te(Q(e,Me),{onConfirm:M,onCancel:F}),Q(n,He))};j(m,t=>{t.forEach((o,l)=>{o.length&&!ee(o,c.value[l],u.value)&&y(l,se(o)[u.value.value])})},{immediate:!0});let w;return j(()=>e.modelValue,t=>{!L(t,c.value)&&!L(t,w)&&(c.value=t.slice(0),w=t.slice(0))},{deep:!0}),j(c,t=>{L(t,e.modelValue)||(w=t.slice(0),a("update:modelValue",w))},{immediate:!0}),le("touchmove",ce,{target:s}),ae({confirm:M,getSelectedOptions:()=>C.value}),()=>{var t,o;return d("div",{class:O()},[e.toolbarPosition==="top"?I():null,e.loading?d(Oe,{class:O("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),U(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?I():null])}}});const Ke=ye(Re);export{Ke as P};
