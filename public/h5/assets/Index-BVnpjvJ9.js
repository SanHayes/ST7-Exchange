import{a0 as De,_ as Ae,r as pt,S as Cr,V as Ir,T as we,a6 as Ei,y as ht,O as Z,b as L,A as j,K as ke,L as wt,D as A,I as Er,C as me,a4 as Fe,R as Pr,F as qt,G as q,M as Mr,v as Tr,k as Xt,a1 as Dr,H as Ce,J as Wt,P as Ar,Q as kr,z as Ze,N as Fr,a3 as Pi,s as Mi,a2 as Oe,a5 as Ti}from"./index-Bls5mtmE.js";import{C as Di}from"./index-BBW8XlNN.js";import{C as qe}from"./index-Hmp-CFtI.js";import{T as Ke}from"./index-Dayh3QWa.js";/* empty css              *//* empty css              */import{q as Ai}from"./index-B0SiQixH.js";import{g as ki,a as Se,s as Fi}from"./utils-CyM-aEEW.js";import{u as Rr,a as Br,T as Lr}from"./scoket-TaALm7Rk.js";import{P as Vr}from"./index-z91L0MRP.js";import{I as Or}from"./index-B_FiYP0r.js";import{S as Nr}from"./index-DFfPZxq9.js";import{S as Ri}from"./index-CGY8F_Xo.js";import{F as zr}from"./index-C9Lc3JeH.js";import{S as Bi}from"./index-B2zSwaWp.js";import"./use-id-BTy8-xBR.js";import"./use-tab-status-N_WBKlA4.js";import"./index-DBaB10GK.js";import"./_commonjsHelpers-C932wzq6.js";/**
     * @license
     * KLineChart v9.8.12
     * Copyright (c) 2019 lihu.
     * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
     */var He=function(i,e){return He=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},He(i,e)};function N(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");He(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var B=function(){return B=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},B.apply(this,arguments)};function ne(i,e,t,r){function n(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function o(c){try{u(r.next(c))}catch(h){s(h)}}function l(c){try{u(r.throw(c))}catch(h){s(h)}}function u(c){c.done?a(c.value):n(c.value).then(o,l)}u((r=r.apply(i,[])).next())})}function ae(i,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,n,a,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(t=0)),t;)try{if(r=1,n&&(a=u[0]&2?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){t.label=u[1];break}if(u[0]===6&&t.label<a[1]){t.label=a[1],a=u;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(u);break}a[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(c){u=[6,c],n=0}finally{r=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Jt(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ee(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,a=[],s;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(o){s={error:o}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return a}function Wr(i,e,t){if(arguments.length===2)for(var r=0,n=e.length,a;r<n;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return i.concat(a||Array.prototype.slice.call(e))}var G;(function(i){i.Dashed="dashed",i.Solid="solid"})(G||(G={}));var X;(function(i){i.Stroke="stroke",i.Fill="fill",i.StrokeFill="stroke_fill"})(X||(X={}));var le;(function(i){i.Always="always",i.FollowCross="follow_cross",i.None="none"})(le||(le={}));var Mt;(function(i){i.Standard="standard",i.Rect="rect"})(Mt||(Mt={}));var pe;(function(i){i.Left="left",i.Middle="middle",i.Right="right"})(pe||(pe={}));var Ie;(function(i){i.Fixed="fixed",i.Pointer="pointer"})(Ie||(Ie={}));var gt;(function(i){i.CandleSolid="candle_solid",i.CandleStroke="candle_stroke",i.CandleUpStroke="candle_up_stroke",i.CandleDownStroke="candle_down_stroke",i.Ohlc="ohlc",i.Area="area"})(gt||(gt={}));var Ht;(function(i){i.Left="left",i.Right="right"})(Ht||(Ht={}));var at;(function(i){i.Normal="normal",i.Percentage="percentage",i.Log="log"})(at||(at={}));var xe="#F92855",Ne="rgba(249, 40, 85, .7)",be="#2DC08E",ze="rgba(45, 192, 142, .7)",Zt="#888888",Re="#FFFFFF",ct="#1677FF",Kt="#76808F",Ge="#DDDDDD";function oe(i){return"rgba(22, 119, 255, ".concat(i,")")}function Li(){function i(){return{show:!0,size:1,color:"#EDEDED",style:G.Dashed,dashedValue:[2,2]}}return{show:!0,horizontal:i(),vertical:i()}}function Vi(){var i={show:!0,color:Kt,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:gt.CandleSolid,bar:{upColor:be,downColor:xe,noChangeColor:Zt,upBorderColor:be,downBorderColor:xe,noChangeBorderColor:Zt,upWickColor:be,downWickColor:xe,noChangeWickColor:Zt},area:{lineSize:2,lineColor:ct,smooth:!1,value:"close",backgroundColor:[{offset:0,color:oe(.01)},{offset:1,color:oe(.2)}],point:{show:!0,color:ct,radius:4,rippleColor:oe(.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:B({},i),low:B({},i),last:{show:!0,upColor:be,downColor:xe,noChangeColor:Zt,line:{show:!0,style:G.Dashed,dashedValue:[4,4],size:1},text:{show:!0,style:X.Fill,size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:G.Solid,borderSize:0,borderDashedValue:[2,2],color:Re,family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:le.Always,showType:Mt.Standard,custom:[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}],defaultValue:"n/a",rect:{position:Ie.Fixed,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:Kt,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},icons:[]}}}function Oi(){var i=["#FF9600","#935EBD",ct,"#E11D74","#01C5C4"].map(function(e){return{style:G.Solid,smooth:!1,size:1,dashedValue:[2,2],color:e}});return{ohlc:{upColor:ze,downColor:Ne,noChangeColor:Zt},bars:[{style:X.Fill,borderStyle:G.Solid,borderSize:1,borderDashedValue:[2,2],upColor:ze,downColor:Ne,noChangeColor:Zt}],lines:i,circles:[{style:X.Fill,borderStyle:G.Solid,borderSize:1,borderDashedValue:[2,2],upColor:ze,downColor:Ne,noChangeColor:Zt}],lastValueMark:{show:!1,text:{show:!1,style:X.Fill,color:Re,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:G.Solid,borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:le.Always,showType:Mt.Standard,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:Kt,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},icons:[]}}}function Xr(){return{show:!0,size:"auto",axisLine:{show:!0,color:Ge,size:1},tickText:{show:!0,color:Kt,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:Ge}}}function Ni(){var i=Xr();return i.type=at.Normal,i.position=Ht.Right,i.inside=!1,i.reverse=!1,i}function zi(){function i(){return{show:!0,line:{show:!0,style:G.Dashed,dashedValue:[4,2],size:1,color:Kt},text:{show:!0,style:X.Fill,color:Re,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:G.Solid,borderDashedValue:[2,2],borderSize:1,borderColor:Kt,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:Kt}}}return{show:!0,horizontal:i(),vertical:i()}}function Wi(){var i=oe(.35),e=oe(.25);function t(){return{style:X.Fill,color:Re,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:G.Solid,borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:ct,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:ct}}return{point:{color:ct,borderColor:i,borderSize:1,radius:5,activeColor:ct,activeBorderColor:i,activeBorderSize:3,activeRadius:5},line:{style:G.Solid,smooth:!1,color:ct,size:1,dashedValue:[2,2]},rect:{style:X.Fill,color:e,borderColor:ct,borderSize:1,borderRadius:0,borderStyle:G.Solid,borderDashedValue:[2,2]},polygon:{style:X.Fill,color:ct,borderColor:ct,borderSize:1,borderStyle:G.Solid,borderDashedValue:[2,2]},circle:{style:X.Fill,color:e,borderColor:ct,borderSize:1,borderStyle:G.Solid,borderDashedValue:[2,2]},arc:{style:G.Solid,color:ct,size:1,dashedValue:[2,2]},text:t(),rectText:t()}}function Xi(){return{size:1,color:Ge,fill:!0,activeBackgroundColor:oe(.08)}}function Yi(){return{grid:Li(),candle:Vi(),indicator:Oi(),xAxis:Xr(),yAxis:Ni(),separator:Xi(),crosshair:zi(),overlay:Wi()}}function yt(i,e){if(!(!Tt(i)&&!Tt(e))){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=i[t],n=e[t];Tt(n)&&Tt(r)?yt(r,n):T(e[t])&&(i[t]=_e(e[t]))}}}function _e(i){if(!Tt(i))return i;var e;Ct(i)?e=[]:e={};for(var t in i)if(Object.prototype.hasOwnProperty.call(i,t)){var r=i[t];Tt(r)?e[t]=_e(r):e[t]=r}return e}function Ct(i){return Object.prototype.toString.call(i)==="[object Array]"}function Ft(i){return typeof i=="function"}function Tt(i){return typeof i=="object"&&T(i)}function R(i){return typeof i=="number"&&!isNaN(i)}function T(i){return i!=null}function Qt(i){return typeof i=="boolean"}function O(i){return typeof i=="string"}var Hi=/\\(\\)?/g,Gi=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function ot(i,e,t){if(T(i)){var r=[];e.replace(Gi,function(o){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var c=o;return T(l[1])?c=l[2].replace(Hi,"$1"):T(l[0])&&(c=l[0].trim()),r.push(c),""});for(var n=i,a=0,s=r.length;T(n)&&a<s;)n=n==null?void 0:n[r[a++]];return T(n)?n:t??"--"}return t??"--"}function $i(i,e,t){var r={};return i.formatToParts(new Date(e)).forEach(function(n){var a=n.type,s=n.value;switch(a){case"year":{r.YYYY=s;break}case"month":{r.MM=s;break}case"day":{r.DD=s;break}case"hour":{r.HH=s==="24"?"00":s;break}case"minute":{r.mm=s;break}case"second":{r.ss=s;break}}}),t.replace(/YYYY|MM|DD|HH|mm|ss/g,function(n){return r[n]})}function Q(i,e){var t=+i;return R(t)?t.toFixed(e??2):"".concat(i)}function Ui(i){var e=+i;if(R(e)){if(e>1e9)return"".concat(+(e/1e9).toFixed(3),"B");if(e>1e6)return"".concat(+(e/1e6).toFixed(3),"M");if(e>1e3)return"".concat(+(e/1e3).toFixed(3),"K")}return"".concat(i)}function rt(i,e){var t="".concat(i);if(e.length===0)return t;if(t.includes(".")){var r=t.split(".");return"".concat(r[0].replace(/(\d)(?=(\d{3})+$)/g,function(n){return"".concat(n).concat(e)}),".").concat(r[1])}return t.replace(/(\d)(?=(\d{3})+$)/g,function(n){return"".concat(n).concat(e)})}function nt(i,e){var t="".concat(i),r=new RegExp("\\.0{"+e+",}[1-9][0-9]*$");if(r.test(t)){var n=t.split("."),a=n[n.length-1],s=a.match(/0*/);if(T(s)){var o=s[0].length;return n[n.length-1]=a.replace(/0*/,"0{".concat(o,"}")),n.join(".")}}return t}var ve;function Yt(i){var e,t,r;return(r=(t=(e=i.ownerDocument)===null||e===void 0?void 0:e.defaultView)===null||t===void 0?void 0:t.devicePixelRatio)!==null&&r!==void 0?r:1}function te(i,e,t){return"".concat(e??"normal"," ").concat(i??12,"px ").concat(t??"Helvetica Neue")}function Ee(i,e,t,r){if(!T(ve)){var n=document.createElement("canvas"),a=Yt(n);ve=n.getContext("2d"),ve.scale(a,a)}return ve.font=te(e,t,r),Math.round(ve.measureText(i).width)}var _t;(function(i){i.OnDataReady="onDataReady",i.OnZoom="onZoom",i.OnScroll="onScroll",i.OnVisibleRangeChange="onVisibleRangeChange",i.OnTooltipIconClick="onTooltipIconClick",i.OnCrosshairChange="onCrosshairChange",i.OnCandleBarClick="onCandleBarClick",i.OnPaneDrag="onPaneDrag"})(_t||(_t={}));var ji=function(){function i(){this._callbacks=[]}return i.prototype.subscribe=function(e){var t,r=(t=this._callbacks.indexOf(e))!==null&&t!==void 0?t:-1;r<0&&this._callbacks.push(e)},i.prototype.unsubscribe=function(e){var t;if(Ft(e)){var r=(t=this._callbacks.indexOf(e))!==null&&t!==void 0?t:-1;r>-1&&this._callbacks.splice(r,1)}else this._callbacks=[]},i.prototype.execute=function(e){this._callbacks.forEach(function(t){t(e)})},i.prototype.isEmpty=function(){return this._callbacks.length===0},i}(),mt;(function(i){i.Init="init",i.Forward="forward",i.Backward="backward"})(mt||(mt={}));var vt;(function(i){i.Normal="normal",i.Price="price",i.Volume="volume"})(vt||(vt={}));function Qe(i,e,t,r,n){var a=e.result,s=e.figures,o=e.styles,l=ot(o,"circles",r.circles),u=l.length,c=ot(o,"bars",r.bars),h=c.length,f=ot(o,"lines",r.lines),d=f.length,v=0,p=0,g=0,m,_=0;s.forEach(function(S){var y;switch(S.type){case"circle":{_=v;var x=l[v%u];m=B(B({},x),{color:x.noChangeColor}),v++;break}case"bar":{_=p;var w=c[p%h];m=B(B({},w),{color:w.noChangeColor}),p++;break}case"line":{_=g,m=f[g%d],g++;break}}if(T(m)){var b={prev:{kLineData:i[t-1],indicatorData:a[t-1]},current:{kLineData:i[t],indicatorData:a[t]},next:{kLineData:i[t+1],indicatorData:a[t+1]}},I=(y=S.styles)===null||y===void 0?void 0:y.call(S,b,e,r);n(S,B(B({},m),I),_)}})}var Zi=function(){function i(e){this.result=[],this._precisionFlag=!1;var t=e.name,r=e.shortName,n=e.series,a=e.calcParams,s=e.figures,o=e.precision,l=e.shouldOhlc,u=e.shouldFormatBigNumber,c=e.visible,h=e.zLevel,f=e.minValue,d=e.maxValue,v=e.styles,p=e.extendData,g=e.regenerateFigures,m=e.createTooltipDataSource,_=e.draw;this.name=t,this.shortName=r??t,this.series=n??vt.Normal,this.precision=o??4,this.calcParams=a??[],this.figures=s??[],this.shouldOhlc=l??!1,this.shouldFormatBigNumber=u??!1,this.visible=c??!0,this.zLevel=h??0,this.minValue=f??null,this.maxValue=d??null,this.styles=_e(v??{}),this.extendData=p,this.regenerateFigures=g??null,this.createTooltipDataSource=m??null,this.draw=_??null}return i.prototype.setShortName=function(e){return this.shortName!==e?(this.shortName=e,!0):!1},i.prototype.setSeries=function(e){return this.series!==e?(this.series=e,!0):!1},i.prototype.setPrecision=function(e,t){var r=t??!1,n=Math.floor(e);return n!==this.precision&&e>=0&&(!r||r&&!this._precisionFlag)?(this.precision=n,r||(this._precisionFlag=!0),!0):!1},i.prototype.setCalcParams=function(e){var t,r;return this.calcParams=e,this.figures=(r=(t=this.regenerateFigures)===null||t===void 0?void 0:t.call(this,e))!==null&&r!==void 0?r:this.figures,!0},i.prototype.setShouldOhlc=function(e){return this.shouldOhlc!==e?(this.shouldOhlc=e,!0):!1},i.prototype.setShouldFormatBigNumber=function(e){return this.shouldFormatBigNumber!==e?(this.shouldFormatBigNumber=e,!0):!1},i.prototype.setVisible=function(e){return this.visible!==e?(this.visible=e,!0):!1},i.prototype.setZLevel=function(e){return this.zLevel!==e?(this.zLevel=e,!0):!1},i.prototype.setStyles=function(e){return yt(this.styles,e),!0},i.prototype.setExtendData=function(e){return this.extendData!==e?(this.extendData=e,!0):!1},i.prototype.setFigures=function(e){return this.figures!==e?(this.figures=e,!0):!1},i.prototype.setMinValue=function(e){return this.minValue!==e?(this.minValue=e,!0):!1},i.prototype.setMaxValue=function(e){return this.maxValue!==e?(this.maxValue=e,!0):!1},i.prototype.setRegenerateFigures=function(e){return this.regenerateFigures!==e?(this.regenerateFigures=e,!0):!1},i.prototype.setCreateTooltipDataSource=function(e){return this.createTooltipDataSource!==e?(this.createTooltipDataSource=e,!0):!1},i.prototype.setDraw=function(e){return this.draw!==e?(this.draw=e,!0):!1},i.prototype.calcIndicator=function(e){return ne(this,void 0,void 0,function(){var t;return ae(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.calc(e,this)];case 1:return t=r.sent(),this.result=t,[2,!0];case 2:return r.sent(),[2,!1];case 3:return[2]}})})},i.extend=function(e){var t=function(r){N(n,r);function n(){return r.call(this,e)||this}return n.prototype.calc=function(a,s){return e.calc(a,s)},n}(i);return t},i}(),se;(function(i){i.Normal="normal",i.WeakMagnet="weak_magnet",i.StrongMagnet="strong_magnet"})(se||(se={}));function qi(){return["mouseClickEvent","mouseDoubleClickEvent","mouseRightClickEvent","tapEvent","doubleTapEvent","mouseDownEvent","touchStartEvent","mouseMoveEvent","touchMoveEvent"]}var vr=1,de=-1,Ki="overlay_",ie="overlay_figure_",Qi=function(){function i(e){this.currentStep=vr,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];var t=e.mode,r=e.modeSensitivity,n=e.extendData,a=e.styles,s=e.name,o=e.totalStep,l=e.lock,u=e.visible,c=e.zLevel,h=e.needDefaultPointFigure,f=e.needDefaultXAxisFigure,d=e.needDefaultYAxisFigure,v=e.createPointFigures,p=e.createXAxisFigures,g=e.createYAxisFigures,m=e.performEventPressedMove,_=e.performEventMoveForDrawing,S=e.onDrawStart,y=e.onDrawing,x=e.onDrawEnd,w=e.onClick,b=e.onDoubleClick,I=e.onRightClick,C=e.onPressedMoveStart,P=e.onPressedMoving,M=e.onPressedMoveEnd,E=e.onMouseEnter,D=e.onMouseLeave,k=e.onRemoved,V=e.onSelected,F=e.onDeselected;this.name=s,this.totalStep=!R(o)||o<2?1:o,this.lock=l??!1,this.visible=u??!0,this.zLevel=c??0,this.needDefaultPointFigure=h??!1,this.needDefaultXAxisFigure=f??!1,this.needDefaultYAxisFigure=d??!1,this.mode=t??se.Normal,this.modeSensitivity=r??8,this.extendData=n,this.styles=_e(a??{}),this.createPointFigures=v??null,this.createXAxisFigures=p??null,this.createYAxisFigures=g??null,this.performEventPressedMove=m??null,this.performEventMoveForDrawing=_??null,this.onDrawStart=S??null,this.onDrawing=y??null,this.onDrawEnd=x??null,this.onClick=w??null,this.onDoubleClick=b??null,this.onRightClick=I??null,this.onPressedMoveStart=C??null,this.onPressedMoving=P??null,this.onPressedMoveEnd=M??null,this.onMouseEnter=E??null,this.onMouseLeave=D??null,this.onRemoved=k??null,this.onSelected=V??null,this.onDeselected=F??null}return i.prototype.setId=function(e){return O(this.id)?!1:(this.id=e,!0)},i.prototype.setGroupId=function(e){return O(this.groupId)?!1:(this.groupId=e,!0)},i.prototype.setPaneId=function(e){this.paneId=e},i.prototype.setExtendData=function(e){return e!==this.extendData?(this.extendData=e,!0):!1},i.prototype.setStyles=function(e){return yt(this.styles,e),!0},i.prototype.setPoints=function(e){if(e.length>0){var t=void 0;if(this.points=Wr([],ee(e),!1),e.length>=this.totalStep-1?(this.currentStep=de,t=this.totalStep-1):(this.currentStep=e.length+1,t=e.length),this.performEventMoveForDrawing!==null)for(var r=0;r<t;r++)this.performEventMoveForDrawing({currentStep:r+2,mode:this.mode,points:this.points,performPointIndex:r,performPoint:this.points[r]});return this.currentStep===de&&this.performEventPressedMove!==null&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1},i.prototype.setLock=function(e){return this.lock!==e?(this.lock=e,!0):!1},i.prototype.setVisible=function(e){return this.visible!==e?(this.visible=e,!0):!1},i.prototype.setZLevel=function(e){return this.zLevel!==e?(this.zLevel=e,!0):!1},i.prototype.setMode=function(e){return this.mode!==e?(this.mode=e,!0):!1},i.prototype.setModeSensitivity=function(e){return this.modeSensitivity!==e?(this.modeSensitivity=e,!0):!1},i.prototype.setOnDrawStartCallback=function(e){return this.onDrawStart!==e?(this.onDrawStart=e,!0):!1},i.prototype.setOnDrawingCallback=function(e){return this.onDrawing!==e?(this.onDrawing=e,!0):!1},i.prototype.setOnDrawEndCallback=function(e){return this.onDrawEnd!==e?(this.onDrawEnd=e,!0):!1},i.prototype.setOnClickCallback=function(e){return this.onClick!==e?(this.onClick=e,!0):!1},i.prototype.setOnDoubleClickCallback=function(e){return this.onDoubleClick!==e?(this.onDoubleClick=e,!0):!1},i.prototype.setOnRightClickCallback=function(e){return this.onRightClick!==e?(this.onRightClick=e,!0):!1},i.prototype.setOnPressedMoveStartCallback=function(e){return this.onPressedMoveStart!==e?(this.onPressedMoveStart=e,!0):!1},i.prototype.setOnPressedMovingCallback=function(e){return this.onPressedMoving!==e?(this.onPressedMoving=e,!0):!1},i.prototype.setOnPressedMoveEndCallback=function(e){return this.onPressedMoveEnd!==e?(this.onPressedMoveEnd=e,!0):!1},i.prototype.setOnMouseEnterCallback=function(e){return this.onMouseEnter!==e?(this.onMouseEnter=e,!0):!1},i.prototype.setOnMouseLeaveCallback=function(e){return this.onMouseLeave!==e?(this.onMouseLeave=e,!0):!1},i.prototype.setOnRemovedCallback=function(e){return this.onRemoved!==e?(this.onRemoved=e,!0):!1},i.prototype.setOnSelectedCallback=function(e){return this.onSelected!==e?(this.onSelected=e,!0):!1},i.prototype.setOnDeselectedCallback=function(e){return this.onDeselected!==e?(this.onDeselected=e,!0):!1},i.prototype.nextStep=function(){this.currentStep===this.totalStep-1?this.currentStep=de:this.currentStep++},i.prototype.forceComplete=function(){this.currentStep=de},i.prototype.isDrawing=function(){return this.currentStep!==de},i.prototype.isStart=function(){return this.currentStep===vr},i.prototype.eventMoveForDrawing=function(e){var t,r=this.currentStep-1,n={};R(e.timestamp)&&(n.timestamp=e.timestamp),R(e.dataIndex)&&(n.dataIndex=e.dataIndex),R(e.value)&&(n.value=e.value),this.points[r]=n,(t=this.performEventMoveForDrawing)===null||t===void 0||t.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:r,performPoint:n})},i.prototype.eventPressedPointMove=function(e,t){var r;R(e.dataIndex)&&(this.points[t].dataIndex=e.dataIndex,this.points[t].timestamp=e.timestamp),R(e.value)&&(this.points[t].value=e.value),(r=this.performEventPressedMove)===null||r===void 0||r.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})},i.prototype.startPressedMove=function(e){this._prevPressedPoint=B({},e),this._prevPressedPoints=_e(this.points)},i.prototype.eventPressedOtherMove=function(e,t){if(this._prevPressedPoint!==null){var r;R(e.dataIndex)&&R(this._prevPressedPoint.dataIndex)&&(r=e.dataIndex-this._prevPressedPoint.dataIndex);var n;R(e.value)&&R(this._prevPressedPoint.value)&&(n=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(function(a){var s;R(a.timestamp)&&(a.dataIndex=t.timestampToDataIndex(a.timestamp));var o=B({},a);return R(r)&&R(a.dataIndex)&&(o.dataIndex=a.dataIndex+r,o.timestamp=(s=t.dataIndexToTimestamp(o.dataIndex))!==null&&s!==void 0?s:void 0),R(n)&&R(a.value)&&(o.value=a.value+n),o})}},i.extend=function(e){var t=function(r){N(n,r);function n(){return r.call(this,e)||this}return n}(i);return t},i}(),lt;(function(i){i[i.Tooltip=0]="Tooltip",i[i.Crosshair=1]="Crosshair",i[i.XAxis=2]="XAxis"})(lt||(lt={}));function Ji(){return{formatDate:$i,formatBigNumber:Ui}}var tn="en-US",We=-1;function Pe(i){return Ft(window.requestAnimationFrame)?window.requestAnimationFrame(i):window.setTimeout(i,20)}function dr(i){Ft(window.cancelAnimationFrame)?window.cancelAnimationFrame(i):window.clearTimeout(i)}var $e=function(){function i(e){this._options={duration:500,iterationCount:1},this._currentIterationCount=0,this._running=!1,this._time=0,yt(this._options,e)}return i.prototype._loop=function(){var e=this;this._running=!0;var t=function(){var r;if(e._running){var n=new Date().getTime()-e._time;n<e._options.duration?((r=e._doFrameCallback)===null||r===void 0||r.call(e,n),Pe(t)):(e.stop(),e._currentIterationCount++,e._currentIterationCount<e._options.iterationCount&&e.start())}};Pe(t)},i.prototype.doFrame=function(e){return this._doFrameCallback=e,this},i.prototype.setDuration=function(e){return this._options.duration=e,this},i.prototype.setIterationCount=function(e){return this._options.iterationCount=e,this},i.prototype.start=function(){this._running||(this._time=new Date().getTime(),this._loop())},i.prototype.stop=function(){var e;this._running&&((e=this._doFrameCallback)===null||e===void 0||e.call(this,this._options.duration)),this._running=!1},i}(),Xe=1,fr=new Date().getTime();function Yr(i){var e=new Date().getTime();return e===fr?++Xe:Xe=1,fr=e,"".concat(i??"").concat(e,"_").concat(Xe)}function Rt(i,e){var t,r=document.createElement(i),n=e??{};for(var a in n)r.style[a]=(t=n[a])!==null&&t!==void 0?t:"";return r}function Ue(i,e,t){var r=0,n=0;for(n=i.length-1;r!==n;){var a=Math.floor((n+r)/2),s=n-r,o=i[a][e];if(t===i[r][e])return r;if(t===i[n][e])return n;if(t===o)return a;if(t>o?r=a:n=a,s<=2)break}return r}function en(i){var e=Math.floor(fe(i)),t=jt(e),r=i/t,n=0;return r<1.5?n=1:r<2.5?n=2:r<3.5?n=3:r<4.5?n=4:r<5.5?n=5:r<6.5?n=6:n=8,i=n*t,e>=-20?+i.toFixed(e<0?-e:0):i}function pr(i,e){e==null&&(e=10),e=Math.min(Math.max(0,e),20);var t=(+i).toFixed(e);return+t}function rn(i){var e=i.toString(),t=e.indexOf("e");if(t>0){var r=+e.slice(t+1);return r<0?-r:0}else{var n=e.indexOf(".");return n<0?0:e.length-1-n}}function Hr(i,e,t){var r=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return i.forEach(function(n){var a,s;r[0]=Math.max((a=n[e])!==null&&a!==void 0?a:n,r[0]),r[1]=Math.min((s=n[t])!==null&&s!==void 0?s:n,r[1])}),r}function fe(i){return Math.log(i)/Math.log(10)}function jt(i){return Math.pow(10,i)}function gr(){return{from:0,to:0,realFrom:0,realTo:0}}var mr={MIN:1,MAX:50},nn=8,an=80,on=.88,je=10,sn=function(){function i(e){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._totalBarSpace=0,this._barSpace=nn,this._offsetRightDistance=an,this._startLastBarRightSideDiffBarCount=0,this._scrollLimitRole=0,this._minVisibleBarCount={left:2,right:2},this._maxOffsetDistance={left:50,right:50},this._visibleRange=gr(),this._chartStore=e,this._gapBarSpace=this._calcGapBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace}return i.prototype._calcGapBarSpace=function(){var e;return this._barSpace>3?e=Math.floor(this._barSpace*on):(e=Math.floor(this._barSpace),e===this._barSpace&&e--),e%2===0&&e--,e=Math.max(1,e),e},i.prototype.adjustVisibleRange=function(){var e,t,r=this._chartStore.getDataList(),n=r.length,a=this._totalBarSpace/this._barSpace,s,o;this._scrollLimitRole===1?(s=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,o=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(s=this._minVisibleBarCount.left,o=this._minVisibleBarCount.right),s=Math.max(0,s),o=Math.max(0,o);var l=a-Math.min(s,n);this._lastBarRightSideDiffBarCount>l&&(this._lastBarRightSideDiffBarCount=l);var u=-n+Math.min(o,n);this._lastBarRightSideDiffBarCount<u&&(this._lastBarRightSideDiffBarCount=u);var c=Math.round(this._lastBarRightSideDiffBarCount+n+.5),h=c;c>n&&(c=n);var f=Math.round(c-a)-1;f<0&&(f=0);var d=this._lastBarRightSideDiffBarCount>0?Math.round(n+this._lastBarRightSideDiffBarCount-a)-1:f;if(this._visibleRange={from:f,to:c,realFrom:d,realTo:h},this._chartStore.getActionStore().execute(_t.OnVisibleRangeChange,this._visibleRange),this._chartStore.adjustVisibleDataList(),f===0){var v=r[0];this._chartStore.executeLoadMoreCallback((e=v==null?void 0:v.timestamp)!==null&&e!==void 0?e:null),this._chartStore.executeLoadDataCallback({type:mt.Forward,data:v??null})}c===n&&this._chartStore.executeLoadDataCallback({type:mt.Backward,data:(t=r[n-1])!==null&&t!==void 0?t:null})},i.prototype.getDateTimeFormat=function(){return this._dateTimeFormat},i.prototype._buildDateTimeFormat=function(e){var t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};O(e)&&(t.timeZone=e);var r=null;try{r=new Intl.DateTimeFormat("en",t)}catch{}return r},i.prototype.setTimezone=function(e){var t=this._buildDateTimeFormat(e);t!==null&&(this._dateTimeFormat=t)},i.prototype.getTimezone=function(){return this._dateTimeFormat.resolvedOptions().timeZone},i.prototype.getBarSpace=function(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}},i.prototype.setBarSpace=function(e,t){e<mr.MIN||e>mr.MAX||this._barSpace===e||(this._barSpace=e,this._gapBarSpace=this._calcGapBarSpace(),t==null||t(),this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))},i.prototype.setTotalBarSpace=function(e){return this._totalBarSpace!==e&&(this._totalBarSpace=e,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0)),this},i.prototype.setOffsetRightDistance=function(e,t){return this._offsetRightDistance=this._scrollLimitRole===1?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this},i.prototype.resetOffsetRightDistance=function(){this.setOffsetRightDistance(this._offsetRightDistance)},i.prototype.getInitialOffsetRightDistance=function(){return this._offsetRightDistance},i.prototype.getOffsetRightDistance=function(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)},i.prototype.getLastBarRightSideDiffBarCount=function(){return this._lastBarRightSideDiffBarCount},i.prototype.setLastBarRightSideDiffBarCount=function(e){return this._lastBarRightSideDiffBarCount=e,this},i.prototype.setMaxOffsetLeftDistance=function(e){return this._scrollLimitRole=1,this._maxOffsetDistance.left=e,this},i.prototype.setMaxOffsetRightDistance=function(e){return this._scrollLimitRole=1,this._maxOffsetDistance.right=e,this},i.prototype.setLeftMinVisibleBarCount=function(e){return this._scrollLimitRole=0,this._minVisibleBarCount.left=e,this},i.prototype.setRightMinVisibleBarCount=function(e){return this._scrollLimitRole=0,this._minVisibleBarCount.right=e,this},i.prototype.getVisibleRange=function(){return this._visibleRange},i.prototype.startScroll=function(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount},i.prototype.scroll=function(e){if(this._scrollEnabled){var t=e/this._barSpace,r=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-t,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0);var n=Math.round(r-this._lastBarRightSideDiffBarCount*this._barSpace);n!==0&&this._chartStore.getActionStore().execute(_t.OnScroll,{distance:n})}},i.prototype.getDataByDataIndex=function(e){var t;return(t=this._chartStore.getDataList()[e])!==null&&t!==void 0?t:null},i.prototype.coordinateToFloatIndex=function(e){var t=this._chartStore.getDataList().length,r=(this._totalBarSpace-e)/this._barSpace,n=t+this._lastBarRightSideDiffBarCount-r;return Math.round(n*1e6)/1e6},i.prototype.dataIndexToTimestamp=function(e){var t,r=this.getDataByDataIndex(e);return(t=r==null?void 0:r.timestamp)!==null&&t!==void 0?t:null},i.prototype.timestampToDataIndex=function(e){var t=this._chartStore.getDataList();return t.length===0?0:Ue(t,"timestamp",e)},i.prototype.dataIndexToCoordinate=function(e){var t=this._chartStore.getDataList().length,r=t+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(r-.5)*this._barSpace)},i.prototype.coordinateToDataIndex=function(e){return Math.ceil(this.coordinateToFloatIndex(e))-1},i.prototype.zoom=function(e,t){var r=this,n;if(this._zoomEnabled){var a=t??null;if(!R(a==null?void 0:a.x)){var s=this._chartStore.getTooltipStore().getCrosshair();a={x:(n=s==null?void 0:s.x)!==null&&n!==void 0?n:this._totalBarSpace/2}}var o=a.x,l=this.coordinateToFloatIndex(o),u=this._barSpace,c=this._barSpace+e*(this._barSpace/je);this.setBarSpace(c,function(){r._lastBarRightSideDiffBarCount+=l-r.coordinateToFloatIndex(o)});var h=this._barSpace/u;h!==1&&this._chartStore.getActionStore().execute(_t.OnZoom,{scale:h})}},i.prototype.setZoomEnabled=function(e){return this._zoomEnabled=e,this},i.prototype.getZoomEnabled=function(){return this._zoomEnabled},i.prototype.setScrollEnabled=function(e){return this._scrollEnabled=e,this},i.prototype.getScrollEnabled=function(){return this._scrollEnabled},i.prototype.clear=function(){this._visibleRange=gr()},i}(),ln={name:"AVP",shortName:"AVP",series:vt.Price,precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:function(i){var e=0,t=0;return i.map(function(r){var n,a,s={},o=(n=r==null?void 0:r.turnover)!==null&&n!==void 0?n:0,l=(a=r==null?void 0:r.volume)!==null&&a!==void 0?a:0;return e+=o,t+=l,t!==0&&(s.avp=e/t),s})}},un={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:function(i,e,t){var r,n,a,s,o=i.prev,l=i.current,u=(n=(r=o.indicatorData)===null||r===void 0?void 0:r.ao)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,c=(s=(a=l.indicatorData)===null||a===void 0?void 0:a.ao)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER,h;c>u?h=ot(e.styles,"bars[0].upColor",t.bars[0].upColor):h=ot(e.styles,"bars[0].downColor",t.bars[0].downColor);var f=c>u?X.Stroke:X.Fill;return{color:h,style:f,borderColor:h}}}],calc:function(i,e){var t=e.calcParams,r=Math.max(t[0],t[1]),n=0,a=0,s=0,o=0;return i.map(function(l,u){var c={},h=(l.low+l.high)/2;if(n+=h,a+=h,u>=t[0]-1){s=n/t[0];var f=i[u-(t[0]-1)];n-=(f.low+f.high)/2}if(u>=t[1]-1){o=a/t[1];var f=i[u-(t[1]-1)];a-=(f.low+f.high)/2}return u>=r-1&&(c.ao=s-o),c})}},cn={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:function(i){return i.map(function(e,t){return{key:"bias".concat(t+1),title:"BIAS".concat(e,": "),type:"line"}})},calc:function(i,e){var t=e.calcParams,r=e.figures,n=[];return i.map(function(a,s){var o={},l=a.close;return t.forEach(function(u,c){var h;if(n[c]=((h=n[c])!==null&&h!==void 0?h:0)+l,s>=u-1){var f=n[c]/t[c];o[r[c].key]=(l-f)/f*100,n[c]-=i[s-(u-1)].close}}),o})}};function hn(i,e){var t=i.length,r=0;return i.forEach(function(n){var a=n.close-e;r+=a*a}),r=Math.abs(r),Math.sqrt(r/t)}var vn={name:"BOLL",shortName:"BOLL",series:vt.Price,calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=t[0]-1,n=0;return i.map(function(a,s){var o=a.close,l={};if(n+=o,s>=r){l.mid=n/t[0];var u=hn(i.slice(s-r,s+1),l.mid);l.up=l.mid+t[1]*u,l.dn=l.mid-t[1]*u,n-=i[s-r].close}return l})}},dn={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=0,a=0,s=0;return i.map(function(o,l){var u,c,h={},f=o.high,d=o.low,v=o.open,p=((u=i[l-1])!==null&&u!==void 0?u:o).close;if(a+=f-v,s+=v-d,r+=f-p,n+=p-d,l>=t[0]-1){s!==0?h.ar=a/s*100:h.ar=0,n!==0?h.br=r/n*100:h.br=0;var g=i[l-(t[0]-1)],m=g.high,_=g.low,S=g.open,y=((c=i[l-t[0]])!==null&&c!==void 0?c:i[l-(t[0]-1)]).close;r-=m-y,n-=y-_,a-=m-S,s-=S-_}return h})}},fn={name:"BBI",shortName:"BBI",series:vt.Price,precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=Math.max.apply(Math,Wr([],ee(t),!1)),n=[],a=[];return i.map(function(s,o){var l={},u=s.close;if(t.forEach(function(h,f){var d;n[f]=((d=n[f])!==null&&d!==void 0?d:0)+u,o>=h-1&&(a[f]=n[f]/h,n[f]-=i[o-(h-1)].close)}),o>=r-1){var c=0;a.forEach(function(h){c+=h}),l.bbi=c/4}return l})}},pn={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=t[0]-1,n=0,a=[];return i.map(function(s,o){var l={},u=(s.high+s.low+s.close)/3;if(n+=u,a.push(u),o>=r){var c=n/t[0],h=a.slice(o-r,o+1),f=0;h.forEach(function(p){f+=Math.abs(p-c)});var d=f/t[0];l.cci=d!==0?(u-c)/d/.015:0;var v=(i[o-r].high+i[o-r].low+i[o-r].close)/3;n-=v}return l})}},gn={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=Math.ceil(t[1]/2.5+1),n=Math.ceil(t[2]/2.5+1),a=Math.ceil(t[3]/2.5+1),s=Math.ceil(t[4]/2.5+1),o=0,l=[],u=0,c=[],h=0,f=[],d=0,v=[],p=[];return i.forEach(function(g,m){var _,S,y,x,w,b={},I=(_=i[m-1])!==null&&_!==void 0?_:g,C=(I.high+I.close+I.low+I.open)/4,P=Math.max(0,g.high-C),M=Math.max(0,C-g.low);m>=t[0]-1&&(M!==0?b.cr=P/M*100:b.cr=0,o+=b.cr,u+=b.cr,h+=b.cr,d+=b.cr,m>=t[0]+t[1]-2&&(l.push(o/t[1]),m>=t[0]+t[1]+r-3&&(b.ma1=l[l.length-1-r]),o-=(S=p[m-(t[1]-1)].cr)!==null&&S!==void 0?S:0),m>=t[0]+t[2]-2&&(c.push(u/t[2]),m>=t[0]+t[2]+n-3&&(b.ma2=c[c.length-1-n]),u-=(y=p[m-(t[2]-1)].cr)!==null&&y!==void 0?y:0),m>=t[0]+t[3]-2&&(f.push(h/t[3]),m>=t[0]+t[3]+a-3&&(b.ma3=f[f.length-1-a]),h-=(x=p[m-(t[3]-1)].cr)!==null&&x!==void 0?x:0),m>=t[0]+t[4]-2&&(v.push(d/t[4]),m>=t[0]+t[4]+s-3&&(b.ma4=v[v.length-1-s]),d-=(w=p[m-(t[4]-1)].cr)!==null&&w!==void 0?w:0)),p.push(b)}),p}},mn={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=Math.max(t[0],t[1]),n=0,a=0,s=0,o=[];return i.forEach(function(l,u){var c,h={},f=l.close;n+=f,a+=f;var d=0,v=0;if(u>=t[0]-1&&(d=n/t[0],n-=i[u-(t[0]-1)].close),u>=t[1]-1&&(v=a/t[1],a-=i[u-(t[1]-1)].close),u>=r-1){var p=d-v;h.dma=p,s+=p,u>=r+t[2]-2&&(h.ama=s/t[2],s-=(c=o[u-(t[2]-1)].dma)!==null&&c!==void 0?c:0)}o.push(h)}),o}},_n={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=0,a=0,s=0,o=0,l=0,u=0,c=0,h=[];return i.forEach(function(f,d){var v,p,g={},m=(v=i[d-1])!==null&&v!==void 0?v:f,_=m.close,S=f.high,y=f.low,x=S-y,w=Math.abs(S-_),b=Math.abs(_-y),I=S-m.high,C=m.low-y,P=Math.max(Math.max(x,w),b),M=I>0&&I>C?I:0,E=C>0&&C>I?C:0;if(r+=P,n+=M,a+=E,d>=t[0]-1){d>t[0]-1?(s=s-s/t[0]+P,o=o-o/t[0]+M,l=l-l/t[0]+E):(s=r,o=n,l=a);var D=0,k=0;s!==0&&(D=o*100/s,k=l*100/s),g.pdi=D,g.mdi=k;var V=0;k+D!==0&&(V=Math.abs(k-D)/(k+D)*100),u+=V,d>=t[0]*2-2&&(d>t[0]*2-2?c=(c*(t[0]-1)+V)/t[0]:c=u/t[0],g.adx=c,d>=t[0]*2+t[1]-3&&(g.adxr=(((p=h[d-(t[1]-1)].adx)!==null&&p!==void 0?p:0)+c)/2))}h.push(g)}),h}},yn={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=[];return i.map(function(a,s){var o,l={};if(s>0){var u=i[s-1],c=a.high,h=a.low,f=(o=a.volume)!==null&&o!==void 0?o:0,d=(c+h)/2-(u.high+u.low)/2;if(f===0||c-h===0)l.emv=0;else{var v=f/1e8/(c-h);l.emv=d/v}r+=l.emv,n.push(l.emv),s>=t[0]&&(l.maEmv=r/t[0],r-=n[s-t[0]])}return l})}},Sn={name:"EMA",shortName:"EMA",series:vt.Price,calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:function(i){return i.map(function(e,t){return{key:"ema".concat(t+1),title:"EMA".concat(e,": "),type:"line"}})},calc:function(i,e){var t=e.calcParams,r=e.figures,n=0,a=[];return i.map(function(s,o){var l={},u=s.close;return n+=u,t.forEach(function(c,h){o>=c-1&&(o>c-1?a[h]=(2*u+(c-1)*a[h])/(c+1):a[h]=n/c,l[r[h].key]=a[h])}),l})}},xn={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=[];return i.forEach(function(a,s){var o,l={};if(s>=t[0]){var u=a.close,c=i[s-t[0]].close;l.mtm=u-c,r+=l.mtm,s>=t[0]+t[1]-1&&(l.maMtm=r/t[1],r-=(o=n[s-(t[1]-1)].mtm)!==null&&o!==void 0?o:0)}n.push(l)}),n}},bn={name:"MA",shortName:"MA",series:vt.Price,calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:function(i){return i.map(function(e,t){return{key:"ma".concat(t+1),title:"MA".concat(e,": "),type:"line"}})},calc:function(i,e){var t=e.calcParams,r=e.figures,n=[];return i.map(function(a,s){var o={},l=a.close;return t.forEach(function(u,c){var h;n[c]=((h=n[c])!==null&&h!==void 0?h:0)+l,s>=u-1&&(o[r[c].key]=n[c]/u,n[c]-=i[s-(u-1)].close)}),o})}},wn={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:function(i,e,t){var r,n,a,s,o=i.prev,l=i.current,u=(n=(r=o.indicatorData)===null||r===void 0?void 0:r.macd)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,c=(s=(a=l.indicatorData)===null||a===void 0?void 0:a.macd)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER,h;c>0?h=ot(e.styles,"bars[0].upColor",t.bars[0].upColor):c<0?h=ot(e.styles,"bars[0].downColor",t.bars[0].downColor):h=ot(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);var f=u<c?X.Stroke:X.Fill;return{style:f,color:h,borderColor:h}}}],calc:function(i,e){var t=e.calcParams,r=0,n,a,s=0,o=0,l=0,u=Math.max(t[0],t[1]);return i.map(function(c,h){var f={},d=c.close;return r+=d,h>=t[0]-1&&(h>t[0]-1?n=(2*d+(t[0]-1)*n)/(t[0]+1):n=r/t[0]),h>=t[1]-1&&(h>t[1]-1?a=(2*d+(t[1]-1)*a)/(t[1]+1):a=r/t[1]),h>=u-1&&(s=n-a,f.dif=s,o+=s,h>=u+t[2]-2&&(h>u+t[2]-2?l=(s*2+l*(t[2]-1))/(t[2]+1):l=o/t[2],f.macd=(s-l)*2,f.dea=l)),f})}},Cn={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=0,a=[];return i.forEach(function(s,o){var l,u,c,h,f=(l=i[o-1])!==null&&l!==void 0?l:s;s.close<f.close?n-=(u=s.volume)!==null&&u!==void 0?u:0:s.close>f.close&&(n+=(c=s.volume)!==null&&c!==void 0?c:0);var d={obv:n};r+=n,o>=t[0]-1&&(d.maObv=r/t[0],r-=(h=a[o-(t[0]-1)].obv)!==null&&h!==void 0?h:0),a.push(d)}),a}},In={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:function(i){var e=0;return i.map(function(t,r){var n,a,s={},o=t.close,l=(n=t.volume)!==null&&n!==void 0?n:1,u=((a=i[r-1])!==null&&a!==void 0?a:t).close,c=0,h=u*l;return h!==0&&(c=(o-u)/h),e+=c,s.pvt=e,s})}},En={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=0,a=[],s=[];return i.forEach(function(o,l){var u,c,h={},f=((u=i[l-1])!==null&&u!==void 0?u:o).close,d=o.close-f>0?1:0;a.push(d),r+=d,l>=t[0]-1&&(h.psy=r/t[0]*100,n+=h.psy,l>=t[0]+t[1]-2&&(h.maPsy=n/t[1],n-=(c=s[l-(t[1]-1)].psy)!==null&&c!==void 0?c:0),r-=a[l-(t[0]-1)]),s.push(h)}),s}},Pn={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=[],n=0;return i.forEach(function(a,s){var o,l,u={};if(s>=t[0]-1){var c=a.close,h=((o=i[s-t[0]])!==null&&o!==void 0?o:i[s-(t[0]-1)]).close;h!==0?u.roc=(c-h)/h*100:u.roc=0,n+=u.roc,s>=t[0]-1+t[1]-1&&(u.maRoc=n/t[1],n-=(l=r[s-(t[1]-1)].roc)!==null&&l!==void 0?l:0)}r.push(u)}),r}},Mn={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:function(i){return i.map(function(e,t){var r=t+1;return{key:"rsi".concat(r),title:"RSI".concat(r,": "),type:"line"}})},calc:function(i,e){var t=e.calcParams,r=e.figures,n=[],a=[];return i.map(function(s,o){var l,u={},c=((l=i[o-1])!==null&&l!==void 0?l:s).close,h=s.close-c;return t.forEach(function(f,d){var v,p,g;if(h>0?n[d]=((v=n[d])!==null&&v!==void 0?v:0)+h:a[d]=((p=a[d])!==null&&p!==void 0?p:0)+Math.abs(h),o>=f-1){a[d]!==0?u[r[d].key]=100-100/(1+n[d]/a[d]):u[r[d].key]=0;var m=i[o-(f-1)],_=(g=i[o-f])!==null&&g!==void 0?g:m,S=m.close-_.close;S>0?n[d]-=S:a[d]-=Math.abs(S)}}),u})}},Tn={name:"SMA",shortName:"SMA",series:vt.Price,calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:function(i,e){var t=e.calcParams,r=0,n=0;return i.map(function(a,s){var o={},l=a.close;return r+=l,s>=t[0]-1&&(s>t[0]-1?n=(l*t[1]+n*(t[0]-t[1]+1))/(t[0]+1):n=r/t[0],o.sma=n),o})}},Dn={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=[];return i.forEach(function(n,a){var s,o,l,u,c={},h=n.close;if(a>=t[0]-1){var f=Hr(i.slice(a-(t[0]-1),a+1),"high","low"),d=f[0],v=f[1],p=d-v,g=(h-v)/(p===0?1:p)*100;c.k=((t[1]-1)*((o=(s=r[a-1])===null||s===void 0?void 0:s.k)!==null&&o!==void 0?o:50)+g)/t[1],c.d=((t[2]-1)*((u=(l=r[a-1])===null||l===void 0?void 0:l.d)!==null&&u!==void 0?u:50)+c.k)/t[2],c.j=3*c.k-2*c.d}r.push(c)}),r}},An={name:"SAR",shortName:"SAR",series:vt.Price,calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:function(i,e,t){var r,n,a=i.current,s=(n=(r=a.indicatorData)===null||r===void 0?void 0:r.sar)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER,o=a.kLineData,l=((o==null?void 0:o.high)+(o==null?void 0:o.low))/2,u=s<l?ot(e.styles,"circles[0].upColor",t.circles[0].upColor):ot(e.styles,"circles[0].downColor",t.circles[0].downColor);return{color:u}}}],calc:function(i,e){var t=e.calcParams,r=t[0]/100,n=t[1]/100,a=t[2]/100,s=r,o=-100,l=!1,u=0;return i.map(function(c,h){var f=u,d=c.high,v=c.low;if(l){(o===-100||o<d)&&(o=d,s=Math.min(s+n,a)),u=f+s*(o-f);var p=Math.min(i[Math.max(1,h)-1].low,v);u>c.low?(u=o,s=r,o=-100,l=!l):u>p&&(u=p)}else{(o===-100||o>v)&&(o=v,s=Math.min(s+n,a)),u=f+s*(o-f);var g=Math.max(i[Math.max(1,h)-1].high,d);u<c.high?(u=o,s=0,o=-100,l=!l):u<g&&(u=g)}return{sar:u}})}},kn={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n,a,s,o=0,l=0,u=0,c=[];return i.forEach(function(h,f){var d,v={},p=h.close;if(r+=p,f>=t[0]-1&&(f>t[0]-1?n=(2*p+(t[0]-1)*n)/(t[0]+1):n=r/t[0],o+=n,f>=t[0]*2-2&&(f>t[0]*2-2?a=(2*n+(t[0]-1)*a)/(t[0]+1):a=o/t[0],l+=a,f>=t[0]*3-3))){var g=void 0,m=0;f>t[0]*3-3?(g=(2*a+(t[0]-1)*s)/(t[0]+1),m=(g-s)/s*100):g=l/t[0],s=g,v.trix=m,u+=m,f>=t[0]*3+t[1]-4&&(v.maTrix=u/t[1],u-=(d=c[f-(t[1]-1)].trix)!==null&&d!==void 0?d:0)}c.push(v)}),c}};function _r(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:function(i,e,t){var r=i.current.kLineData,n=ot(e.styles,"bars[0].noChangeColor",t.bars[0].noChangeColor);return T(r)&&(r.close>r.open?n=ot(e.styles,"bars[0].upColor",t.bars[0].upColor):r.close<r.open&&(n=ot(e.styles,"bars[0].downColor",t.bars[0].downColor))),{color:n}}}}var Fn={name:"VOL",shortName:"VOL",series:vt.Volume,calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},_r()],regenerateFigures:function(i){var e=i.map(function(t,r){return{key:"ma".concat(r+1),title:"MA".concat(t,": "),type:"line"}});return e.push(_r()),e},calc:function(i,e){var t=e.calcParams,r=e.figures,n=[];return i.map(function(a,s){var o,l=(o=a.volume)!==null&&o!==void 0?o:0,u={volume:l};return t.forEach(function(c,h){var f,d;n[h]=((f=n[h])!==null&&f!==void 0?f:0)+l,s>=c-1&&(u[r[h].key]=n[h]/c,n[h]-=(d=i[s-(c-1)].volume)!==null&&d!==void 0?d:0)}),u})}},Rn={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:function(i,e){var t=e.calcParams,r=0,n=0,a=0,s=0,o=[];return i.forEach(function(l,u){var c,h,f,d,v,p={},g=l.close,m=((c=i[u-1])!==null&&c!==void 0?c:l).close,_=(h=l.volume)!==null&&h!==void 0?h:0;if(g>m?r+=_:g<m?n+=_:a+=_,u>=t[0]-1){var S=a/2;n+S===0?p.vr=0:p.vr=(r+S)/(n+S)*100,s+=p.vr,u>=t[0]+t[1]-2&&(p.maVr=s/t[1],s-=(f=o[u-(t[1]-1)].vr)!==null&&f!==void 0?f:0);var y=i[u-(t[0]-1)],x=(d=i[u-t[0]])!==null&&d!==void 0?d:y,w=y.close,b=(v=y.volume)!==null&&v!==void 0?v:0;w>x.close?r-=b:w<x.close?n-=b:a-=b}o.push(p)}),o}},Bn={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:function(i){return i.map(function(e,t){return{key:"wr".concat(t+1),title:"WR".concat(t+1,": "),type:"line"}})},calc:function(i,e){var t=e.calcParams,r=e.figures;return i.map(function(n,a){var s={},o=n.close;return t.forEach(function(l,u){var c=l-1;if(a>=c){var h=Hr(i.slice(a-c,a+1),"high","low"),f=h[0],d=h[1],v=f-d;s[r[u].key]=v===0?0:(o-f)/v*100}}),s})}},Gr={},Ln=[ln,un,cn,vn,dn,fn,pn,gn,mn,_n,yn,Sn,xn,bn,wn,Cn,In,En,Pn,Mn,Tn,Dn,An,kn,Fn,Rn,Bn];Ln.forEach(function(i){Gr[i.name]=Zi.extend(i)});function $r(i){var e;return(e=Gr[i])!==null&&e!==void 0?e:null}var Vn=function(){function i(e){this._instances=new Map,this._chartStore=e}return i.prototype._overrideInstance=function(e,t){var r=t.shortName,n=t.series,a=t.calcParams,s=t.precision,o=t.figures,l=t.minValue,u=t.maxValue,c=t.shouldOhlc,h=t.shouldFormatBigNumber,f=t.visible,d=t.zLevel,v=t.styles,p=t.extendData,g=t.regenerateFigures,m=t.createTooltipDataSource,_=t.draw,S=t.calc,y=!1;O(r)&&e.setShortName(r)&&(y=!0),T(n)&&e.setSeries(n)&&(y=!0);var x=!1;Ct(a)&&e.setCalcParams(a)&&(y=!0,x=!0),Ct(o)&&e.setFigures(o)&&(y=!0,x=!0),l!==void 0&&e.setMinValue(l)&&(y=!0),u!==void 0&&e.setMinValue(u)&&(y=!0),R(s)&&e.setPrecision(s)&&(y=!0),Qt(c)&&e.setShouldOhlc(c)&&(y=!0),Qt(h)&&e.setShouldFormatBigNumber(h)&&(y=!0),Qt(f)&&e.setVisible(f)&&(y=!0);var w=!1;return R(d)&&e.setZLevel(d)&&(y=!0,w=!0),T(v)&&e.setStyles(v)&&(y=!0),p!==void 0&&e.setExtendData(p)&&(y=!0,x=!0),g!==void 0&&e.setRegenerateFigures(g)&&(y=!0),m!==void 0&&e.setCreateTooltipDataSource(m)&&(y=!0),_!==void 0&&e.setDraw(_)&&(y=!0),Ft(S)&&(e.calc=S,x=!0),[y,x,w]},i.prototype._sort=function(e){var t;O(e)?(t=this._instances.get(e))===null||t===void 0||t.sort(function(r,n){return r.zLevel-n.zLevel}):this._instances.forEach(function(r){r.sort(function(n,a){return n.zLevel-a.zLevel})})},i.prototype.addInstance=function(e,t,r){return ne(this,void 0,void 0,function(){var n,a,s,o,l;return ae(this,function(u){switch(u.label){case 0:return n=e.name,a=this._instances.get(t),T(a)?(s=a.find(function(c){return c.name===n}),T(s)?[4,Promise.reject(new Error("Duplicate indicators."))]:[3,2]):[3,2];case 1:return[2,u.sent()];case 2:return T(a)||(a=[]),o=$r(n),l=new o,this.synchronizeSeriesPrecision(l),this._overrideInstance(l,e),r||(a=[]),a.push(l),this._instances.set(t,a),this._sort(t),[4,l.calcIndicator(this._chartStore.getDataList())];case 3:return[2,u.sent()]}})})},i.prototype.getInstances=function(e){var t;return(t=this._instances.get(e))!==null&&t!==void 0?t:[]},i.prototype.removeInstance=function(e,t){var r,n=!1,a=this._instances.get(e);if(T(a)){if(O(t)){var s=a.findIndex(function(o){return o.name===t});s>-1&&(a.splice(s,1),n=!0)}else this._instances.set(e,[]),n=!0;((r=this._instances.get(e))===null||r===void 0?void 0:r.length)===0&&this._instances.delete(e)}return n},i.prototype.hasInstances=function(e){return this._instances.has(e)},i.prototype.calcInstance=function(e,t){return ne(this,void 0,void 0,function(){var r,n,a,s,o=this;return ae(this,function(l){switch(l.label){case 0:return r=[],O(e)?O(t)?(n=this._instances.get(t),T(n)&&(a=n.find(function(u){return u.name===e}),T(a)&&r.push(a.calcIndicator(this._chartStore.getDataList())))):this._instances.forEach(function(u){var c=u.find(function(h){return h.name===e});T(c)&&r.push(c.calcIndicator(o._chartStore.getDataList()))}):this._instances.forEach(function(u){u.forEach(function(c){r.push(c.calcIndicator(o._chartStore.getDataList()))})}),[4,Promise.all(r)];case 1:return s=l.sent(),[2,s.includes(!0)]}})})},i.prototype.getInstanceByPaneId=function(e,t){var r,n,a=function(l){var u=new Map;return l.forEach(function(c){u.set(c.name,c)}),u};if(O(e)){var s=(r=this._instances.get(e))!==null&&r!==void 0?r:[];return O(t)?(n=s==null?void 0:s.find(function(l){return l.name===t}))!==null&&n!==void 0?n:null:a(s)}var o=new Map;return this._instances.forEach(function(l,u){o.set(u,a(l))}),o},i.prototype.synchronizeSeriesPrecision=function(e){var t=this._chartStore.getPrecision(),r=t.price,n=t.volume,a=function(s){switch(s.series){case vt.Price:{s.setPrecision(r,!0);break}case vt.Volume:{s.setPrecision(n,!0);break}}};T(e)?a(e):this._instances.forEach(function(s){s.forEach(function(o){a(o)})})},i.prototype.override=function(e,t){return ne(this,void 0,void 0,function(){var r,n,a,s,o,l,u,c=this;return ae(this,function(h){switch(h.label){case 0:return r=e.name,n=new Map,t!==null?(a=this._instances.get(t),T(a)&&n.set(t,a)):n=this._instances,s=!1,o=[],l=!1,n.forEach(function(f){var d=f.find(function(p){return p.name===r});if(T(d)){var v=c._overrideInstance(d,e);v[2]&&(l=!0),v[1]?o.push(d.calcIndicator(c._chartStore.getDataList())):v[0]&&(s=!0)}}),l&&this._sort(),[4,Promise.all(o)];case 1:return u=h.sent(),[2,[s,u.includes(!0)]]}})})},i}(),On=function(){function i(e){this._crosshair={},this._activeIcon=null,this._chartStore=e}return i.prototype.setCrosshair=function(e,t){var r=t??{},n=r.notInvalidate,a=r.notExecuteAction,s=this._chartStore.getDataList(),o=e??{},l,u;R(o.x)?(l=this._chartStore.getTimeScaleStore().coordinateToDataIndex(o.x),l<0?u=0:l>s.length-1?u=s.length-1:u=l):(l=s.length-1,u=l);var c=s[u],h=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(l),f={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair=B(B({},o),{realX:h,kLineData:c,realDataIndex:l,dataIndex:u}),(f.x!==o.x||f.y!==o.y||f.paneId!==o.paneId)&&(c!==null&&!(a??!1)&&this._chartStore.getChart().crosshairChange(this._crosshair),(n??!1)||this._chartStore.getChart().updatePane(1))},i.prototype.recalculateCrosshair=function(e){this.setCrosshair(this._crosshair,{notInvalidate:e})},i.prototype.getCrosshair=function(){return this._crosshair},i.prototype.setActiveIcon=function(e){this._activeIcon=e??null},i.prototype.getActiveIcon=function(){return this._activeIcon},i.prototype.clear=function(){this.setCrosshair({},{notInvalidate:!0}),this.setActiveIcon()},i}(),Nn={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e,t=i.coordinates,r=i.bounding,n=i.overlay,a=i.precision,s=i.thousandsSeparator,o=i.decimalFoldThreshold,l=i.yAxis,u=n.points;if(t.length>0){var c=!((e=l==null?void 0:l.isInCandle())!==null&&e!==void 0)||e?a.price:a.excludePriceVolumeMax,h=[],f=[],d=0,v=r.width;if(t.length>1&&R(u[0].value)&&R(u[1].value)){var p=[1,.786,.618,.5,.382,.236,0],g=t[0].y-t[1].y,m=u[0].value-u[1].value;p.forEach(function(_){var S,y=t[1].y+g*_,x=nt(rt((((S=u[1].value)!==null&&S!==void 0?S:0)+m*_).toFixed(c),s),o);h.push({coordinates:[{x:d,y},{x:v,y}]}),f.push({x:d,y,text:"".concat(x," (").concat((_*100).toFixed(1),"%)"),baseline:"bottom"})})}return[{type:"line",attrs:h},{type:"text",isCheckEvent:!1,attrs:f}]}return[]}},zn={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding,r={x:0,y:e[0].y};return T(e[1])&&e[0].x<e[1].x&&(r.x=t.width),[{type:"line",attrs:{coordinates:[e[0],r]}}]},performEventPressedMove:function(i){var e=i.points,t=i.performPoint;e[0].value=t.value,e[1].value=t.value},performEventMoveForDrawing:function(i){var e=i.currentStep,t=i.points,r=i.performPoint;e===2&&(t[0].value=r.value)}},Wn={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=[];return e.length===2&&t.push({coordinates:e}),[{type:"line",attrs:t}]},performEventPressedMove:function(i){var e=i.points,t=i.performPoint;e[0].value=t.value,e[1].value=t.value},performEventMoveForDrawing:function(i){var e=i.currentStep,t=i.points,r=i.performPoint;e===2&&(t[0].value=r.value)}},Xn={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return[{type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]}}]}},Je=function(){function i(){this._children=[],this._callbacks=new Map}return i.prototype.registerEvent=function(e,t){return this._callbacks.set(e,t),this},i.prototype.onEvent=function(e,t,r){var n=this._callbacks.get(e);return T(n)&&this.checkEventOn(t)?n(t,r):!1},i.prototype.checkEventOn=function(e){var t,r;try{for(var n=Jt(this._children),a=n.next();!a.done;a=n.next()){var s=a.value;if(s.checkEventOn(e))return!0}}catch(o){t={error:o}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!1},i.prototype.dispatchEvent=function(e,t,r){var n=this._children.length-1;if(n>-1){for(var a=n;a>-1;a--)if(this._children[a].dispatchEvent(e,t,r))return!0}return this.onEvent(e,t,r)},i.prototype.addChild=function(e){return this._children.push(e),this},i.prototype.clear=function(){this._children=[]},i}(),it=2,Yn=function(i){N(e,i);function e(t){var r=i.call(this)||this;return r.attrs=t.attrs,r.styles=t.styles,r}return e.prototype.checkEventOn=function(t){return this.checkEventOnImp(t,this.attrs,this.styles)},e.prototype.setAttrs=function(t){return this.attrs=t,this},e.prototype.setStyles=function(t){return this.styles=t,this},e.prototype.draw=function(t){this.drawImp(t,this.attrs,this.styles)},e.extend=function(t){var r=function(n){N(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a.prototype.checkEventOnImp=function(s,o,l){return t.checkEventOn(s,o,l)},a.prototype.drawImp=function(s,o,l){t.draw(s,o,l)},a}(e);return r},e}(Je);function Hn(i,e){var t=[];t=t.concat(e);for(var r=0;r<t.length;r++){var n=t[r].coordinates;if(n.length>1)for(var a=1;a<n.length;a++){var s=n[a-1],o=n[a];if(s.x===o.x){if(Math.abs(s.y-i.y)+Math.abs(o.y-i.y)-Math.abs(s.y-o.y)<it+it&&Math.abs(i.x-s.x)<it)return!0}else{var l=tr(s,o),u=Ur(l,i),c=Math.abs(u-i.y);if(Math.abs(s.x-i.x)+Math.abs(o.x-i.x)-Math.abs(s.x-o.x)<it+it&&c*c/(l[0]*l[0]+1)<it*it)return!0}}}return!1}function Ur(i,e){return i!==null?e.x*i[0]+i[1]:e.y}function Me(i,e,t){var r=tr(i,e);return Ur(r,t)}function tr(i,e){var t=i.x-e.x;if(t!==0){var r=(i.y-e.y)/t,n=i.y-r*i.x;return[r,n]}return null}function jr(i,e,t){var r=e.length,n=R(t)?t>0&&t<1?t:0:t?.5:0;if(n>0&&r>2){for(var a=e[0].x,s=e[0].y,o=1;o<r-1;o++){var l=e[o-1],u=e[o],c=e[o+1],h=u.x-l.x,f=u.y-l.y,d=c.x-u.x,v=c.y-u.y,p=c.x-l.x,g=c.y-l.y,m=Math.sqrt(h*h+f*f),_=Math.sqrt(d*d+v*v),S=_/(_+m),y=u.x+p*n*S,x=u.y+g*n*S;y=Math.min(y,Math.max(c.x,u.x)),x=Math.min(x,Math.max(c.y,u.y)),y=Math.max(y,Math.min(c.x,u.x)),x=Math.max(x,Math.min(c.y,u.y)),p=y-u.x,g=x-u.y;var w=u.x-p*m/_,b=u.y-g*m/_;w=Math.min(w,Math.max(l.x,u.x)),b=Math.min(b,Math.max(l.y,u.y)),w=Math.max(w,Math.min(l.x,u.x)),b=Math.max(b,Math.min(l.y,u.y)),p=u.x-w,g=u.y-b,y=u.x+p*_/m,x=u.y+g*_/m,i.bezierCurveTo(a,s,w,b,u.x,u.y),a=y,s=x}var I=e[r-1];i.bezierCurveTo(a,s,I.x,I.y,I.x,I.y)}else for(var o=1;o<r;o++)i.lineTo(e[o].x,e[o].y)}function Gn(i,e,t){var r=[];r=r.concat(e);var n=t.style,a=n===void 0?G.Solid:n,s=t.smooth,o=s===void 0?!1:s,l=t.size,u=l===void 0?1:l,c=t.color,h=c===void 0?"currentColor":c,f=t.dashedValue,d=f===void 0?[2,2]:f;i.lineWidth=u,i.strokeStyle=h,a===G.Dashed?i.setLineDash(d):i.setLineDash([]);var v=u%2===1?.5:0;r.forEach(function(p){var g=p.coordinates;g.length>1&&(g.length===2&&(g[0].x===g[1].x||g[0].y===g[1].y)?(i.beginPath(),g[0].x===g[1].x?(i.moveTo(g[0].x+v,g[0].y),i.lineTo(g[1].x+v,g[1].y)):(i.moveTo(g[0].x,g[0].y+v),i.lineTo(g[1].x,g[1].y+v)),i.stroke(),i.closePath()):(i.save(),u%2===1&&i.translate(.5,.5),i.beginPath(),i.moveTo(g[0].x,g[0].y),jr(i,g,o),i.stroke(),i.closePath(),i.restore()))})}var $n={name:"line",checkEventOn:Hn,draw:function(i,e,t){Gn(i,e,t)}};function Zr(i,e,t){var r=t??0,n=[];if(i.length>1)if(i[0].x===i[1].x){var a=0,s=e.height;if(n.push({coordinates:[{x:i[0].x,y:a},{x:i[0].x,y:s}]}),i.length>2){n.push({coordinates:[{x:i[2].x,y:a},{x:i[2].x,y:s}]});for(var o=i[0].x-i[2].x,l=0;l<r;l++){var u=o*(l+1);n.push({coordinates:[{x:i[0].x+u,y:a},{x:i[0].x+u,y:s}]})}}}else{var c=0,h=e.width,f=tr(i[0],i[1]),d=f[0],v=f[1];if(n.push({coordinates:[{x:c,y:c*d+v},{x:h,y:h*d+v}]}),i.length>2){var p=i[2].y-d*i[2].x;n.push({coordinates:[{x:c,y:c*d+p},{x:h,y:h*d+p}]});for(var o=v-p,l=0;l<r;l++){var g=v+o*(l+1);n.push({coordinates:[{x:c,y:c*d+g},{x:h,y:h*d+g}]})}}}return n}var Un={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return[{type:"line",attrs:Zr(e,t)}]}},jn={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return[{type:"line",attrs:Zr(e,t,1)}]}},Zn={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e,t=i.coordinates,r=i.bounding,n=i.precision,a=i.overlay,s=i.thousandsSeparator,o=i.decimalFoldThreshold,l=i.yAxis,u=a.points[0].value,c=u===void 0?0:u,h=!((e=l==null?void 0:l.isInCandle())!==null&&e!==void 0)||e?n.price:n.excludePriceVolumeMax;return[{type:"line",attrs:{coordinates:[t[0],{x:r.width,y:t[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:t[0].x,y:t[0].y,text:nt(rt(c.toFixed(h),s),o),baseline:"bottom"}}]}};function qn(i,e){if(i.length>1){var t=void 0;return i[0].x===i[1].x&&i[0].y!==i[1].y?i[0].y<i[1].y?t={x:i[0].x,y:e.height}:t={x:i[0].x,y:0}:i[0].x>i[1].x?t={x:0,y:Me(i[0],i[1],{x:0,y:i[0].y})}:t={x:e.width,y:Me(i[0],i[1],{x:e.width,y:i[0].y})},{coordinates:[i[0],t]}}return[]}var Kn={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return[{type:"line",attrs:qn(e,t)}]}},Qn={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates;return e.length===2?[{type:"line",attrs:{coordinates:e}}]:[]}},Jn={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return e.length===2?e[0].x===e[1].x?[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:t.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Me(e[0],e[1],{x:0,y:e[0].y})},{x:t.width,y:Me(e[0],e[1],{x:t.width,y:e[0].y})}]}}]:[]}},ta={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;if(e.length===2){var r={x:e[0].x,y:0};return e[0].y<e[1].y&&(r.y=t.height),[{type:"line",attrs:{coordinates:[e[0],r]}}]}return[]},performEventPressedMove:function(i){var e=i.points,t=i.performPoint;e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex,e[1].timestamp=t.timestamp,e[1].dataIndex=t.dataIndex},performEventMoveForDrawing:function(i){var e=i.currentStep,t=i.points,r=i.performPoint;e===2&&(t[0].timestamp=r.timestamp,t[0].dataIndex=r.dataIndex)}},ea={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates;return e.length===2?[{type:"line",attrs:{coordinates:e}}]:[]},performEventPressedMove:function(i){var e=i.points,t=i.performPoint;e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex,e[1].timestamp=t.timestamp,e[1].dataIndex=t.dataIndex},performEventMoveForDrawing:function(i){var e=i.currentStep,t=i.points,r=i.performPoint;e===2&&(t[0].timestamp=r.timestamp,t[0].dataIndex=r.dataIndex)}},ra={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(i){var e=i.coordinates,t=i.bounding;return[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:t.height}]}}]}},ia={name:"simpleAnnotation",totalStep:2,styles:{line:{style:G.Dashed}},createPointFigures:function(i){var e,t=i.overlay,r=i.coordinates,n;T(t.extendData)&&(Ft(t.extendData)?n=t.extendData(t):n=(e=t.extendData)!==null&&e!==void 0?e:"");var a=r[0].x,s=r[0].y-6,o=s-50,l=o-5;return[{type:"line",attrs:{coordinates:[{x:a,y:s},{x:a,y:o}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:a,y:o},{x:a-4,y:l},{x:a+4,y:l}]},ignoreEvent:!0},{type:"text",attrs:{x:a,y:l,text:n??"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},na={name:"simpleTag",totalStep:2,styles:{line:{style:G.Dashed}},createPointFigures:function(i){var e=i.bounding,t=i.coordinates;return{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]},ignoreEvent:!0}},createYAxisFigures:function(i){var e,t,r=i.overlay,n=i.coordinates,a=i.bounding,s=i.yAxis,o=i.precision,l=(e=s==null?void 0:s.isFromZero())!==null&&e!==void 0?e:!1,u,c;l?(u="left",c=0):(u="right",c=a.width);var h;return T(r.extendData)&&(Ft(r.extendData)?h=r.extendData(r):h=(t=r.extendData)!==null&&t!==void 0?t:""),!T(h)&&R(r.points[0].value)&&(h=Q(r.points[0].value,o.price)),{type:"text",attrs:{x:c,y:n[0].y,text:h??"",align:u,baseline:"middle"}}}},qr={},aa=[Nn,zn,Wn,Xn,Un,jn,Zn,Kn,Qn,Jn,ta,ea,ra,ia,na];aa.forEach(function(i){qr[i.name]=Qi.extend(i)});function oa(i){var e;return(e=qr[i])!==null&&e!==void 0?e:null}var sa=30,la=100,Y={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},ua=function(){function i(e){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._chartStore=e}return i.prototype._overrideInstance=function(e,t){var r=t.id,n=t.groupId,a=t.points,s=t.styles,o=t.lock,l=t.visible,u=t.zLevel,c=t.mode,h=t.modeSensitivity,f=t.extendData,d=t.onDrawStart,v=t.onDrawing,p=t.onDrawEnd,g=t.onClick,m=t.onDoubleClick,_=t.onRightClick,S=t.onPressedMoveStart,y=t.onPressedMoving,x=t.onPressedMoveEnd,w=t.onMouseEnter,b=t.onMouseLeave,I=t.onRemoved,C=t.onSelected,P=t.onDeselected,M=!1,E=!1;return O(r)&&e.setId(r),O(n)&&e.setGroupId(n),Ct(a)&&e.setPoints(a)&&(M=!0),T(s)&&e.setStyles(s)&&(M=!0),Qt(o)&&e.setLock(o),Qt(l)&&e.setVisible(l)&&(M=!0),R(u)&&e.setZLevel(u)&&(M=!0,E=!0),T(c)&&e.setMode(c),R(h)&&e.setModeSensitivity(h),f!==void 0&&e.setExtendData(f)&&(M=!0),d!==void 0&&e.setOnDrawStartCallback(d),v!==void 0&&e.setOnDrawingCallback(v),p!==void 0&&e.setOnDrawEndCallback(p),g!==void 0&&e.setOnClickCallback(g),m!==void 0&&e.setOnDoubleClickCallback(m),_!==void 0&&e.setOnRightClickCallback(_),S!==void 0&&e.setOnPressedMoveStartCallback(S),y!==void 0&&e.setOnPressedMovingCallback(y),x!==void 0&&e.setOnPressedMoveEndCallback(x),w!==void 0&&e.setOnMouseEnterCallback(w),b!==void 0&&e.setOnMouseLeaveCallback(b),I!==void 0&&e.setOnRemovedCallback(I),C!==void 0&&e.setOnSelectedCallback(C),P!==void 0&&e.setOnDeselectedCallback(P),[M,E]},i.prototype.getInstanceById=function(e){var t,r;try{for(var n=Jt(this._instances),a=n.next();!a.done;a=n.next()){var s=a.value,o=s[1],l=o.find(function(u){return u.id===e});if(T(l))return l}}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this._progressInstanceInfo!==null&&this._progressInstanceInfo.instance.id===e?this._progressInstanceInfo.instance:null},i.prototype._sort=function(e){var t;O(e)?(t=this._instances.get(e))===null||t===void 0||t.sort(function(r,n){return r.zLevel-n.zLevel}):this._instances.forEach(function(r){r.sort(function(n,a){return n.zLevel-a.zLevel})})},i.prototype.addInstances=function(e,t,r){var n=this,a=e.map(function(o){var l,u,c,h,f=(l=o.id)!==null&&l!==void 0?l:Yr(Ki);if(n.getInstanceById(f)===null){var d=oa(o.name);if(d!==null){var v=new d;v.setPaneId(t);var p=(u=o.groupId)!==null&&u!==void 0?u:f;return o.id=f,o.groupId=p,n._overrideInstance(v,o),v.isDrawing()?n._progressInstanceInfo={paneId:t,instance:v,appointPaneFlag:r}:(n._instances.has(t)||n._instances.set(t,[]),(c=n._instances.get(t))===null||c===void 0||c.push(v)),v.isStart()&&((h=v.onDrawStart)===null||h===void 0||h.call(v,{overlay:v})),f}}return null});if(a.some(function(o){return o!==null})){this._sort();var s=this._chartStore.getChart();s.updatePane(1,t),s.updatePane(1,Y.X_AXIS)}return a},i.prototype.getProgressInstanceInfo=function(){return this._progressInstanceInfo},i.prototype.progressInstanceComplete=function(){var e;if(this._progressInstanceInfo!==null){var t=this._progressInstanceInfo,r=t.instance,n=t.paneId;r.isDrawing()||(this._instances.has(n)||this._instances.set(n,[]),(e=this._instances.get(n))===null||e===void 0||e.push(r),this._sort(n),this._progressInstanceInfo=null)}},i.prototype.updateProgressInstanceInfo=function(e,t){this._progressInstanceInfo!==null&&(Qt(t)&&t&&(this._progressInstanceInfo.appointPaneFlag=t),this._progressInstanceInfo.paneId=e,this._progressInstanceInfo.instance.setPaneId(e))},i.prototype.getInstances=function(e){var t;if(!O(e)){var r=[];return this._instances.forEach(function(n){r=r.concat(n)}),r}return(t=this._instances.get(e))!==null&&t!==void 0?t:[]},i.prototype.override=function(e){var t=this,r=e.id,n=e.groupId,a=e.name,s=!1,o=!1,l=function(d){var v=t._overrideInstance(d,e);v[0]&&(s=!0),v[1]&&(o=!0)};if(O(r)){var u=this.getInstanceById(r);u!==null&&l(u)}else{var c=O(a),h=O(n);if(this._instances.forEach(function(d){d.forEach(function(v){(c&&v.name===a||h&&v.groupId===n||!c&&!h)&&l(v)})}),this._progressInstanceInfo!==null){var f=this._progressInstanceInfo.instance;(c&&f.name===a||h&&f.groupId===n||!c&&!h)&&l(f)}}o&&this._sort(),s&&this._chartStore.getChart().updatePane(1)},i.prototype.removeInstance=function(e){var t,r,n,a=function(p,g){if(O(p.id)){if(g.id!==p.id)return!1}else if(O(p.groupId)){if(g.groupId!==p.groupId)return!1}else if(O(p.name)&&g.name!==p.name)return!1;return!0},s=[],o=T(e);if(this._progressInstanceInfo!==null){var l=this._progressInstanceInfo.instance;(!o||o&&a(e,l))&&(s.push(this._progressInstanceInfo.paneId),(n=l.onRemoved)===null||n===void 0||n.call(l,{overlay:l}),this._progressInstanceInfo=null)}if(o){var u=new Map,c=function(p){var g=p[1],m=g.filter(function(_){var S;return a(e,_)?(s.includes(p[0])||s.push(p[0]),(S=_.onRemoved)===null||S===void 0||S.call(_,{overlay:_}),!1):!0});m.length>0&&u.set(p[0],m)};try{for(var h=Jt(this._instances),f=h.next();!f.done;f=h.next()){var d=f.value;c(d)}}catch(p){t={error:p}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}this._instances=u}else this._instances.forEach(function(p,g){s.push(g),p.forEach(function(m){var _;(_=m.onRemoved)===null||_===void 0||_.call(m,{overlay:m})})}),this._instances.clear();if(s.length>0){var v=this._chartStore.getChart();s.forEach(function(p){v.updatePane(1,p)}),v.updatePane(1,Y.X_AXIS)}},i.prototype.setPressedInstanceInfo=function(e){this._pressedInstanceInfo=e},i.prototype.getPressedInstanceInfo=function(){return this._pressedInstanceInfo},i.prototype.updatePointPosition=function(e,t){if(e>0){var r=this._chartStore.getDataList();this._instances.forEach(function(n){n.forEach(function(a){var s=a.points;s.forEach(function(o){if(!T(o.timestamp)&&T(o.dataIndex)){t===mt.Forward&&(o.dataIndex=o.dataIndex+e);var l=r[o.dataIndex];o.timestamp=l==null?void 0:l.timestamp}})})})}},i.prototype.setHoverInstanceInfo=function(e,t){var r,n,a=this._hoverInstanceInfo,s=a.instance,o=a.figureType,l=a.figureKey,u=a.figureIndex;if(((s==null?void 0:s.id)!==((r=e.instance)===null||r===void 0?void 0:r.id)||o!==e.figureType||u!==e.figureIndex)&&(this._hoverInstanceInfo=e,(s==null?void 0:s.id)!==((n=e.instance)===null||n===void 0?void 0:n.id))){var c=!1,h=!1;s!==null&&(h=!0,Ft(s.onMouseLeave)&&(s.onMouseLeave(B({overlay:s,figureKey:l,figureIndex:u},t)),c=!0)),e.instance!==null&&(h=!0,Ft(e.instance.onMouseEnter)&&(e.instance.onMouseEnter(B({overlay:e.instance,figureKey:e.figureKey,figureIndex:e.figureIndex},t)),c=!0)),h&&this._sort(),c||this._chartStore.getChart().updatePane(1)}},i.prototype.getHoverInstanceInfo=function(){return this._hoverInstanceInfo},i.prototype.setClickInstanceInfo=function(e,t){var r,n,a,s,o,l,u,c,h,f=this._clickInstanceInfo,d=f.paneId,v=f.instance,p=f.figureType,g=f.figureKey,m=f.figureIndex;if((n=(r=e.instance)===null||r===void 0?void 0:r.isDrawing())!==null&&n!==void 0&&n||(s=(a=e.instance)===null||a===void 0?void 0:a.onClick)===null||s===void 0||s.call(a,B({overlay:e.instance,figureKey:e.figureKey,figureIndex:e.figureIndex},t)),((v==null?void 0:v.id)!==((o=e.instance)===null||o===void 0?void 0:o.id)||p!==e.figureType||m!==e.figureIndex)&&(this._clickInstanceInfo=e,(v==null?void 0:v.id)!==((l=e.instance)===null||l===void 0?void 0:l.id))){(u=v==null?void 0:v.onDeselected)===null||u===void 0||u.call(v,B({overlay:v,figureKey:g,figureIndex:m},t)),(h=(c=e.instance)===null||c===void 0?void 0:c.onSelected)===null||h===void 0||h.call(c,B({overlay:e.instance,figureKey:e.figureKey,figureIndex:e.figureIndex},t));var _=this._chartStore.getChart();_.updatePane(1,e.paneId),d!==e.paneId&&_.updatePane(1,d),_.updatePane(1,Y.X_AXIS)}},i.prototype.getClickInstanceInfo=function(){return this._clickInstanceInfo},i.prototype.isEmpty=function(){return this._instances.size===0&&this._progressInstanceInfo===null},i.prototype.isDrawing=function(){var e,t;return this._progressInstanceInfo!==null&&((t=(e=this._progressInstanceInfo)===null||e===void 0?void 0:e.instance.isDrawing())!==null&&t!==void 0?t:!1)},i}(),ca=function(){function i(){this._actions=new Map}return i.prototype.execute=function(e,t){var r;(r=this._actions.get(e))===null||r===void 0||r.execute(t)},i.prototype.subscribe=function(e,t){var r;this._actions.has(e)||this._actions.set(e,new ji),(r=this._actions.get(e))===null||r===void 0||r.subscribe(t)},i.prototype.unsubscribe=function(e,t){var r=this._actions.get(e);T(r)&&(r.unsubscribe(t),r.isEmpty()&&this._actions.delete(e))},i.prototype.has=function(e){var t=this._actions.get(e);return T(t)&&!t.isEmpty()},i}(),ha={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},va={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},da={light:ha,dark:va};function Kr(i){var e;return(e=da[i])!==null&&e!==void 0?e:null}var fa=function(){function i(e,t){this._styles=Yi(),this._customApi=Ji(),this._locale=tn,this._precision={price:2,volume:0},this._thousandsSeparator=",",this._decimalFoldThreshold=3,this._dataList=[],this._loadMoreCallback=null,this._loadDataCallback=null,this._loading=!0,this._forwardMore=!0,this._backwardMore=!0,this._timeScaleStore=new sn(this),this._indicatorStore=new Vn(this),this._overlayStore=new ua(this),this._tooltipStore=new On(this),this._actionStore=new ca,this._visibleDataList=[],this._chart=e,this.setOptions(t)}return i.prototype.adjustVisibleDataList=function(){this._visibleDataList=[];for(var e=this._timeScaleStore.getVisibleRange(),t=e.realFrom,r=e.realTo,n=t;n<r;n++){var a=this._dataList[n],s=this._timeScaleStore.dataIndexToCoordinate(n);this._visibleDataList.push({dataIndex:n,x:s,data:a})}},i.prototype.setOptions=function(e){var t,r,n,a;if(T(e)){var s=e.locale,o=e.timezone,l=e.styles,u=e.customApi,c=e.thousandsSeparator,h=e.decimalFoldThreshold;if(O(s)&&(this._locale=s),O(o)&&this._timeScaleStore.setTimezone(o),T(l)){var f=null;O(l)?f=Kr(l):f=l,yt(this._styles,f),Ct((r=(t=f==null?void 0:f.candle)===null||t===void 0?void 0:t.tooltip)===null||r===void 0?void 0:r.custom)&&(this._styles.candle.tooltip.custom=(a=(n=f==null?void 0:f.candle)===null||n===void 0?void 0:n.tooltip)===null||a===void 0?void 0:a.custom)}T(u)&&yt(this._customApi,u),O(c)&&(this._thousandsSeparator=c),R(h)&&h>0&&(this._decimalFoldThreshold=h)}return this},i.prototype.getStyles=function(){return this._styles},i.prototype.getLocale=function(){return this._locale},i.prototype.getCustomApi=function(){return this._customApi},i.prototype.getThousandsSeparator=function(){return this._thousandsSeparator},i.prototype.getDecimalFoldThreshold=function(){return this._decimalFoldThreshold},i.prototype.getPrecision=function(){return this._precision},i.prototype.setPrecision=function(e){return this._precision=e,this._indicatorStore.synchronizeSeriesPrecision(),this},i.prototype.getDataList=function(){return this._dataList},i.prototype.getVisibleFirstData=function(){var e,t=this._timeScaleStore.getVisibleRange().from;return(e=this._dataList[t])!==null&&e!==void 0?e:null},i.prototype.getVisibleDataList=function(){return this._visibleDataList},i.prototype.addData=function(e,t,r){return ne(this,void 0,void 0,function(){var n,a,s,o,l,u,c;return ae(this,function(h){switch(h.label){case 0:if(n=!1,a=!1,s=0,Ct(e)){switch(s=e.length,t){case mt.Init:{this.clear(),this._dataList=e,this._forwardMore=r??!0,this._timeScaleStore.resetOffsetRightDistance(),a=!0;break}case mt.Backward:{this._dataList=this._dataList.concat(e),this._backwardMore=r??!1,a=s>0;break}case mt.Forward:this._dataList=e.concat(this._dataList),this._forwardMore=r??!1,a=s>0}this._loading=!1,n=!0}else o=this._dataList.length,l=e.timestamp,u=ot(this._dataList[o-1],"timestamp",0),l>u?(this._dataList.push(e),c=this._timeScaleStore.getLastBarRightSideDiffBarCount(),c<0&&this._timeScaleStore.setLastBarRightSideDiffBarCount(--c),s=1,n=!0,a=!0):l===u&&(this._dataList[o-1]=e,n=!0,a=!0);if(!n)return[3,5];h.label=1;case 1:return h.trys.push([1,4,,5]),this._overlayStore.updatePointPosition(s,t),a?(this._timeScaleStore.adjustVisibleRange(),this._tooltipStore.recalculateCrosshair(!0),[4,this._indicatorStore.calcInstance()]):[3,3];case 2:h.sent(),this._chart.adjustPaneViewport(!1,!0,!0,!0),h.label=3;case 3:return this._actionStore.execute(_t.OnDataReady),[3,5];case 4:return h.sent(),[3,5];case 5:return[2]}})})},i.prototype.setLoadMoreCallback=function(e){this._loadMoreCallback=e},i.prototype.executeLoadMoreCallback=function(e){this._forwardMore&&!this._loading&&T(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(e))},i.prototype.setLoadDataCallback=function(e){this._loadDataCallback=e},i.prototype.executeLoadDataCallback=function(e){var t=this;if(!this._loading&&T(this._loadDataCallback)&&(this._forwardMore&&e.type===mt.Forward||this._backwardMore&&e.type===mt.Backward)){var r=function(n,a){t.addData(n,e.type,a).then(function(){}).catch(function(){})};this._loading=!0,this._loadDataCallback(B(B({},e),{callback:r}))}},i.prototype.clear=function(){this._forwardMore=!0,this._backwardMore=!0,this._loading=!0,this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear(),this._tooltipStore.clear()},i.prototype.getTimeScaleStore=function(){return this._timeScaleStore},i.prototype.getIndicatorStore=function(){return this._indicatorStore},i.prototype.getOverlayStore=function(){return this._overlayStore},i.prototype.getTooltipStore=function(){return this._tooltipStore},i.prototype.getActionStore=function(){return this._actionStore},i.prototype.getChart=function(){return this._chart},i}(),z={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},ge=7;function pa(){return ne(this,void 0,void 0,function(){return ae(this,function(i){switch(i.label){case 0:return[4,new Promise(function(e){var t=new ResizeObserver(function(r){e(r.every(function(n){return"devicePixelContentBoxSize"in n})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})];case 1:return[2,i.sent()]}})})}var yr=function(){function i(e,t){var r=this;this._supportedDevicePixelContentBox=!1,this._width=0,this._height=0,this._pixelWidth=0,this._pixelHeight=0,this._nextPixelWidth=0,this._nextPixelHeight=0,this._requestAnimationId=We,this._mediaQueryListener=function(){var n=Yt(r._element);r._nextPixelWidth=Math.round(r._element.clientWidth*n),r._nextPixelHeight=Math.round(r._element.clientHeight*n),r._resetPixelRatio()},this._listener=t,this._element=Rt("canvas",e),this._ctx=this._element.getContext("2d",{willReadFrequently:!0}),pa().then(function(n){r._supportedDevicePixelContentBox=n,n?(r._resizeObserver=new ResizeObserver(function(a){var s,o=a.find(function(u){return u.target===r._element}),l=(s=o==null?void 0:o.devicePixelContentBoxSize)===null||s===void 0?void 0:s[0];T(l)&&(r._nextPixelWidth=l.inlineSize,r._nextPixelHeight=l.blockSize,(r._pixelWidth!==r._nextPixelWidth||r._pixelHeight!==r._nextPixelHeight)&&r._resetPixelRatio())}),r._resizeObserver.observe(r._element,{box:"device-pixel-content-box"})):(r._mediaQueryList=window.matchMedia("(resolution: ".concat(Yt(r._element),"dppx)")),r._mediaQueryList.addListener(r._mediaQueryListener))}).catch(function(n){return!1})}return i.prototype._resetPixelRatio=function(){var e=this;this._executeListener(function(){var t=e._element.clientWidth,r=e._element.clientHeight,n=e._nextPixelWidth/t,a=e._nextPixelHeight/r;e._width=t,e._height=r,e._pixelWidth=e._nextPixelWidth,e._pixelHeight=e._nextPixelHeight,e._element.width=e._nextPixelWidth,e._element.height=e._nextPixelHeight,e._ctx.scale(n,a)})},i.prototype._executeListener=function(e){var t=this;this._requestAnimationId===We&&(this._requestAnimationId=Pe(function(){t._ctx.clearRect(0,0,t._width,t._height),e==null||e(),t._listener(),t._requestAnimationId=We}))},i.prototype.update=function(e,t){if(this._width!==e||this._height!==t){if(this._element.style.width="".concat(e,"px"),this._element.style.height="".concat(t,"px"),!this._supportedDevicePixelContentBox){var r=Yt(this._element);this._nextPixelWidth=Math.round(e*r),this._nextPixelHeight=Math.round(t*r),this._resetPixelRatio()}}else this._executeListener()},i.prototype.getElement=function(){return this._element},i.prototype.getContext=function(){return this._ctx},i.prototype.destroy=function(){T(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),T(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)},i}();function Qr(i){var e={width:0,height:0,left:0,right:0,top:0,bottom:0};return T(i)&&yt(e,i),e}var Jr=function(i){N(e,i);function e(t,r){var n=i.call(this)||this;return n._bounding=Qr(),n._pane=r,n._rootContainer=t,n._container=n.createContainer(),t.appendChild(n._container),n}return e.prototype.setBounding=function(t){return yt(this._bounding,t),this},e.prototype.getContainer=function(){return this._container},e.prototype.getBounding=function(){return this._bounding},e.prototype.getPane=function(){return this._pane},e.prototype.update=function(t){this.updateImp(this._container,this._bounding,t??3)},e.prototype.destroy=function(){this._rootContainer.removeChild(this._container)},e}(Je),er=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;n._mainCanvas=new yr({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},function(){n.updateMain(n._mainCanvas.getContext())}),n._overlayCanvas=new yr({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},function(){n.updateOverlay(n._overlayCanvas.getContext())});var a=n.getContainer();return a.appendChild(n._mainCanvas.getElement()),a.appendChild(n._overlayCanvas.getElement()),n}return e.prototype.createContainer=function(){return Rt("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})},e.prototype.updateImp=function(t,r,n){var a=r.width,s=r.height,o=r.left;t.style.left="".concat(o,"px");var l=n,u=t.clientWidth,c=t.clientHeight;switch((a!==u||s!==c)&&(t.style.width="".concat(a,"px"),t.style.height="".concat(s,"px"),l=3),l){case 0:{this._mainCanvas.update(a,s);break}case 1:{this._overlayCanvas.update(a,s);break}case 3:case 4:{this._mainCanvas.update(a,s),this._overlayCanvas.update(a,s);break}}},e.prototype.destroy=function(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()},e.prototype.getImage=function(t){var r=this.getBounding(),n=r.width,a=r.height,s=Rt("canvas",{width:"".concat(n,"px"),height:"".concat(a,"px"),boxSizing:"border-box"}),o=s.getContext("2d"),l=Yt(s);return s.width=n*l,s.height=a*l,o.scale(l,l),o.drawImage(this._mainCanvas.getElement(),0,0,n,a),t&&o.drawImage(this._overlayCanvas.getElement(),0,0,n,a),s},e}(Jr);function ue(i){return i==="transparent"||i==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(i)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(i)}function ga(i,e){var t=[];t=t.concat(e);for(var r=0;r<t.length;r++){var n=t[r],a=n.x,s=n.y,o=n.r,l=i.x-a,u=i.y-s;if(!(l*l+u*u>o*o))return!0}return!1}function ma(i,e,t){var r=[];r=r.concat(e);var n=t.style,a=n===void 0?X.Fill:n,s=t.color,o=s===void 0?"currentColor":s,l=t.borderSize,u=l===void 0?1:l,c=t.borderColor,h=c===void 0?"currentColor":c,f=t.borderStyle,d=f===void 0?G.Solid:f,v=t.borderDashedValue,p=v===void 0?[2,2]:v,g=(a===X.Fill||t.style===X.StrokeFill)&&(!O(o)||!ue(o));g&&(i.fillStyle=o,r.forEach(function(m){var _=m.x,S=m.y,y=m.r;i.beginPath(),i.arc(_,S,y,0,Math.PI*2),i.closePath(),i.fill()})),(a===X.Stroke||t.style===X.StrokeFill)&&u>0&&!ue(h)&&(i.strokeStyle=h,i.lineWidth=u,d===G.Dashed?i.setLineDash(p):i.setLineDash([]),r.forEach(function(m){var _=m.x,S=m.y,y=m.r;(!g||y>u)&&(i.beginPath(),i.arc(_,S,y,0,Math.PI*2),i.closePath(),i.stroke())}))}var _a={name:"circle",checkEventOn:ga,draw:function(i,e,t){ma(i,e,t)}};function ya(i,e){var t=[];t=t.concat(e);for(var r=0;r<t.length;r++){for(var n=!1,a=t[r].coordinates,s=0,o=a.length-1;s<a.length;o=s++)a[s].y>i.y!=a[o].y>i.y&&i.x<(a[o].x-a[s].x)*(i.y-a[s].y)/(a[o].y-a[s].y)+a[s].x&&(n=!n);if(n)return!0}return!1}function Sa(i,e,t){var r=[];r=r.concat(e);var n=t.style,a=n===void 0?X.Fill:n,s=t.color,o=s===void 0?"currentColor":s,l=t.borderSize,u=l===void 0?1:l,c=t.borderColor,h=c===void 0?"currentColor":c,f=t.borderStyle,d=f===void 0?G.Solid:f,v=t.borderDashedValue,p=v===void 0?[2,2]:v;(a===X.Fill||t.style===X.StrokeFill)&&(!O(o)||!ue(o))&&(i.fillStyle=o,r.forEach(function(g){var m=g.coordinates;i.beginPath(),i.moveTo(m[0].x,m[0].y);for(var _=1;_<m.length;_++)i.lineTo(m[_].x,m[_].y);i.closePath(),i.fill()})),(a===X.Stroke||t.style===X.StrokeFill)&&u>0&&!ue(h)&&(i.strokeStyle=h,i.lineWidth=u,d===G.Dashed?i.setLineDash(p):i.setLineDash([]),r.forEach(function(g){var m=g.coordinates;i.beginPath(),i.moveTo(m[0].x,m[0].y);for(var _=1;_<m.length;_++)i.lineTo(m[_].x,m[_].y);i.closePath(),i.stroke()}))}var xa={name:"polygon",checkEventOn:ya,draw:function(i,e,t){Sa(i,e,t)}};function ba(i,e){var t=[];t=t.concat(e);for(var r=0;r<t.length;r++){var n=t[r],a=n.x,s=n.width;s<it*2&&(a-=it,s=it*2);var o=n.y,l=n.height;if(l<it*2&&(o-=it,l=it*2),i.x>=a&&i.x<=a+s&&i.y>=o&&i.y<=o+l)return!0}return!1}function ti(i,e,t){var r,n=[];n=n.concat(e);var a=t.style,s=a===void 0?X.Fill:a,o=t.color,l=o===void 0?"transparent":o,u=t.borderSize,c=u===void 0?1:u,h=t.borderColor,f=h===void 0?"transparent":h,d=t.borderStyle,v=d===void 0?G.Solid:d,p=t.borderRadius,g=p===void 0?0:p,m=t.borderDashedValue,_=m===void 0?[2,2]:m,S=(r=i.roundRect)!==null&&r!==void 0?r:i.rect,y=(s===X.Fill||t.style===X.StrokeFill)&&(!O(l)||!ue(l));if(y&&(i.fillStyle=l,n.forEach(function(b){var I=b.x,C=b.y,P=b.width,M=b.height;i.beginPath(),S.call(i,I,C,P,M,g),i.closePath(),i.fill()})),(s===X.Stroke||t.style===X.StrokeFill)&&c>0&&!ue(f)){i.strokeStyle=f,i.fillStyle=f,i.lineWidth=c,v===G.Dashed?i.setLineDash(_):i.setLineDash([]);var x=c%2===1?.5:0,w=Math.round(x*2);n.forEach(function(b){var I=b.x,C=b.y,P=b.width,M=b.height;P>c*2&&M>c*2?(i.beginPath(),S.call(i,I+x,C+x,P-w,M-w,g),i.closePath(),i.stroke()):y||i.fillRect(I,C,P,M)})}}var wa={name:"rect",checkEventOn:ba,draw:function(i,e,t){ti(i,e,t)}};function ei(i,e){var t=e.size,r=t===void 0?12:t,n=e.paddingLeft,a=n===void 0?0:n,s=e.paddingTop,o=s===void 0?0:s,l=e.paddingRight,u=l===void 0?0:l,c=e.paddingBottom,h=c===void 0?0:c,f=e.weight,d=f===void 0?"normal":f,v=e.family,p=i.x,g=i.y,m=i.text,_=i.align,S=_===void 0?"left":_,y=i.baseline,x=y===void 0?"top":y,w=i.width,b=i.height,I=w??a+Ee(m,r,d,v)+u,C=b??o+r+h,P;switch(S){case"left":case"start":{P=p;break}case"right":case"end":{P=p-I;break}default:{P=p-I/2;break}}var M;switch(x){case"top":case"hanging":{M=g;break}case"bottom":case"ideographic":case"alphabetic":{M=g-C;break}default:{M=g-C/2;break}}return{x:P,y:M,width:I,height:C}}function Ca(i,e,t){var r=[];r=r.concat(e);for(var n=0;n<r.length;n++){var a=ei(r[n],t),s=a.x,o=a.y,l=a.width,u=a.height;if(i.x>=s&&i.x<=s+l&&i.y>=o&&i.y<=o+u)return!0}return!1}function Ia(i,e,t){var r=[];r=r.concat(e);var n=t.color,a=n===void 0?"currentColor":n,s=t.size,o=s===void 0?12:s,l=t.family,u=t.weight,c=t.paddingLeft,h=c===void 0?0:c,f=t.paddingTop,d=f===void 0?0:f,v=t.paddingRight,p=v===void 0?0:v,g=r.map(function(m){return ei(m,t)});ti(i,g,B(B({},t),{color:t.backgroundColor})),i.textAlign="left",i.textBaseline="top",i.font=te(o,u,l),i.fillStyle=a,r.forEach(function(m,_){var S=g[_];i.fillText(m.text,S.x+h,S.y+d,S.width-h-p)})}var ri={name:"text",checkEventOn:Ca,draw:function(i,e,t){Ia(i,e,t)}},Ea=ri;function Pa(i,e){var t=i.x-e.x,r=i.y-e.y;return Math.sqrt(t*t+r*r)}function Ma(i,e){var t=[];t=t.concat(e);for(var r=0;r<t.length;r++){var n=t[r];if(Math.abs(Pa(i,n)-n.r)<it){var a=n.r,s=n.startAngle,o=n.endAngle,l=a*Math.cos(s)+n.x,u=a*Math.sin(s)+n.y,c=a*Math.cos(o)+n.x,h=a*Math.sin(o)+n.y;if(i.x<=Math.max(l,c)+it&&i.x>=Math.min(l,c)-it&&i.y<=Math.max(u,h)+it&&i.y>=Math.min(u,h)-it)return!0}}return!1}function Ta(i,e,t){var r=[];r=r.concat(e);var n=t.style,a=n===void 0?G.Solid:n,s=t.size,o=s===void 0?1:s,l=t.color,u=l===void 0?"currentColor":l,c=t.dashedValue,h=c===void 0?[2,2]:c;i.lineWidth=o,i.strokeStyle=u,a===G.Dashed?i.setLineDash(h):i.setLineDash([]),r.forEach(function(f){var d=f.x,v=f.y,p=f.r,g=f.startAngle,m=f.endAngle;i.beginPath(),i.arc(d,v,p,g,m),i.stroke(),i.closePath()})}var Da={name:"arc",checkEventOn:Ma,draw:function(i,e,t){Ta(i,e,t)}},ii={},Aa=[_a,$n,xa,wa,ri,Ea,Da];Aa.forEach(function(i){ii[i.name]=Yn.extend(i)});function ka(i){var e;return(e=ii[i])!==null&&e!==void 0?e:null}var Dt=function(i){N(e,i);function e(t){var r=i.call(this)||this;return r._widget=t,r}return e.prototype.getWidget=function(){return this._widget},e.prototype.createFigure=function(t,r){var n=ka(t.name);if(n!==null){var a=new n(t);if(T(r)){for(var s in r)r.hasOwnProperty(s)&&a.registerEvent(s,r[s]);this.addChild(a)}return a}return null},e.prototype.draw=function(t){this.clear(),this.drawImp(t)},e}(Je),Fa=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r,n,a=this.getWidget(),s=this.getWidget().getPane(),o=s.getChart(),l=a.getBounding(),u=o.getStyles().grid,c=u.show;if(c){t.save(),t.globalCompositeOperation="destination-over";var h=u.horizontal,f=h.show;if(f){var d=s.getAxisComponent(),v=d.getTicks().map(function(_){return{coordinates:[{x:0,y:_.coord},{x:l.width,y:_.coord}]}});(r=this.createFigure({name:"line",attrs:v,styles:h}))===null||r===void 0||r.draw(t)}var p=u.vertical,g=p.show;if(g){var m=o.getXAxisPane().getAxisComponent(),v=m.getTicks().map(function(S){return{coordinates:[{x:S.coord,y:0},{x:S.coord,y:l.height}]}});(n=this.createFigure({name:"line",attrs:v,styles:p}))===null||n===void 0||n.draw(t)}t.restore()}},e}(Dt),rr=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.eachChildren=function(t){var r=this.getWidget().getPane(),n=r.getChart().getChartStore(),a=n.getVisibleDataList(),s=n.getTimeScaleStore().getBarSpace();a.forEach(function(o,l){t(o,s,l)})},e}(Dt),ni=function(i){N(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._boundCandleBarClickEvent=function(r){return function(){return t.getWidget().getPane().getChart().getChartStore().getActionStore().execute(_t.OnCandleBarClick,r),!1}},t}return e.prototype.drawImp=function(t){var r=this,n=this.getWidget().getPane(),a=n.getId()===Y.CANDLE,s=n.getChart().getChartStore(),o=this.getCandleBarOptions(s);if(o!==null){var l=0,u=0;if(o.type===gt.Ohlc){var c=s.getTimeScaleStore().getBarSpace().gapBar;l=Math.min(Math.max(Math.round(c*.2),1),8),l>2&&l%2===1&&l--,u=Math.floor(u/2)}var h=n.getAxisComponent();this.eachChildren(function(f,d){var v=f.data,p=f.x;if(T(v)){var g=v.open,m=v.high,_=v.low,S=v.close,y=o.type,x=o.styles,w=[];S>g?(w[0]=x.upColor,w[1]=x.upBorderColor,w[2]=x.upWickColor):S<g?(w[0]=x.downColor,w[1]=x.downBorderColor,w[2]=x.downWickColor):(w[0]=x.noChangeColor,w[1]=x.noChangeBorderColor,w[2]=x.noChangeWickColor);var b=h.convertToPixel(g),I=h.convertToPixel(S),C=[b,I,h.convertToPixel(m),h.convertToPixel(_)];C.sort(function(M,E){return M-E});var P=[];switch(y){case gt.CandleSolid:{P=r._createSolidBar(p,C,d,w);break}case gt.CandleStroke:{P=r._createStrokeBar(p,C,d,w);break}case gt.CandleUpStroke:{S>g?P=r._createStrokeBar(p,C,d,w):P=r._createSolidBar(p,C,d,w);break}case gt.CandleDownStroke:{g>S?P=r._createStrokeBar(p,C,d,w):P=r._createSolidBar(p,C,d,w);break}case gt.Ohlc:{P=[{name:"rect",attrs:[{x:p-u,y:C[0],width:l,height:C[3]-C[0]},{x:p-d.halfGapBar,y:b+l>C[3]?C[3]-l:b,width:d.halfGapBar,height:l},{x:p+u,y:I+l>C[3]?C[3]-l:I,width:d.halfGapBar-u,height:l}],styles:{color:w[0]}}];break}}P.forEach(function(M){var E,D;a&&(D={mouseClickEvent:r._boundCandleBarClickEvent(f)}),(E=r.createFigure(M,D))===null||E===void 0||E.draw(t)})}})}},e.prototype.getCandleBarOptions=function(t){var r=t.getStyles().candle;return{type:r.type,styles:r.bar}},e.prototype._createSolidBar=function(t,r,n,a){return[{name:"rect",attrs:{x:t,y:r[0],width:1,height:r[3]-r[0]},styles:{color:a[2]}},{name:"rect",attrs:{x:t-n.halfGapBar,y:r[1],width:n.gapBar,height:Math.max(1,r[2]-r[1])},styles:{style:X.StrokeFill,color:a[0],borderColor:a[1]}}]},e.prototype._createStrokeBar=function(t,r,n,a){return[{name:"rect",attrs:[{x:t,y:r[0],width:1,height:r[1]-r[0]},{x:t,y:r[2],width:1,height:r[3]-r[2]}],styles:{color:a[2]}},{name:"rect",attrs:{x:t-n.halfGapBar,y:r[1],width:n.gapBar,height:Math.max(1,r[2]-r[1])},styles:{style:X.Stroke,borderColor:a[1]}}]},e}(rr),Ra=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.getCandleBarOptions=function(t){var r,n,a=this.getWidget().getPane(),s=a.getAxisComponent();if(!s.isInCandle()){var o=t.getIndicatorStore().getInstances(a.getId());try{for(var l=Jt(o),u=l.next();!u.done;u=l.next()){var c=u.value;if(c.shouldOhlc&&c.visible){var h=c.styles,f=t.getStyles().indicator,d=ot(h,"ohlc.upColor",f.ohlc.upColor),v=ot(h,"ohlc.downColor",f.ohlc.downColor),p=ot(h,"ohlc.noChangeColor",f.ohlc.noChangeColor);return{type:gt.Ohlc,styles:{upColor:d,downColor:v,noChangeColor:p,upBorderColor:d,downBorderColor:v,noChangeBorderColor:p,upWickColor:d,downWickColor:v,noChangeWickColor:p}}}}}catch(g){r={error:g}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}return null},e.prototype.drawImp=function(t){var r=this;i.prototype.drawImp.call(this,t);var n=this.getWidget(),a=n.getPane(),s=a.getChart(),o=n.getBounding(),l=s.getXAxisPane().getAxisComponent(),u=a.getAxisComponent(),c=s.getChartStore(),h=c.getDataList(),f=c.getTimeScaleStore(),d=f.getVisibleRange(),v=c.getIndicatorStore().getInstances(a.getId()),p=c.getStyles().indicator;t.save(),v.forEach(function(g){var m;if(g.visible){g.zLevel<0?t.globalCompositeOperation="destination-over":t.globalCompositeOperation="source-over";var _=!1;if(g.draw!==null&&(t.save(),_=(m=g.draw({ctx:t,kLineDataList:h,indicator:g,visibleRange:d,bounding:o,barSpace:f.getBarSpace(),defaultStyles:p,xAxis:l,yAxis:u}))!==null&&m!==void 0?m:!1,t.restore()),!_){var S=g.result,y=[];r.eachChildren(function(x,w){var b,I,C,P=w.halfGapBar,M=x.dataIndex,E=x.x,D=l.convertToPixel(M-1),k=l.convertToPixel(M+1),V=(b=S[M-1])!==null&&b!==void 0?b:null,F=(I=S[M])!==null&&I!==void 0?I:null,H=(C=S[M+1])!==null&&C!==void 0?C:null,W={x:D},st={x:E},ut={x:k};g.figures.forEach(function($){var U=$.key,tt=V==null?void 0:V[U];R(tt)&&(W[U]=u.convertToPixel(tt));var J=F==null?void 0:F[U];R(J)&&(st[U]=u.convertToPixel(J));var et=H==null?void 0:H[U];R(et)&&(ut[U]=u.convertToPixel(et))}),Qe(h,g,M,p,function($,U,tt){var J,et,K;if(T(F==null?void 0:F[$.key])){var It=st[$.key],St=(J=$.attrs)===null||J===void 0?void 0:J.call($,{data:{prev:V,current:F,next:H},coordinate:{prev:W,current:st,next:ut},bounding:o,barSpace:w,xAxis:l,yAxis:u});if(!T(St))switch($.type){case"circle":{St={x:E,y:It,r:Math.max(1,P)};break}case"rect":case"bar":{var Bt=(et=$.baseValue)!==null&&et!==void 0?et:u.getRange().from,Lt=u.convertToPixel(Bt),Gt=Math.abs(Lt-It);Bt!==(F==null?void 0:F[$.key])&&(Gt=Math.max(1,Gt));var Et=void 0;It>Lt?Et=Lt:Et=It,St={x:E-P,y:Et,width:Math.max(1,P*2),height:Gt};break}case"line":{T(y[tt])||(y[tt]=[]),R(st[$.key])&&R(ut[$.key])&&y[tt].push({coordinates:[{x:st.x,y:st[$.key]},{x:ut.x,y:ut[$.key]}],styles:U});break}}var re=$.type;T(St)&&re!=="line"&&((K=r.createFigure({name:re==="bar"?"rect":re,attrs:St,styles:U}))===null||K===void 0||K.draw(t))}})}),y.forEach(function(x){if(x.length>1){for(var w=[{coordinates:[x[0].coordinates[0],x[0].coordinates[1]],styles:x[0].styles}],b=1;b<x.length;b++){var I=w[w.length-1],C=x[b],P=I.coordinates[I.coordinates.length-1];P.x===C.coordinates[0].x&&P.y===C.coordinates[0].y&&I.styles.style===C.styles.style&&I.styles.color===C.styles.color&&I.styles.size===C.styles.size&&I.styles.smooth===C.styles.smooth&&I.styles.dashedValue[0]===C.styles.dashedValue[0]&&I.styles.dashedValue[1]===C.styles.dashedValue[1]?I.coordinates.push(C.coordinates[1]):w.push({coordinates:[C.coordinates[0],C.coordinates[1]],styles:C.styles})}w.forEach(function(M){var E,D=M.coordinates,k=M.styles;(E=r.createFigure({name:"line",attrs:{coordinates:D},styles:k}))===null||E===void 0||E.draw(t)})}})}}}),t.restore()},e}(ni),Ba=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r=this.getWidget(),n=r.getPane(),a=r.getBounding(),s=r.getPane().getChart().getChartStore(),o=s.getTooltipStore().getCrosshair(),l=s.getStyles().crosshair;if(O(o.paneId)&&l.show){if(o.paneId===n.getId()){var u=o.y;this._drawLine(t,[{x:0,y:u},{x:a.width,y:u}],l.horizontal)}var c=o.realX;this._drawLine(t,[{x:c,y:0},{x:c,y:a.height}],l.vertical)}},e.prototype._drawLine=function(t,r,n){var a;if(n.show){var s=n.line;s.show&&((a=this.createFigure({name:"line",attrs:{coordinates:r},styles:s}))===null||a===void 0||a.draw(t))}},e}(Dt),ai=function(i){N(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._boundIconClickEvent=function(r){return function(){var n=t.getWidget().getPane();return n.getChart().getChartStore().getActionStore().execute(_t.OnTooltipIconClick,B({},r)),!0}},t._boundIconMouseMoveEvent=function(r){return function(){var n=t.getWidget().getPane(),a=n.getChart().getChartStore().getTooltipStore();return a.setActiveIcon(B({},r)),!0}},t}return e.prototype.drawImp=function(t){var r=this.getWidget(),n=r.getPane(),a=n.getChart().getChartStore(),s=a.getTooltipStore().getCrosshair();if(T(s.kLineData)){var o=r.getBounding(),l=a.getCustomApi(),u=a.getThousandsSeparator(),c=a.getDecimalFoldThreshold(),h=a.getIndicatorStore().getInstances(n.getId()),f=a.getTooltipStore().getActiveIcon(),d=a.getStyles().indicator,v=d.tooltip,p=v.offsetLeft,g=v.offsetTop,m=v.offsetRight;this.drawIndicatorTooltip(t,n.getId(),a.getDataList(),s,f,h,l,u,c,p,g,o.width-m,d)}},e.prototype.drawIndicatorTooltip=function(t,r,n,a,s,o,l,u,c,h,f,d,v){var p=this,g=v.tooltip;if(this.isDrawTooltip(a,g)){var m=g.text;o.forEach(function(_){var S=0,y={x:h,y:f},x=p.getIndicatorTooltipData(n,a,_,l,u,c,v),w=x.name,b=x.calcParamsText,I=x.values,C=x.icons,P=w.length>0,M=I.length>0;if(P||M){var E=ee(p.classifyTooltipIcons(C),3),D=E[0],k=E[1],V=E[2];if(S=p.drawStandardTooltipIcons(t,s,D,y,r,_.name,h,S,d),P){var F=w;b.length>0&&(F="".concat(F).concat(b)),S=p.drawStandardTooltipLegends(t,[{title:{text:"",color:m.color},value:{text:F,color:m.color}}],y,h,S,d,m)}S=p.drawStandardTooltipIcons(t,s,k,y,r,_.name,h,S,d),M&&(S=p.drawStandardTooltipLegends(t,I,y,h,S,d,g.text)),S=p.drawStandardTooltipIcons(t,s,V,y,r,_.name,h,S,d),f=y.y+S}})}return f},e.prototype.drawStandardTooltipIcons=function(t,r,n,a,s,o,l,u,c){var h=this;if(n.length>0){var f=0,d=0;n.forEach(function(v){var p=v.marginLeft,g=p===void 0?0:p,m=v.marginTop,_=m===void 0?0:m,S=v.marginRight,y=S===void 0?0:S,x=v.marginBottom,w=x===void 0?0:x,b=v.paddingLeft,I=b===void 0?0:b,C=v.paddingTop,P=C===void 0?0:C,M=v.paddingRight,E=M===void 0?0:M,D=v.paddingBottom,k=D===void 0?0:D,V=v.size,F=v.fontFamily,H=v.icon;t.font=te(V,"normal",F),f+=g+I+t.measureText(H).width+E+y,d=Math.max(d,_+P+V+k+w)}),a.x+f>c?(a.x=l,a.y+=u,u=d):u=Math.max(u,d),n.forEach(function(v){var p,g=v.marginLeft,m=g===void 0?0:g,_=v.marginTop,S=_===void 0?0:_,y=v.marginRight,x=y===void 0?0:y,w=v.paddingLeft,b=w===void 0?0:w,I=v.paddingTop,C=I===void 0?0:I,P=v.paddingRight,M=P===void 0?0:P,E=v.paddingBottom,D=E===void 0?0:E,k=v.color,V=v.activeColor,F=v.size,H=v.fontFamily,W=v.icon,st=v.backgroundColor,ut=v.activeBackgroundColor,$=(r==null?void 0:r.paneId)===s&&(r==null?void 0:r.indicatorName)===o&&(r==null?void 0:r.iconId)===v.id;(p=h.createFigure({name:"text",attrs:{text:W,x:a.x+m,y:a.y+S},styles:{paddingLeft:b,paddingTop:C,paddingRight:M,paddingBottom:D,color:$?V:k,size:F,family:H,backgroundColor:$?ut:st}},{mouseClickEvent:h._boundIconClickEvent({paneId:s,indicatorName:o,iconId:v.id}),mouseMoveEvent:h._boundIconMouseMoveEvent({paneId:s,indicatorName:o,iconId:v.id})}))===null||p===void 0||p.draw(t),a.x+=m+b+t.measureText(W).width+M+x})}return u},e.prototype.drawStandardTooltipLegends=function(t,r,n,a,s,o,l){var u=this;if(r.length>0){var c=l.marginLeft,h=l.marginTop,f=l.marginRight,d=l.marginBottom,v=l.size,p=l.family,g=l.weight;t.font=te(v,g,p),r.forEach(function(m){var _,S,y=m.title,x=m.value,w=t.measureText(y.text).width,b=t.measureText(x.text).width,I=w+b,C=h+v+d;n.x+c+I+f>o?(n.x=a,n.y+=s,s=C):s=Math.max(s,C),y.text.length>0&&((_=u.createFigure({name:"text",attrs:{x:n.x+c,y:n.y+h,text:y.text},styles:{color:y.color,size:v,family:p,weight:g}}))===null||_===void 0||_.draw(t)),(S=u.createFigure({name:"text",attrs:{x:n.x+c+w,y:n.y+h,text:x.text},styles:{color:x.color,size:v,family:p,weight:g}}))===null||S===void 0||S.draw(t),n.x+=c+I+f})}return s},e.prototype.isDrawTooltip=function(t,r){var n=r.showRule;return n===le.Always||n===le.FollowCross&&O(t.paneId)},e.prototype.getIndicatorTooltipData=function(t,r,n,a,s,o,l){var u,c,h=l.tooltip,f=h.showName?n.shortName:"",d="",v=n.calcParams;v.length>0&&h.showParams&&(d="(".concat(v.join(","),")"));var p={name:f,calcParamsText:d,values:[],icons:h.icons},g=r.dataIndex,m=(u=n.result)!==null&&u!==void 0?u:[],_=[];if(n.visible){var S=(c=m[g])!==null&&c!==void 0?c:{};Qe(t,n,g,l,function(k,V){var F;if(O(k.title)){var H=V.color,W=(F=S[k.key])!==null&&F!==void 0?F:h.defaultValue;R(W)&&(W=Q(W,n.precision),n.shouldFormatBigNumber&&(W=a.formatBigNumber(W)),W=nt(rt(W,s),o)),_.push({title:{text:k.title,color:H},value:{text:W,color:H}})}}),p.values=_}if(n.createTooltipDataSource!==null){var y=this.getWidget(),x=y.getPane(),w=x.getChart().getChartStore(),b=n.createTooltipDataSource({kLineDataList:t,indicator:n,visibleRange:w.getTimeScaleStore().getVisibleRange(),bounding:y.getBounding(),crosshair:r,defaultStyles:l,xAxis:x.getChart().getXAxisPane().getAxisComponent(),yAxis:x.getAxisComponent()}),I=b.name,C=b.calcParamsText,P=b.values,M=b.icons;if(O(I)&&h.showName&&(p.name=I),O(C)&&h.showParams&&(p.calcParamsText=C),T(M)&&(p.icons=M),T(P)&&n.visible){var E=[],D=l.tooltip.text.color;P.forEach(function(k){var V,F={text:"",color:D};Tt(k.title)?F=k.title:F.text=k.title;var H={text:"",color:D};if(Tt(k.value)?H=k.value:H.text=(V=k.value)!==null&&V!==void 0?V:h.defaultValue,R(H.text)){var W=Q(H.text,n.precision);n.shouldFormatBigNumber&&(W=a.formatBigNumber(W)),W=nt(rt(W,s),o),H.text=W}E.push({title:F,value:H})}),p.values=E}}return p},e.prototype.classifyTooltipIcons=function(t){var r=[],n=[],a=[];return t.forEach(function(s){switch(s.position){case pe.Left:{r.push(s);break}case pe.Middle:{n.push(s);break}case pe.Right:{a.push(s);break}}}),[r,n,a]},e}(Dt),oi=function(i){N(e,i);function e(t){var r=i.call(this,t)||this;return r._initEvent(),r}return e.prototype._initEvent=function(){var t=this,r=this.getWidget().getPane(),n=r.getId(),a=r.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",function(s){var o,l=a.getProgressInstanceInfo();if(l!==null){var u=l.instance,c=l.paneId;u.isStart()&&(a.updateProgressInstanceInfo(n),c=n);var h=u.points.length-1,f="".concat(ie,"point_").concat(h);return u.isDrawing()&&c===n&&(u.eventMoveForDrawing(t._coordinateToPoint(l.instance,s)),(o=u.onDrawing)===null||o===void 0||o.call(u,B({overlay:u,figureKey:f,figureIndex:h},s))),t._figureMouseMoveEvent(u,1,f,h,0)(s)}return a.setHoverInstanceInfo({paneId:n,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},s),!1}).registerEvent("mouseClickEvent",function(s){var o,l,u=a.getProgressInstanceInfo();if(u!==null){var c=u.instance,h=u.paneId;c.isStart()&&(a.updateProgressInstanceInfo(n,!0),h=n);var f=c.points.length-1,d="".concat(ie,"point_").concat(f);return c.isDrawing()&&h===n&&(c.eventMoveForDrawing(t._coordinateToPoint(c,s)),(o=c.onDrawing)===null||o===void 0||o.call(c,B({overlay:c,figureKey:d,figureIndex:f},s)),c.nextStep(),c.isDrawing()||(a.progressInstanceComplete(),(l=c.onDrawEnd)===null||l===void 0||l.call(c,B({overlay:c,figureKey:d,figureIndex:f},s)))),t._figureMouseClickEvent(c,1,d,f,0)(s)}return a.setClickInstanceInfo({paneId:n,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},s),!1}).registerEvent("mouseDoubleClickEvent",function(s){var o,l=a.getProgressInstanceInfo();if(l!==null){var u=l.instance,c=l.paneId;if(u.isDrawing()&&c===n&&(u.forceComplete(),!u.isDrawing())){a.progressInstanceComplete();var h=u.points.length-1,f="".concat(ie,"point_").concat(h);(o=u.onDrawEnd)===null||o===void 0||o.call(u,B({overlay:u,figureKey:f,figureIndex:h},s))}var d=u.points.length-1;return t._figureMouseClickEvent(u,1,"".concat(ie,"point_").concat(d),d,0)(s)}return!1}).registerEvent("mouseRightClickEvent",function(s){var o=a.getProgressInstanceInfo();if(o!==null){var l=o.instance;if(l.isDrawing()){var u=l.points.length-1;return t._figureMouseRightClickEvent(l,1,"".concat(ie,"point_").concat(u),u,0)(s)}}return!1}).registerEvent("mouseUpEvent",function(s){var o,l=a.getPressedInstanceInfo(),u=l.instance,c=l.figureIndex,h=l.figureKey;return u!==null&&((o=u.onPressedMoveEnd)===null||o===void 0||o.call(u,B({overlay:u,figureKey:h,figureIndex:c},s))),a.setPressedInstanceInfo({paneId:n,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1}),!1}).registerEvent("pressedMouseMoveEvent",function(s){var o,l,u=a.getPressedInstanceInfo(),c=u.instance,h=u.figureType,f=u.figureIndex,d=u.figureKey;if(c!==null){if(!c.lock&&!((l=(o=c.onPressedMoving)===null||o===void 0?void 0:o.call(c,B({overlay:c,figureIndex:f,figureKey:d},s)))!==null&&l!==void 0&&l)){var v=t._coordinateToPoint(c,s);h===1?c.eventPressedPointMove(v,f):c.eventPressedOtherMove(v,t.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1})},e.prototype._createFigureEvents=function(t,r,n,a,s,o){var l;if(!t.isDrawing()){var u=[];if(T(o)&&(Qt(o)?o&&(u=qi()):u=o),u.length===0)return{mouseMoveEvent:this._figureMouseMoveEvent(t,r,n,a,s),mouseDownEvent:this._figureMouseDownEvent(t,r,n,a,s),mouseClickEvent:this._figureMouseClickEvent(t,r,n,a,s),mouseRightClickEvent:this._figureMouseRightClickEvent(t,r,n,a,s),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,r,n,a,s)};l={},!u.includes("mouseMoveEvent")&&!u.includes("touchMoveEvent")&&(l.mouseMoveEvent=this._figureMouseMoveEvent(t,r,n,a,s)),!u.includes("mouseDownEvent")&&!u.includes("touchStartEvent")&&(l.mouseDownEvent=this._figureMouseDownEvent(t,r,n,a,s)),!u.includes("mouseClickEvent")&&!u.includes("tapEvent")&&(l.mouseClickEvent=this._figureMouseClickEvent(t,r,n,a,s)),!u.includes("mouseDoubleClickEvent")&&!u.includes("doubleTapEvent")&&(l.mouseDoubleClickEvent=this._figureMouseDoubleClickEvent(t,r,n,a,s)),u.includes("mouseRightClickEvent")||(l.mouseRightClickEvent=this._figureMouseRightClickEvent(t,r,n,a,s))}return l},e.prototype._figureMouseMoveEvent=function(t,r,n,a,s){var o=this;return function(l){var u=o.getWidget().getPane(),c=u.getChart().getChartStore().getOverlayStore();return c.setHoverInstanceInfo({paneId:u.getId(),instance:t,figureType:r,figureKey:n,figureIndex:a,attrsIndex:s},l),!0}},e.prototype._figureMouseDownEvent=function(t,r,n,a,s){var o=this;return function(l){var u,c=o.getWidget().getPane(),h=c.getId(),f=c.getChart().getChartStore().getOverlayStore();return t.startPressedMove(o._coordinateToPoint(t,l)),(u=t.onPressedMoveStart)===null||u===void 0||u.call(t,B({overlay:t,figureIndex:a,figureKey:n},l)),f.setPressedInstanceInfo({paneId:h,instance:t,figureType:r,figureKey:n,figureIndex:a,attrsIndex:s}),!0}},e.prototype._figureMouseClickEvent=function(t,r,n,a,s){var o=this;return function(l){var u=o.getWidget().getPane(),c=u.getId(),h=u.getChart().getChartStore().getOverlayStore();return h.setClickInstanceInfo({paneId:c,instance:t,figureType:r,figureKey:n,figureIndex:a,attrsIndex:s},l),!0}},e.prototype._figureMouseDoubleClickEvent=function(t,r,n,a,s){return function(o){var l;return(l=t.onDoubleClick)===null||l===void 0||l.call(t,B(B({},o),{figureIndex:a,figureKey:n,overlay:t})),!0}},e.prototype._figureMouseRightClickEvent=function(t,r,n,a,s){var o=this;return function(l){var u,c;if(!((c=(u=t.onRightClick)===null||u===void 0?void 0:u.call(t,B({overlay:t,figureIndex:a,figureKey:n},l)))!==null&&c!==void 0&&c)){var h=o.getWidget().getPane(),f=h.getChart().getChartStore().getOverlayStore();f.removeInstance(t)}return!0}},e.prototype._coordinateToPoint=function(t,r){var n,a={},s=this.getWidget().getPane(),o=s.getChart(),l=s.getId(),u=o.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){var c=o.getXAxisPane().getAxisComponent(),h=c.convertFromPixel(r.x),f=(n=u.dataIndexToTimestamp(h))!==null&&n!==void 0?n:void 0;a.dataIndex=h,a.timestamp=f}if(this.coordinateToPointValueFlag()){var d=s.getAxisComponent(),v=d.convertFromPixel(r.y);if(t.mode!==se.Normal&&l===Y.CANDLE&&R(a.dataIndex)){var p=u.getDataByDataIndex(a.dataIndex);if(p!==null){var g=t.modeSensitivity;if(v>p.high)if(t.mode===se.WeakMagnet){var m=d.convertToPixel(p.high),_=d.convertFromPixel(m-g);v<_&&(v=p.high)}else v=p.high;else if(v<p.low)if(t.mode===se.WeakMagnet){var S=d.convertToPixel(p.low),_=d.convertFromPixel(S-g);v>_&&(v=p.low)}else v=p.low;else{var y=Math.max(p.open,p.close),x=Math.min(p.open,p.close);v>y?v-y<p.high-v?v=y:v=p.high:v<x?v-p.low<x-v?v=p.low:v=x:y-v<v-x?v=y:v=x}}}a.value=v}return a},e.prototype.coordinateToPointValueFlag=function(){return!0},e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},e.prototype.dispatchEvent=function(t,r,n){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,r,n):i.prototype.dispatchEvent.call(this,t,r,n)},e.prototype.checkEventOn=function(){return!0},e.prototype.drawImp=function(t){var r=this,n=this.getWidget(),a=n.getPane(),s=a.getId(),o=a.getChart(),l=a.getAxisComponent(),u=o.getXAxisPane().getAxisComponent(),c=n.getBounding(),h=o.getChartStore(),f=h.getCustomApi(),d=h.getThousandsSeparator(),v=h.getDecimalFoldThreshold(),p=h.getTimeScaleStore(),g=p.getDateTimeFormat(),m=p.getBarSpace(),_=h.getPrecision(),S=h.getStyles().overlay,y=h.getOverlayStore(),x=y.getHoverInstanceInfo(),w=y.getClickInstanceInfo(),b=this.getCompleteOverlays(y,s),I=h.getIndicatorStore().getInstances(s),C=I.reduce(function(E,D){var k=D.precision;return E[D.name]=k,E.max=Math.max(E.max,k),E.min=Math.min(E.min,k),E.excludePriceVolumeMax=Math.max(E.excludePriceVolumeMax,k),E.excludePriceVolumeMin=Math.min(E.excludePriceVolumeMin,k),E},B(B({},_),{max:Math.max(_.price,_.volume),min:Math.min(_.price,_.volume),excludePriceVolumeMax:Number.MIN_SAFE_INTEGER,excludePriceVolumeMin:Number.MAX_SAFE_INTEGER}));b.forEach(function(E){E.visible&&r._drawOverlay(t,E,c,m,C,g,f,d,v,S,u,l,x,w,p)});var P=y.getProgressInstanceInfo();if(P!==null){var M=this.getProgressOverlay(P,s);M!==null&&M.visible&&this._drawOverlay(t,M,c,m,C,g,f,d,v,S,u,l,x,w,p)}},e.prototype._drawOverlay=function(t,r,n,a,s,o,l,u,c,h,f,d,v,p,g){var m=r.points,_=m.map(function(y){var x,w,b=y.dataIndex;R(y.timestamp)&&(b=g.timestampToDataIndex(y.timestamp));var I={x:0,y:0};return R(b)&&(I.x=(x=f==null?void 0:f.convertToPixel(b))!==null&&x!==void 0?x:0),R(y.value)&&(I.y=(w=d==null?void 0:d.convertToPixel(y.value))!==null&&w!==void 0?w:0),I});if(_.length>0){var S=new Array().concat(this.getFigures(r,_,n,a,s,u,c,o,h,f,d));this.drawFigures(t,r,S,h)}this.drawDefaultFigures(t,r,_,n,s,o,l,u,c,h,f,d,v,p)},e.prototype.drawFigures=function(t,r,n,a){var s=this;n.forEach(function(o,l){var u=o.type,c=o.styles,h=o.attrs,f=o.ignoreEvent,d=[].concat(h);d.forEach(function(v,p){var g,m,_,S=s._createFigureEvents(r,2,(g=o.key)!==null&&g!==void 0?g:"",l,p,f),y=B(B(B({},a[u]),(m=r.styles)===null||m===void 0?void 0:m[u]),c);(_=s.createFigure({name:u,attrs:v,styles:y},S))===null||_===void 0||_.draw(t)})})},e.prototype.getCompleteOverlays=function(t,r){return t.getInstances(r)},e.prototype.getProgressOverlay=function(t,r){return t.paneId===r?t.instance:null},e.prototype.getFigures=function(t,r,n,a,s,o,l,u,c,h,f){var d,v;return(v=(d=t.createPointFigures)===null||d===void 0?void 0:d.call(t,{overlay:t,coordinates:r,bounding:n,barSpace:a,precision:s,thousandsSeparator:o,decimalFoldThreshold:l,dateTimeFormat:u,defaultStyles:c,xAxis:h,yAxis:f}))!==null&&v!==void 0?v:[]},e.prototype.drawDefaultFigures=function(t,r,n,a,s,o,l,u,c,h,f,d,v,p){var g=this,m,_;if(r.needDefaultPointFigure&&(((m=v.instance)===null||m===void 0?void 0:m.id)===r.id&&v.figureType!==0||((_=p.instance)===null||_===void 0?void 0:_.id)===r.id&&p.figureType!==0)){var S=r.styles,y=B(B({},h.point),S==null?void 0:S.point);n.forEach(function(x,w){var b,I,C,P=x.x,M=x.y,E=y.radius,D=y.color,k=y.borderColor,V=y.borderSize;((b=v.instance)===null||b===void 0?void 0:b.id)===r.id&&v.figureType===1&&v.figureIndex===w&&(E=y.activeRadius,D=y.activeColor,k=y.activeBorderColor,V=y.activeBorderSize),(I=g.createFigure({name:"circle",attrs:{x:P,y:M,r:E+V},styles:{color:k}},g._createFigureEvents(r,1,"".concat(ie,"point_").concat(w),w,0)))===null||I===void 0||I.draw(t),(C=g.createFigure({name:"circle",attrs:{x:P,y:M,r:E},styles:{color:D}}))===null||C===void 0||C.draw(t)})}},e}(Dt),si=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._gridView=new Fa(n),n._indicatorView=new Ra(n),n._crosshairLineView=new Ba(n),n._tooltipView=n.createTooltipView(),n._overlayView=new oi(n),n.addChild(n._tooltipView),n.addChild(n._overlayView),n.getContainer().style.cursor="crosshair",n.registerEvent("mouseMoveEvent",function(){return r.getChart().getChartStore().getTooltipStore().setActiveIcon(),!1}),n}return e.prototype.getName=function(){return z.MAIN},e.prototype.updateMain=function(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)},e.prototype.createTooltipView=function(){return new ai(this)},e.prototype.updateMainContent=function(t){},e.prototype.updateOverlay=function(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)},e}(er),La=function(i){N(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._ripplePoint=t.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}),t._animationFrameTime=0,t._animation=new $e({iterationCount:1/0}).doFrame(function(r){t._animationFrameTime=r;var n=t.getWidget().getPane();n.getChart().updatePane(0,n.getId())}),t}return e.prototype.drawImp=function(t){var r,n,a,s=this.getWidget(),o=s.getPane(),l=o.getChart(),u=l.getDataList(),c=u.length-1,h=s.getBounding(),f=o.getAxisComponent(),d=l.getStyles().candle.area,v=[],p=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,m=null;if(this.eachChildren(function(b){var I=b.data,C=b.x,P=I==null?void 0:I[d.value];if(R(P)){var M=f.convertToPixel(P);g===Number.MIN_SAFE_INTEGER&&(g=C),v.push({x:C,y:M}),p=Math.min(p,M),b.dataIndex===c&&(m={x:C,y:M})}}),v.length>0){(r=this.createFigure({name:"line",attrs:{coordinates:v},styles:{color:d.lineColor,size:d.lineSize,smooth:d.smooth}}))===null||r===void 0||r.draw(t);var _=d.backgroundColor,S=void 0;if(Ct(_)){var y=t.createLinearGradient(0,h.height,0,p);try{_.forEach(function(b){var I=b.offset,C=b.color;y.addColorStop(I,C)})}catch{}S=y}else S=_;t.fillStyle=S,t.beginPath(),t.moveTo(g,h.height),t.lineTo(v[0].x,v[0].y),jr(t,v,d.smooth),t.lineTo(v[v.length-1].x,h.height),t.closePath(),t.fill()}var x=d.point;if(x.show&&T(m)){(n=this.createFigure({name:"circle",attrs:{x:m.x,y:m.y,r:x.radius},styles:{style:"fill",color:x.color}}))===null||n===void 0||n.draw(t);var w=x.rippleRadius;x.animation&&(w=x.radius+this._animationFrameTime/x.animationDuration*(x.rippleRadius-x.radius),this._animation.setDuration(x.animationDuration).start()),(a=this._ripplePoint)===null||a===void 0||a.setAttrs({x:m.x,y:m.y,r:w}).setStyles({style:"fill",color:x.rippleColor}).draw(t)}else this.stopAnimation()},e.prototype.stopAnimation=function(){this._animation.stop()},e}(rr),Va=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r=this.getWidget(),n=r.getPane(),a=n.getChart().getChartStore(),s=a.getStyles().candle.priceMark,o=s.high,l=s.low;if(s.show&&(o.show||l.show)){var u=a.getThousandsSeparator(),c=a.getDecimalFoldThreshold(),h=a.getPrecision(),f=n.getAxisComponent(),d=Number.MIN_SAFE_INTEGER,v=0,p=Number.MAX_SAFE_INTEGER,g=0;this.eachChildren(function(S){var y=S.data,x=S.x;T(y)&&(d<y.high&&(d=y.high,v=x),p>y.low&&(p=y.low,g=x))});var m=f.convertToPixel(d),_=f.convertToPixel(p);o.show&&d!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,nt(rt(Q(d,h.price),u),c),{x:v,y:m},m<_?[-2,-5]:[2,5],o),l.show&&p!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,nt(rt(Q(p,h.price),u),c),{x:g,y:_},m<_?[2,5]:[-2,-5],l)}},e.prototype._drawMark=function(t,r,n,a,s){var o,l,u,c=n.x,h=n.y+a[0];(o=this.createFigure({name:"line",attrs:{coordinates:[{x:c-2,y:h+a[0]},{x:c,y:h},{x:c+2,y:h+a[0]}]},styles:{color:s.color}}))===null||o===void 0||o.draw(t);var f,d,v,p=this.getWidget().getBounding().width;c>p/2?(f=c-5,d=f-s.textOffset,v="right"):(f=c+5,v="left",d=f+s.textOffset);var g=h+a[1];(l=this.createFigure({name:"line",attrs:{coordinates:[{x:c,y:h},{x:c,y:g},{x:f,y:g}]},styles:{color:s.color}}))===null||l===void 0||l.draw(t),(u=this.createFigure({name:"text",attrs:{x:d,y:g,text:r,align:v,baseline:"middle"},styles:{color:s.color,size:s.textSize,family:s.textFamily,weight:s.textWeight}}))===null||u===void 0||u.draw(t)},e}(rr),Oa=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r,n=this.getWidget(),a=n.getPane(),s=n.getBounding(),o=a.getChart().getChartStore(),l=o.getStyles().candle.priceMark,u=l.last,c=u.line;if(l.show&&u.show&&c.show){var h=a.getAxisComponent(),f=o.getDataList(),d=f[f.length-1];if(d!=null){var v=d.close,p=d.open,g=h.convertToNicePixel(v),m=void 0;v>p?m=u.upColor:v<p?m=u.downColor:m=u.noChangeColor,(r=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:g},{x:s.width,y:g}]},styles:{style:c.style,color:m,size:c.size,dashedValue:c.dashedValue}}))===null||r===void 0||r.draw(t)}}},e}(Dt),Na={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅："},za={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: "},Wa={"zh-CN":Na,"en-US":za};function Xa(i,e){var t,r;return(r=(t=Wa[e])===null||t===void 0?void 0:t[i])!==null&&r!==void 0?r:i}var Ya=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r=this.getWidget(),n=r.getPane(),a=n.getId(),s=n.getChart().getChartStore(),o=s.getTooltipStore().getCrosshair();if(T(o.kLineData)){var l=r.getBounding(),u=n.getYAxisWidget().getBounding(),c=s.getDataList(),h=s.getPrecision(),f=s.getLocale(),d=s.getCustomApi(),v=s.getThousandsSeparator(),p=s.getDecimalFoldThreshold(),g=s.getTooltipStore().getActiveIcon(),m=s.getIndicatorStore().getInstances(n.getId()),_=s.getTimeScaleStore().getDateTimeFormat(),S=s.getStyles(),y=S.candle,x=S.indicator;if(y.tooltip.showType===Mt.Rect&&x.tooltip.showType===Mt.Rect){var w=this.isDrawTooltip(o,y.tooltip),b=this.isDrawTooltip(o,x.tooltip);this._drawRectTooltip(t,c,m,l,u,o,h,_,f,d,v,p,w,b,y.tooltip.offsetTop,S)}else if(y.tooltip.showType===Mt.Standard&&x.tooltip.showType===Mt.Standard){var I=y.tooltip,C=I.offsetLeft,P=I.offsetTop,M=I.offsetRight,E=l.width-M,D=this._drawCandleStandardTooltip(t,c,a,o,g,h,_,f,d,v,p,C,P,E,y);this.drawIndicatorTooltip(t,a,c,o,g,m,d,v,p,C,D,E,x)}else if(y.tooltip.showType===Mt.Rect&&x.tooltip.showType===Mt.Standard){var k=y.tooltip,C=k.offsetLeft,P=k.offsetTop,M=k.offsetRight,E=l.width-M,V=this.drawIndicatorTooltip(t,a,c,o,g,m,d,v,p,C,P,E,x),w=this.isDrawTooltip(o,y.tooltip);this._drawRectTooltip(t,c,m,l,u,o,h,_,f,d,v,p,w,!1,V,S)}else{var F=y.tooltip,C=F.offsetLeft,P=F.offsetTop,M=F.offsetRight,E=l.width-M,H=this._drawCandleStandardTooltip(t,c,a,o,g,h,_,f,d,v,p,C,P,E,y),b=this.isDrawTooltip(o,x.tooltip);this._drawRectTooltip(t,c,m,l,u,o,h,_,f,d,v,p,!1,b,H,S)}}},e.prototype._drawCandleStandardTooltip=function(t,r,n,a,s,o,l,u,c,h,f,d,v,p,g){var m,_,S,y=g.tooltip,x=y.text,w=0,b={x:d,y:v};if(this.isDrawTooltip(a,y)){var I=(m=a.dataIndex)!==null&&m!==void 0?m:0,C=this._getCandleTooltipLegends({prev:(_=r[I-1])!==null&&_!==void 0?_:null,current:a.kLineData,next:(S=r[I+1])!==null&&S!==void 0?S:null},o,l,u,c,h,f,g),P=ee(this.classifyTooltipIcons(y.icons),3),M=P[0],E=P[1],D=P[2];w=this.drawStandardTooltipIcons(t,s,M,b,n,"",d,w,p),w=this.drawStandardTooltipIcons(t,s,E,b,n,"",d,w,p),C.length>0&&(w=this.drawStandardTooltipLegends(t,C,b,d,w,p,x)),w=this.drawStandardTooltipIcons(t,s,D,b,n,"",d,w,p)}return b.y+w},e.prototype._drawRectTooltip=function(t,r,n,a,s,o,l,u,c,h,f,d,v,p,g,m){var _=this,S,y,x,w,b,I=m.candle,C=m.indicator,P=I.tooltip,M=C.tooltip;if(v||p){var E=(S=o.dataIndex)!==null&&S!==void 0?S:0,D=this._getCandleTooltipLegends({prev:(y=r[E-1])!==null&&y!==void 0?y:null,current:o.kLineData,next:(x=r[E+1])!==null&&x!==void 0?x:null},l,u,c,h,f,d,I),k=P.offsetLeft,V=P.offsetTop,F=P.offsetRight,H=P.offsetBottom,W=P.text,st=W.marginLeft,ut=W.marginRight,$=W.marginTop,U=W.marginBottom,tt=W.size,J=W.weight,et=W.family,K=P.rect,It=K.position,St=K.paddingLeft,Bt=K.paddingRight,Lt=K.paddingTop,Gt=K.paddingBottom,Et=K.offsetLeft,re=K.offsetRight,Be=K.offsetTop,ir=K.offsetBottom,Vt=K.borderSize,mi=K.borderRadius,_i=K.borderColor,yi=K.color,ce=0,Ot=0,Nt=0;v&&(t.font=te(tt,J,et),D.forEach(function(At){var dt=At.title,ft=At.value,bt="".concat(dt.text).concat(ft.text),kt=t.measureText(bt).width+st+ut;ce=Math.max(ce,kt)}),Nt+=(U+$+tt)*D.length);var $t=M.text,nr=$t.marginLeft,ar=$t.marginRight,or=$t.marginTop,sr=$t.marginBottom,he=$t.size,Le=$t.weight,Ve=$t.family,lr=[];if(p&&(t.font=te(he,Le,Ve),n.forEach(function(At){var dt,ft=(dt=_.getIndicatorTooltipData(r,o,At,h,f,d,C).values)!==null&&dt!==void 0?dt:[];lr.push(ft),ft.forEach(function(bt){var kt=bt.title,ye=bt.value,Ci="".concat(kt.text).concat(ye.text),Ii=t.measureText(Ci).width+nr+ar;ce=Math.max(ce,Ii),Nt+=or+sr+he})})),Ot+=ce,Ot!==0&&Nt!==0){Ot+=Vt*2+St+Bt,Nt+=Vt*2+Lt+Gt;var Si=a.width/2,ur=It===Ie.Pointer&&o.paneId===Y.CANDLE,cr=((w=o.realX)!==null&&w!==void 0?w:0)>Si,xt=0;if(ur){var hr=o.realX;cr?xt=hr-re-Ot:xt=hr+Et}else cr?(xt=Et+k,m.yAxis.inside&&m.yAxis.position===Ht.Left&&(xt+=s.width)):(xt=a.width-re-Ot-F,m.yAxis.inside&&m.yAxis.position===Ht.Right&&(xt-=s.width));var Ut=g+Be;if(ur){var xi=o.y;Ut=xi-Nt/2,Ut+Nt>a.height-ir-H&&(Ut=a.height-ir-Nt-H),Ut<g+Be&&(Ut=g+Be+V)}(b=this.createFigure({name:"rect",attrs:{x:xt,y:Ut,width:Ot,height:Nt},styles:{style:X.StrokeFill,color:yi,borderColor:_i,borderSize:Vt,borderRadius:mi}}))===null||b===void 0||b.draw(t);var bi=xt+Vt+St+st,zt=Ut+Vt+Lt;if(v&&D.forEach(function(At){var dt,ft;zt+=$;var bt=At.title;(dt=_.createFigure({name:"text",attrs:{x:bi,y:zt,text:bt.text},styles:{color:bt.color,size:tt,family:et,weight:J}}))===null||dt===void 0||dt.draw(t);var kt=At.value;(ft=_.createFigure({name:"text",attrs:{x:xt+Ot-Vt-ut-Bt,y:zt,text:kt.text,align:"right"},styles:{color:kt.color,size:tt,family:et,weight:J}}))===null||ft===void 0||ft.draw(t),zt+=tt+U}),p){var wi=xt+Vt+St+nr;lr.forEach(function(At){At.forEach(function(dt){var ft,bt;zt+=or;var kt=dt.title,ye=dt.value;(ft=_.createFigure({name:"text",attrs:{x:wi,y:zt,text:kt.text},styles:{color:kt.color,size:he,family:Ve,weight:Le}}))===null||ft===void 0||ft.draw(t),(bt=_.createFigure({name:"text",attrs:{x:xt+Ot-Vt-ar-Bt,y:zt,text:ye.text,align:"right"},styles:{color:ye.color,size:he,family:Ve,weight:Le}}))===null||bt===void 0||bt.draw(t),zt+=he+sr})})}}}},e.prototype._getCandleTooltipLegends=function(t,r,n,a,s,o,l,u){var c,h,f,d,v,p=u.tooltip,g=p.text.color,m=t.current,_=(h=(c=t.prev)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:m.close,S=m.close-_,y=r.price,x=r.volume,w={"{time}":s.formatDate(n,m.timestamp,"YYYY-MM-DD HH:mm",lt.Tooltip),"{open}":nt(rt(Q(m.open,y),o),l),"{high}":nt(rt(Q(m.high,y),o),l),"{low}":nt(rt(Q(m.low,y),o),l),"{close}":nt(rt(Q(m.close,y),o),l),"{volume}":nt(rt(s.formatBigNumber(Q((f=m.volume)!==null&&f!==void 0?f:p.defaultValue,x)),o),l),"{turnover}":nt(rt(Q((d=m.turnover)!==null&&d!==void 0?d:p.defaultValue,y),o),l),"{change}":_===0?p.defaultValue:"".concat(rt(Q(S/_*100),o),"%")},b=(v=Ft(p.custom)?p.custom(t,u):p.custom)!==null&&v!==void 0?v:[];return b.map(function(I){var C,P=I.title,M=I.value,E={text:"",color:""};Tt(P)?E=B({},P):(E.text=P,E.color=g),E.text=Xa(E.text,a);var D={text:p.defaultValue,color:""};Tt(M)?D=B({},M):(D.text=M,D.color=g);var k=D.text.match(/{(\S*)}/);if(k!==null&&k.length>1){var V="{".concat(k[1],"}");D.text=D.text.replace(V,(C=w[V])!==null&&C!==void 0?C:p.defaultValue),V==="{change}"&&(D.color=S===0?u.priceMark.last.noChangeColor:S>0?u.priceMark.last.upColor:u.priceMark.last.downColor)}return{title:E,value:D}})},e}(ai),Ha=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._candleBarView=new ni(n),n._candleAreaView=new La(n),n._candleHighLowPriceView=new Va(n),n._candleLastPriceLineView=new Oa(n),n.addChild(n._candleBarView),n}return e.prototype.updateMainContent=function(t){var r=this.getPane().getChart().getStyles().candle;r.type!==gt.Area?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)},e.prototype.createTooltipView=function(){return new Ya(this)},e}(si),li=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r=this,n,a,s=this.getWidget(),o=s.getPane(),l=s.getBounding(),u=o.getAxisComponent(),c=this.getAxisStyles(o.getChart().getStyles());if(c.show){c.axisLine.show&&((n=this.createFigure({name:"line",attrs:this.createAxisLine(l,c),styles:c.axisLine}))===null||n===void 0||n.draw(t));var h=u.getTicks();if(c.tickLine.show){var f=this.createTickLines(h,l,c);f.forEach(function(v){var p;(p=r.createFigure({name:"line",attrs:v,styles:c.tickLine}))===null||p===void 0||p.draw(t)})}if(c.tickText.show){var d=this.createTickTexts(h,l,c);(a=this.createFigure({name:"text",attrs:d,styles:c.tickText}))===null||a===void 0||a.draw(t)}}},e}(Dt),Ga=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.getAxisStyles=function(t){return t.yAxis},e.prototype.createAxisLine=function(t,r){var n=this.getWidget().getPane().getAxisComponent(),a=r.axisLine.size,s;return n.isFromZero()?s=0:s=t.width-a,{coordinates:[{x:s,y:0},{x:s,y:t.height}]}},e.prototype.createTickLines=function(t,r,n){var a=this.getWidget().getPane().getAxisComponent(),s=n.axisLine,o=n.tickLine,l=0,u=0;return a.isFromZero()?(l=0,s.show&&(l+=s.size),u=l+o.length):(l=r.width,s.show&&(l-=s.size),u=l-o.length),t.map(function(c){return{coordinates:[{x:l,y:c.coord},{x:u,y:c.coord}]}})},e.prototype.createTickTexts=function(t,r,n){var a=this.getWidget().getPane().getAxisComponent(),s=n.axisLine,o=n.tickLine,l=n.tickText,u=0;a.isFromZero()?(u=l.marginStart,s.show&&(u+=s.size),o.show&&(u+=o.length)):(u=r.width-l.marginEnd,s.show&&(u-=s.size),o.show&&(u-=o.length));var c=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map(function(h){return{x:u,y:h.coord,text:h.text,align:c,baseline:"middle"}})},e}(li),$a=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r,n=this.getWidget(),a=n.getPane(),s=n.getBounding(),o=a.getChart().getChartStore(),l=o.getStyles().candle.priceMark,u=l.last,c=u.text;if(l.show&&u.show&&c.show){var h=o.getPrecision(),f=a.getAxisComponent(),d=o.getDataList(),v=d[d.length-1];if(T(v)){var p=v.close,g=v.open,m=f.convertToNicePixel(p),_=void 0;p>g?_=u.upColor:p<g?_=u.downColor:_=u.noChangeColor;var S=void 0;if(f.getType()===at.Percentage){var y=o.getVisibleFirstData(),x=y.close;S="".concat(((p-x)/x*100).toFixed(2),"%")}else S=Q(p,h.price);S=nt(rt(S,o.getThousandsSeparator()),o.getDecimalFoldThreshold());var w=void 0,b=void 0;f.isFromZero()?(w=0,b="left"):(w=s.width,b="right"),(r=this.createFigure({name:"text",attrs:{x:w,y:m,text:S,align:b,baseline:"middle"},styles:B(B({},c),{backgroundColor:_})}))===null||r===void 0||r.draw(t)}}},e}(Dt),Ua=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r=this,n=this.getWidget(),a=n.getPane(),s=n.getBounding(),o=a.getChart().getChartStore(),l=o.getCustomApi(),u=o.getStyles().indicator,c=u.lastValueMark,h=c.text;if(c.show){var f=a.getAxisComponent(),d=o.getDataList(),v=d.length-1,p=o.getIndicatorStore().getInstances(a.getId()),g=o.getThousandsSeparator(),m=o.getDecimalFoldThreshold();p.forEach(function(_){var S=_.result,y=S[v];if(T(y)&&_.visible){var x=_.precision;Qe(d,_,v,u,function(w,b){var I,C=y[w.key];if(R(C)){var P=f.convertToNicePixel(C),M=Q(C,x);_.shouldFormatBigNumber&&(M=l.formatBigNumber(M)),M=nt(rt(M,g),m);var E=void 0,D=void 0;f.isFromZero()?(E=0,D="left"):(E=s.width,D="right"),(I=r.createFigure({name:"text",attrs:{x:E,y:P,text:M,align:D,baseline:"middle"},styles:B(B({},h),{backgroundColor:b.color})}))===null||I===void 0||I.draw(t)}})}})}},e}(Dt),ui=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!1},e.prototype.drawDefaultFigures=function(t,r,n,a,s,o,l,u,c,h,f,d,v,p){this.drawFigures(t,r,this.getDefaultFigures(r,n,a,s,o,l,u,c,f,d,p),h)},e.prototype.getDefaultFigures=function(t,r,n,a,s,o,l,u,c,h,f){var d,v,p=[];if(t.needDefaultYAxisFigure&&t.id===((d=f.instance)===null||d===void 0?void 0:d.id)&&f.paneId===this.getWidget().getPane().getId()){var g=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,_=(v=h==null?void 0:h.isFromZero())!==null&&v!==void 0?v:!1,S,y;_?(S="left",y=0):(S="right",y=n.width),r.forEach(function(x,w){var b=t.points[w];if(R(b.value)){g=Math.min(g,x.y),m=Math.max(m,x.y);var I=nt(rt(Q(b.value,a.price),l),u);p.push({type:"text",attrs:{x:y,y:x.y,text:I,align:S,baseline:"middle"},ignoreEvent:!0})}}),r.length>1&&p.unshift({type:"rect",attrs:{x:0,y:g,width:n.width,height:m-g},ignoreEvent:!0})}return p},e.prototype.getFigures=function(t,r,n,a,s,o,l,u,c,h,f){var d,v;return(v=(d=t.createYAxisFigures)===null||d===void 0?void 0:d.call(t,{overlay:t,coordinates:r,bounding:n,barSpace:a,precision:s,thousandsSeparator:o,decimalFoldThreshold:l,dateTimeFormat:u,defaultStyles:c,xAxis:h,yAxis:f}))!==null&&v!==void 0?v:[]},e}(oi),ci=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var r,n=this.getWidget(),a=n.getPane(),s=n.getBounding(),o=n.getPane().getChart().getChartStore(),l=o.getTooltipStore().getCrosshair(),u=o.getStyles().crosshair;if(O(l.paneId)&&this.compare(l,a.getId())&&u.show){var c=this.getDirectionStyles(u),h=c.text;if(c.show&&h.show){var f=a.getAxisComponent(),d=this.getText(l,o,f);t.font=te(h.size,h.weight,h.family),(r=this.createFigure({name:"text",attrs:this.getTextAttrs(d,t.measureText(d).width,l,s,f,h),styles:h}))===null||r===void 0||r.draw(t)}}},e.prototype.compare=function(t,r){return t.paneId===r},e.prototype.getDirectionStyles=function(t){return t.horizontal},e.prototype.getText=function(t,r,n){var a=n,s=n.convertFromPixel(t.y),o;if(a.getType()===at.Percentage){var l=r.getVisibleFirstData();o="".concat(((s-l.close)/l.close*100).toFixed(2),"%")}else{var u=r.getIndicatorStore().getInstances(t.paneId),c=0,h=!1;a.isInCandle()?c=r.getPrecision().price:u.forEach(function(f){c=Math.max(f.precision,c),h||(h=f.shouldFormatBigNumber)}),o=Q(s,c),h&&(o=r.getCustomApi().formatBigNumber(o))}return nt(rt(o,r.getThousandsSeparator()),r.getDecimalFoldThreshold())},e.prototype.getTextAttrs=function(t,r,n,a,s,o){var l=s,u,c;return l.isFromZero()?(u=0,c="left"):(u=a.width,c="right"),{x:u,y:n.y,text:t,align:c,baseline:"middle"}},e}(Dt),ja=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._yAxisView=new Ga(n),n._candleLastPriceLabelView=new $a(n),n._indicatorLastValueView=new Ua(n),n._overlayYAxisView=new ui(n),n._crosshairHorizontalLabelView=new ci(n),n.getContainer().style.cursor="ns-resize",n.addChild(n._overlayYAxisView),n}return e.prototype.getName=function(){return z.Y_AXIS},e.prototype.updateMain=function(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)},e.prototype.updateOverlay=function(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)},e}(er),hi=function(){function i(e){this._range={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0},this._prevRange={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=e}return i.prototype.getParent=function(){return this._parent},i.prototype.buildTicks=function(e){if(this._autoCalcTickFlag&&(this._range=this.calcRange()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e){this._prevRange=this._range;var t=this.optimalTicks(this._calcTicks());return this._ticks=this.createTicks({range:this._range,bounding:this.getSelfBounding(),defaultTicks:t}),!0}return!1},i.prototype.getTicks=function(){return this._ticks},i.prototype.getScrollZoomEnabled=function(){var e;return(e=this.getParent().getOptions().axisOptions.scrollZoomEnabled)!==null&&e!==void 0?e:!0},i.prototype.setRange=function(e){this._autoCalcTickFlag=!1,this._range=e},i.prototype.getRange=function(){return this._range},i.prototype.setAutoCalcTickFlag=function(e){this._autoCalcTickFlag=e},i.prototype.getAutoCalcTickFlag=function(){return this._autoCalcTickFlag},i.prototype._calcTicks=function(){var e=this._range,t=e.realFrom,r=e.realTo,n=e.realRange,a=[];if(n>=0){var s=ee(this._calcTickInterval(n),2),o=s[0],l=s[1],u=pr(Math.ceil(t/o)*o,l),c=pr(Math.floor(r/o)*o,l),h=0,f=u;if(o!==0)for(;f<=c;){var d=f.toFixed(l);a[h]={text:d,coord:0,value:d},++h,f+=o}}return a},i.prototype._calcTickInterval=function(e){var t=en(e/8),r=rn(t);return[t,r]},i}(),Za=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.calcRange=function(){var t,r,n,a,s=this.getParent(),o=s.getChart(),l=o.getChartStore(),u=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,h=[],f=!1,d=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER,p=Number.MAX_SAFE_INTEGER,g=l.getIndicatorStore().getInstances(s.getId());g.forEach(function(U){var tt,J,et;f||(f=(tt=U.shouldOhlc)!==null&&tt!==void 0?tt:!1),p=Math.min(p,U.precision),R(U.minValue)&&(d=Math.min(d,U.minValue)),R(U.maxValue)&&(v=Math.max(v,U.maxValue)),h.push({figures:(J=U.figures)!==null&&J!==void 0?J:[],result:(et=U.result)!==null&&et!==void 0?et:[]})});var m=4,_=this.isInCandle();if(_){var S=l.getPrecision().price;p!==Number.MAX_SAFE_INTEGER?m=Math.min(p,S):m=S}else p!==Number.MAX_SAFE_INTEGER&&(m=p);var y=l.getVisibleDataList(),x=o.getStyles().candle,w=x.type===gt.Area,b=x.area.value,I=_&&!w||!_&&f;y.forEach(function(U){var tt=U.dataIndex,J=U.data;if(T(J)&&(I&&(u=Math.min(u,J.low),c=Math.max(c,J.high)),_&&w)){var et=J[b];R(et)&&(u=Math.min(u,et),c=Math.max(c,et))}h.forEach(function(K){var It,St=K.figures,Bt=K.result,Lt=(It=Bt[tt])!==null&&It!==void 0?It:{};St.forEach(function(Gt){var Et=Lt[Gt.key];R(Et)&&(u=Math.min(u,Et),c=Math.max(c,Et))})})}),u!==Number.MAX_SAFE_INTEGER&&c!==Number.MIN_SAFE_INTEGER?(u=Math.min(d,u),c=Math.max(v,c)):(u=0,c=10);var C=this.getType(),P;switch(C){case at.Percentage:{var M=l.getVisibleFirstData();T(M)&&R(M.close)&&(u=(u-M.close)/M.close*100,c=(c-M.close)/M.close*100),P=Math.pow(10,-2);break}case at.Log:{u=fe(u),c=fe(c),P=.05*jt(-m);break}default:P=jt(-m)}if(u===c||Math.abs(u-c)<P){var E=d===u,D=v===c;u=E?u:D?u-8*P:u-4*P,c=D?c:E?c+8*P:c+4*P}var k=(r=(t=this.getParent().getYAxisWidget())===null||t===void 0?void 0:t.getBounding().height)!==null&&r!==void 0?r:0,V=s.getOptions().gap,F=(n=V==null?void 0:V.top)!==null&&n!==void 0?n:.2;F>=1&&(F=F/k);var H=(a=V==null?void 0:V.bottom)!==null&&a!==void 0?a:.1;H>=1&&(H=H/k);var W=Math.abs(c-u);u=u-W*H,c=c+W*F,W=Math.abs(c-u);var st,ut,$;return C===at.Log?(st=jt(u),ut=jt(c),$=Math.abs(ut-st)):(st=u,ut=c,$=W),{from:u,to:c,range:W,realFrom:st,realTo:ut,realRange:$}},e.prototype._innerConvertToPixel=function(t){var r,n,a=(n=(r=this.getParent().getYAxisWidget())===null||r===void 0?void 0:r.getBounding().height)!==null&&n!==void 0?n:0,s=this.getRange(),o=s.from,l=s.range,u=(t-o)/l;return this.isReverse()?Math.round(u*a):Math.round((1-u)*a)},e.prototype.isInCandle=function(){return this.getParent().getId()===Y.CANDLE},e.prototype.getType=function(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:at.Normal},e.prototype.getPosition=function(){return this.getParent().getChart().getStyles().yAxis.position},e.prototype.isReverse=function(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.reverse:!1},e.prototype.isFromZero=function(){var t=this.getParent().getChart().getStyles().yAxis,r=t.inside;return t.position===Ht.Left&&r||t.position===Ht.Right&&!r},e.prototype.optimalTicks=function(t){var r=this,n,a,s=this.getParent(),o=(a=(n=s.getYAxisWidget())===null||n===void 0?void 0:n.getBounding().height)!==null&&a!==void 0?a:0,l=s.getChart().getChartStore(),u=l.getCustomApi(),c=[],h=this.getType(),f=l.getIndicatorStore().getInstances(s.getId()),d=l.getThousandsSeparator(),v=l.getDecimalFoldThreshold(),p=0,g=!1;this.isInCandle()?p=l.getPrecision().price:f.forEach(function(S){p=Math.max(p,S.precision),g||(g=S.shouldFormatBigNumber)});var m=l.getStyles().xAxis.tickText.size,_;return t.forEach(function(S){var y=S.value,x,w=r._innerConvertToPixel(+y);switch(h){case at.Percentage:{x="".concat(Q(y,2),"%");break}case at.Log:{w=r._innerConvertToPixel(fe(+y)),x=Q(y,p);break}default:{x=Q(y,p),g&&(x=u.formatBigNumber(y));break}}x=nt(rt(x,d),v);var b=R(_);w>m&&w<o-m&&(b&&Math.abs(_-w)>m*2||!b)&&(c.push({text:x,coord:w,value:y}),_=w)}),c},e.prototype.getAutoSize=function(){var t=this.getParent(),r=t.getChart(),n=r.getStyles(),a=n.yAxis,s=a.size;if(s!=="auto")return s;var o=r.getChartStore(),l=o.getCustomApi(),u=0;if(a.show&&(a.axisLine.show&&(u+=a.axisLine.size),a.tickLine.show&&(u+=a.tickLine.length),a.tickText.show)){var c=0;this.getTicks().forEach(function(y){c=Math.max(c,Ee(y.text,a.tickText.size,a.tickText.weight,a.tickText.family))}),u+=a.tickText.marginStart+a.tickText.marginEnd+c}var h=n.crosshair,f=0;if(h.show&&h.horizontal.show&&h.horizontal.text.show){var d=o.getIndicatorStore().getInstances(t.getId()),v=0,p=!1;d.forEach(function(y){v=Math.max(y.precision,v),p||(p=y.shouldFormatBigNumber)});var g=2;if(this.getType()!==at.Percentage)if(this.isInCandle()){var m=o.getPrecision().price,_=n.indicator.lastValueMark;_.show&&_.text.show?g=Math.max(v,m):g=m}else g=v;var S=Q(this.getRange().to,g);p&&(S=l.formatBigNumber(S)),S=nt(S,o.getDecimalFoldThreshold()),f+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+Ee(S,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}return Math.max(u,f)},e.prototype.getSelfBounding=function(){return this.getParent().getYAxisWidget().getBounding()},e.prototype.convertFromPixel=function(t){var r,n,a=(n=(r=this.getParent().getYAxisWidget())===null||r===void 0?void 0:r.getBounding().height)!==null&&n!==void 0?n:0,s=this.getRange(),o=s.from,l=s.range,u=this.isReverse()?t/a:1-t/a,c=u*l+o;switch(this.getType()){case at.Percentage:{var h=this.getParent().getChart().getChartStore().getVisibleFirstData();return T(h)&&R(h.close)?h.close*c/100+h.close:0}case at.Log:return jt(c);default:return c}},e.prototype.convertToRealValue=function(t){var r=t;return this.getType()===at.Log&&(r=jt(t)),r},e.prototype.convertToPixel=function(t){var r=t;switch(this.getType()){case at.Percentage:{var n=this.getParent().getChart().getChartStore().getVisibleFirstData();T(n)&&R(n.close)&&(r=(t-n.close)/n.close*100);break}case at.Log:{r=fe(t);break}default:r=t}return this._innerConvertToPixel(r)},e.prototype.convertToNicePixel=function(t){var r,n,a=(n=(r=this.getParent().getYAxisWidget())===null||r===void 0?void 0:r.getBounding().height)!==null&&n!==void 0?n:0,s=this.convertToPixel(t);return Math.round(Math.max(a*.05,Math.min(s,a*.98)))},e.extend=function(t){var r=function(n){N(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a.prototype.createTicks=function(s){return t.createTicks(s)},a}(e);return r},e}(hi),qa={name:"default",createTicks:function(i){var e=i.defaultTicks;return e}},Sr={default:Za.extend(qa)};function Ka(i){var e;return(e=Sr[i])!==null&&e!==void 0?e:Sr.default}var vi=function(){function i(e,t,r,n){this._bounding=Qr(),this._chart=r,this._id=n,this._init(e,t)}return i.prototype._init=function(e,t){this._rootContainer=e,this._container=Rt("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),t!==null?e.insertBefore(this._container,t):e.appendChild(this._container)},i.prototype.getContainer=function(){return this._container},i.prototype.getId=function(){return this._id},i.prototype.getChart=function(){return this._chart},i.prototype.getBounding=function(){return this._bounding},i.prototype.update=function(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height="".concat(this._bounding.height,"px")),this.updateImp(e??3,this._container,this._bounding)},i.prototype.destroy=function(){this._rootContainer.removeChild(this._container)},i}(),di=function(i){N(e,i);function e(t,r,n,a,s){var o=i.call(this,t,r,n,a)||this;o._yAxisWidget=null,o._options={minHeight:sa,dragEnabled:!0,gap:{top:.2,bottom:.1},axisOptions:{name:"default",scrollZoomEnabled:!0}};var l=o.getContainer();return o._mainWidget=o.createMainWidget(l),o._yAxisWidget=o.createYAxisWidget(l),o.setOptions(s),o}return e.prototype.setOptions=function(t){var r,n,a,s=(r=t.axisOptions)===null||r===void 0?void 0:r.name;(this._options.axisOptions.name!==s&&O(s)||!T(this._axis))&&(this._axis=this.createAxisComponent(s??"default")),yt(this._options,t);var o,l;return this.getId()===Y.X_AXIS?(o=this.getMainWidget().getContainer(),l="ew-resize"):(o=this.getYAxisWidget().getContainer(),l="ns-resize"),!((a=(n=t.axisOptions)===null||n===void 0?void 0:n.scrollZoomEnabled)!==null&&a!==void 0)||a?o.style.cursor=l:o.style.cursor="default",this},e.prototype.getOptions=function(){return this._options},e.prototype.getAxisComponent=function(){return this._axis},e.prototype.setBounding=function(t,r,n){var a,s;yt(this.getBounding(),t);var o={};return T(t.height)&&(o.height=t.height),T(t.top)&&(o.top=t.top),this._mainWidget.setBounding(o),(a=this._yAxisWidget)===null||a===void 0||a.setBounding(o),T(r)&&this._mainWidget.setBounding(r),T(n)&&((s=this._yAxisWidget)===null||s===void 0||s.setBounding(n)),this},e.prototype.getMainWidget=function(){return this._mainWidget},e.prototype.getYAxisWidget=function(){return this._yAxisWidget},e.prototype.updateImp=function(t){var r;this._mainWidget.update(t),(r=this._yAxisWidget)===null||r===void 0||r.update(t)},e.prototype.destroy=function(){var t;i.prototype.destroy.call(this),this._mainWidget.destroy(),(t=this._yAxisWidget)===null||t===void 0||t.destroy()},e.prototype.getImage=function(t){var r=this.getBounding(),n=r.width,a=r.height,s=Rt("canvas",{width:"".concat(n,"px"),height:"".concat(a,"px"),boxSizing:"border-box"}),o=s.getContext("2d"),l=Yt(s);s.width=n*l,s.height=a*l,o.scale(l,l);var u=this._mainWidget.getBounding();if(o.drawImage(this._mainWidget.getImage(t),u.left,0,u.width,u.height),this._yAxisWidget!==null){var c=this._yAxisWidget.getBounding();o.drawImage(this._yAxisWidget.getImage(t),c.left,0,c.width,c.height)}return s},e.prototype.createYAxisWidget=function(t){return null},e}(vi),fi=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.createAxisComponent=function(t){var r=Ka(t??"default");return new r(this)},e.prototype.createMainWidget=function(t){return new si(t,this)},e.prototype.createYAxisWidget=function(t){return new ja(t,this)},e}(di),Qa=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.createMainWidget=function(t){return new Ha(t,this)},e}(fi),Ja=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.getAxisStyles=function(t){return t.xAxis},e.prototype.createAxisLine=function(t){return{coordinates:[{x:0,y:0},{x:t.width,y:0}]}},e.prototype.createTickLines=function(t,r,n){var a=n.tickLine,s=n.axisLine.size;return t.map(function(o){return{coordinates:[{x:o.coord,y:0},{x:o.coord,y:s+a.length}]}})},e.prototype.createTickTexts=function(t,r,n){var a=n.tickText,s=n.axisLine.size,o=n.tickLine.length;return t.map(function(l){return{x:l.coord,y:s+o+a.marginStart,text:l.text,align:"center",baseline:"top"}})},e}(li),to=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},e.prototype.coordinateToPointValueFlag=function(){return!1},e.prototype.getCompleteOverlays=function(t){return t.getInstances()},e.prototype.getProgressOverlay=function(t){return t.instance},e.prototype.getDefaultFigures=function(t,r,n,a,s,o,l,u,c,h,f){var d,v=[];if(t.needDefaultXAxisFigure&&t.id===((d=f.instance)===null||d===void 0?void 0:d.id)){var p=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;r.forEach(function(m,_){p=Math.min(p,m.x),g=Math.max(g,m.x);var S=t.points[_];if(R(S.timestamp)){var y=o.formatDate(s,S.timestamp,"YYYY-MM-DD HH:mm",lt.Crosshair);v.push({type:"text",attrs:{x:m.x,y:0,text:y,align:"center"},ignoreEvent:!0})}}),r.length>1&&v.unshift({type:"rect",attrs:{x:p,y:0,width:g-p,height:n.height},ignoreEvent:!0})}return v},e.prototype.getFigures=function(t,r,n,a,s,o,l,u,c,h,f){var d,v;return(v=(d=t.createXAxisFigures)===null||d===void 0?void 0:d.call(t,{overlay:t,coordinates:r,bounding:n,barSpace:a,precision:s,thousandsSeparator:o,decimalFoldThreshold:l,dateTimeFormat:u,defaultStyles:c,xAxis:h,yAxis:f}))!==null&&v!==void 0?v:[]},e}(ui),eo=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.compare=function(t){return T(t.kLineData)&&t.dataIndex===t.realDataIndex},e.prototype.getDirectionStyles=function(t){return t.vertical},e.prototype.getText=function(t,r){var n,a=(n=t.kLineData)===null||n===void 0?void 0:n.timestamp;return r.getCustomApi().formatDate(r.getTimeScaleStore().getDateTimeFormat(),a,"YYYY-MM-DD HH:mm",lt.Crosshair)},e.prototype.getTextAttrs=function(t,r,n,a,s,o){var l=n.realX,u,c="center";return l-r/2-o.paddingLeft<0?(u=0,c="left"):l+r/2+o.paddingRight>a.width?(u=a.width,c="right"):u=l,{x:u,y:0,text:t,align:c,baseline:"top"}},e}(ci),ro=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._xAxisView=new Ja(n),n._overlayXAxisView=new to(n),n._crosshairVerticalLabelView=new eo(n),n.getContainer().style.cursor="ew-resize",n.addChild(n._overlayXAxisView),n}return e.prototype.getName=function(){return z.X_AXIS},e.prototype.updateMain=function(t){this._xAxisView.draw(t)},e.prototype.updateOverlay=function(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)},e}(er),io=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.calcRange=function(){var t=this.getParent().getChart().getChartStore(),r=t.getTimeScaleStore().getVisibleRange(),n=r.from,a=r.to,s=n,o=a-1,l=a-n;return{from:s,to:o,range:l,realFrom:s,realTo:o,realRange:l}},e.prototype.optimalTicks=function(t){var r,n,a=this.getParent().getChart(),s=a.getChartStore(),o=s.getCustomApi().formatDate,l=[],u=t.length,c=s.getDataList();if(u>0){var h=s.getTimeScaleStore().getDateTimeFormat(),f=a.getStyles().xAxis.tickText,d=Ee("00-00 00:00",f.size,f.weight,f.family),v=parseInt(t[0].value,10),p=this.convertToPixel(v),g=1;if(u>1){var m=parseInt(t[1].value,10),_=this.convertToPixel(m),S=Math.abs(_-p);S<d&&(g=Math.ceil(d/S))}for(var y=0;y<u;y+=g){var x=parseInt(t[y].value,10),w=c[x],b=w.timestamp,I=o(h,b,"HH:mm",lt.XAxis);if(y!==0){var C=parseInt(t[y-g].value,10),P=c[C],M=P.timestamp;I=(r=this._optimalTickLabel(o,h,b,M))!==null&&r!==void 0?r:I}var E=this.convertToPixel(x);l.push({text:I,coord:E,value:b})}var D=l.length;if(D===1)l[0].text=o(h,l[0].value,"YYYY-MM-DD HH:mm",lt.XAxis);else{var k=l[0].value,V=l[1].value;if(T(l[2])){var F=l[2].text;/^[0-9]{2}-[0-9]{2}$/.test(F)?l[0].text=o(h,k,"MM-DD",lt.XAxis):/^[0-9]{4}-[0-9]{2}$/.test(F)?l[0].text=o(h,k,"YYYY-MM",lt.XAxis):/^[0-9]{4}$/.test(F)&&(l[0].text=o(h,k,"YYYY",lt.XAxis))}else l[0].text=(n=this._optimalTickLabel(o,h,k,V))!==null&&n!==void 0?n:l[0].text}}return l},e.prototype._optimalTickLabel=function(t,r,n,a){var s=t(r,n,"YYYY",lt.XAxis),o=t(r,n,"YYYY-MM",lt.XAxis),l=t(r,n,"MM-DD",lt.XAxis);return s!==t(r,a,"YYYY",lt.XAxis)?s:o!==t(r,a,"YYYY-MM",lt.XAxis)?o:l!==t(r,a,"MM-DD",lt.XAxis)?l:null},e.prototype.getAutoSize=function(){var t=this.getParent().getChart().getStyles(),r=t.xAxis,n=r.size;if(n!=="auto")return n;var a=t.crosshair,s=0;r.show&&(r.axisLine.show&&(s+=r.axisLine.size),r.tickLine.show&&(s+=r.tickLine.length),r.tickText.show&&(s+=r.tickText.marginStart+r.tickText.marginEnd+r.tickText.size));var o=0;return a.show&&a.vertical.show&&a.vertical.text.show&&(o+=a.vertical.text.paddingTop+a.vertical.text.paddingBottom+a.vertical.text.borderSize*2+a.vertical.text.size),Math.max(s,o)},e.prototype.getSelfBounding=function(){return this.getParent().getMainWidget().getBounding()},e.prototype.convertTimestampFromPixel=function(t){var r=this.getParent().getChart().getChartStore().getTimeScaleStore(),n=r.coordinateToDataIndex(t);return r.dataIndexToTimestamp(n)},e.prototype.convertTimestampToPixel=function(t){var r=this.getParent().getChart().getChartStore().getTimeScaleStore(),n=r.timestampToDataIndex(t);return r.dataIndexToCoordinate(n)},e.prototype.convertFromPixel=function(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)},e.prototype.convertToPixel=function(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)},e.extend=function(t){var r=function(n){N(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a.prototype.createTicks=function(s){return t.createTicks(s)},a}(e);return r},e}(hi),no={name:"default",createTicks:function(i){var e=i.defaultTicks;return e}},xr={default:io.extend(no)};function ao(i){var e;return(e=xr[i])!==null&&e!==void 0?e:xr.default}var oo=function(i){N(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.createAxisComponent=function(t){var r=ao(t);return new r(this)},e.prototype.createMainWidget=function(t){return new ro(t,this)},e}(di);function so(i,e){var t=0;return function(){var r=Date.now();r-t>e&&(i.apply(this,arguments),t=r)}}var lo=function(i){N(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._dragFlag=!1,n._dragStartY=0,n._topPaneHeight=0,n._bottomPaneHeight=0,n._pressedMouseMoveEvent=so(n._pressedTouchMouseMoveEvent,20),n.registerEvent("touchStartEvent",n._mouseDownEvent.bind(n)).registerEvent("touchMoveEvent",n._pressedMouseMoveEvent.bind(n)).registerEvent("touchEndEvent",n._mouseUpEvent.bind(n)).registerEvent("mouseDownEvent",n._mouseDownEvent.bind(n)).registerEvent("mouseUpEvent",n._mouseUpEvent.bind(n)).registerEvent("pressedMouseMoveEvent",n._pressedMouseMoveEvent.bind(n)).registerEvent("mouseEnterEvent",n._mouseEnterEvent.bind(n)).registerEvent("mouseLeaveEvent",n._mouseLeaveEvent.bind(n)),n}return e.prototype.getName=function(){return z.SEPARATOR},e.prototype.checkEventOn=function(){return!0},e.prototype._mouseDownEvent=function(t){this._dragFlag=!0,this._dragStartY=t.pageY;var r=this.getPane();return this._topPaneHeight=r.getTopPane().getBounding().height,this._bottomPaneHeight=r.getBottomPane().getBounding().height,!0},e.prototype._mouseUpEvent=function(){return this._dragFlag=!1,this._mouseLeaveEvent()},e.prototype._pressedTouchMouseMoveEvent=function(t){var r=t.pageY-this._dragStartY,n=this.getPane(),a=n.getTopPane(),s=n.getBottomPane(),o=r<0;if(a!==null&&(s!=null&&s.getOptions().dragEnabled)){var l=void 0,u=void 0,c=void 0,h=void 0;o?(l=a,u=s,c=this._topPaneHeight,h=this._bottomPaneHeight):(l=s,u=a,c=this._bottomPaneHeight,h=this._topPaneHeight);var f=l.getOptions().minHeight;if(c>f){var d=Math.max(c-Math.abs(r),f),v=c-d;l.setBounding({height:d}),u.setBounding({height:h+v});var p=n.getChart();p.getChartStore().getActionStore().execute(_t.OnPaneDrag,{paneId:n.getId()}),p.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0},e.prototype._mouseEnterEvent=function(){var t,r=this.getPane(),n=r.getBottomPane();if((t=n==null?void 0:n.getOptions().dragEnabled)!==null&&t!==void 0&&t){var a=r.getChart(),s=a.getStyles().separator;return this.getContainer().style.background=s.activeBackgroundColor,!0}return!1},e.prototype._mouseLeaveEvent=function(){return this._dragFlag?!1:(this.getContainer().style.background="",!0)},e.prototype.createContainer=function(){return Rt("div",{width:"100%",height:"".concat(ge,"px"),margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})},e.prototype.updateImp=function(t,r,n){if(n===4||n===2){var a=this.getPane().getChart().getStyles().separator;t.style.top="".concat(-Math.floor((ge-a.size)/2),"px"),t.style.height="".concat(ge,"px")}},e}(Jr),br=function(i){N(e,i);function e(t,r,n,a,s,o){var l=i.call(this,t,r,n,a)||this;return l.getContainer().style.overflow="",l._topPane=s,l._bottomPane=o,l._separatorWidget=new lo(l.getContainer(),l),l}return e.prototype.setBounding=function(t){return yt(this.getBounding(),t),this},e.prototype.getTopPane=function(){return this._topPane},e.prototype.setTopPane=function(t){return this._topPane=t,this},e.prototype.getBottomPane=function(){return this._bottomPane},e.prototype.setBottomPane=function(t){return this._bottomPane=t,this},e.prototype.getWidget=function(){return this._separatorWidget},e.prototype.getImage=function(t){var r=this.getBounding(),n=r.width,a=r.height,s=this.getChart().getStyles().separator,o=Rt("canvas",{width:"".concat(n,"px"),height:"".concat(a,"px"),boxSizing:"border-box"}),l=o.getContext("2d"),u=Yt(o);return o.width=n*u,o.height=a*u,l.scale(u,u),l.fillStyle=s.color,l.fillRect(0,0,n,a),o},e.prototype.updateImp=function(t,r,n){if(t===4||t===2){var a=this.getChart().getStyles().separator;r.style.backgroundColor=a.color,r.style.height="".concat(n.height,"px"),r.style.marginLeft="".concat(n.left,"px"),r.style.width="".concat(n.width,"px"),this._separatorWidget.update(t)}},e}(vi);function wr(){var i;return typeof window>"u"?!1:((i=window.navigator.userAgent.toLowerCase().indexOf("firefox"))!==null&&i!==void 0?i:-1)>-1}function Ye(){return typeof window>"u"?!1:/iPhone|iPad|iPod/.test(window.navigator.platform)}var uo=10,co=function(){function i(e,t,r){var n=this;this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!Ye(),this._onFirefoxOutsideMouseUp=function(a){n._mouseUpHandler(a)},this._onMobileSafariDoubleClick=function(a){if(n._firesTouchEvents(a)){if(++n._tapCount,n._tapTimeoutId!==null&&n._tapCount>1){var s=n._mouseTouchMoveWithDownInfo(n._getCoordinate(a),n._tapCoordinate).manhattanDistance;s<30&&!n._cancelTap&&n._processEvent(n._makeCompatEvent(a),n._handler.doubleTapEvent),n._resetTapTimeout()}}else if(++n._clickCount,n._clickTimeoutId!==null&&n._clickCount>1){var s=n._mouseTouchMoveWithDownInfo(n._getCoordinate(a),n._clickCoordinate).manhattanDistance;s<5&&!n._cancelClick&&n._processEvent(n._makeCompatEvent(a),n._handler.mouseDoubleClickEvent),n._resetClickTimeout()}},this._target=e,this._handler=t,this._options=r,this._init()}return i.prototype.destroy=function(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()},i.prototype._mouseEnterHandler=function(e){var t=this,r,n,a;(r=this._unsubscribeMousemove)===null||r===void 0||r.call(this),(n=this._unsubscribeMouseWheel)===null||n===void 0||n.call(this),(a=this._unsubscribeContextMenu)===null||a===void 0||a.call(this);var s=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){t._target.removeEventListener("mousemove",s)},this._target.addEventListener("mousemove",s);var o=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=function(){t._target.removeEventListener("wheel",o)},this._target.addEventListener("wheel",o,{passive:!1});var l=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=function(){t._target.removeEventListener("contextmenu",l)},this._target.addEventListener("contextmenu",l,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)},i.prototype._resetClickTimeout=function(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},i.prototype._resetTapTimeout=function(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},i.prototype._mouseMoveHandler=function(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)},i.prototype._mouseWheelHandler=function(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!T(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!T(this._handler.mouseWheelVertEvent))return;var t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:t*=120;break;case e.DOM_DELTA_LINE:t*=32;break}if(t!==0){var r=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),r)}}},i.prototype._contextMenuHandler=function(e){this._preventDefault(e)},i.prototype._touchMoveHandler=function(e){var t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t!==null&&(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate===null&&!this._preventTouchDragProcess)){this._pinchPrevented=!0;var r=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),n=r.xOffset,a=r.yOffset,s=r.manhattanDistance;if(!(!this._touchMoveExceededManhattanDistance&&s<5)){if(!this._touchMoveExceededManhattanDistance){var o=n*.5,l=a>=o&&!this._options.treatVertDragAsPageScroll(),u=o>a&&!this._options.treatHorzDragAsPageScroll();!l&&!u&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}},i.prototype._mouseMoveWithDownHandler=function(e){if(e.button===0){var t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),r=t.manhattanDistance;r>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}},i.prototype._mouseTouchMoveWithDownInfo=function(e,t){var r=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),a=r+n;return{xOffset:r,yOffset:n,manhattanDistance:a}},i.prototype._touchEndHandler=function(e){var t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t!==null){this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);var r=this._makeCompatEvent(e,t);if(this._processEvent(r,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){var n=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate).manhattanDistance;n<30&&!this._cancelTap&&this._processEvent(r,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(r,this._handler.tapEvent),T(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}},i.prototype._mouseUpHandler=function(e){if(e.button===0){var t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),wr()){var r=this._target.ownerDocument.documentElement;r.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){var n=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate).manhattanDistance;n<5&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}},i.prototype._clearLongTapTimeout=function(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)},i.prototype._touchStartHandler=function(e){if(this._activeTouchId===null){var t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);var r=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{var n=this._touchMoveHandler.bind(this),a=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=function(){r.removeEventListener("touchmove",n),r.removeEventListener("touchend",a)},r.addEventListener("touchmove",n,{passive:!1}),r.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),500)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(t))}},i.prototype._mouseDownHandler=function(e){if(e.button===2){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button===0){var t=this._target.ownerDocument.documentElement;wr()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{var r=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=function(){t.removeEventListener("mousemove",r),t.removeEventListener("mouseup",n)},t.addEventListener("mousemove",r),t.addEventListener("mouseup",n)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(e)))}},i.prototype._init=function(){var e=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{var t=this._target.ownerDocument,r=function(n){e._handler.mouseDownOutsideEvent!=null&&(n.composed&&e._target.contains(n.composedPath()[0])||n.target!==null&&e._target.contains(n.target)||e._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=function(){t.removeEventListener("touchstart",r)},this._unsubscribeOutsideMouseEvents=function(){t.removeEventListener("mousedown",r)},t.addEventListener("mousedown",r),t.addEventListener("touchstart",r,{passive:!0})}Ye()&&(this._unsubscribeMobileSafariEvents=function(){e._target.removeEventListener("dblclick",e._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",function(n){if(n.button===1)return n.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",function(){},{passive:!1})},i.prototype._initPinch=function(){var e=this;!T(this._handler.pinchStartEvent)&&!T(this._handler.pinchEvent)&&!T(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",function(t){e._checkPinchState(t.touches)},{passive:!0}),this._target.addEventListener("touchmove",function(t){if(!(t.touches.length!==2||e._startPinchMiddleCoordinate===null)&&T(e._handler.pinchEvent)){var r=e._getTouchDistance(t.touches[0],t.touches[1]),n=r/e._startPinchDistance;e._handler.pinchEvent(B(B({},e._startPinchMiddleCoordinate),{pageX:0,pageY:0}),n),e._preventDefault(t)}},{passive:!1}),this._target.addEventListener("touchend",function(t){e._checkPinchState(t.touches)}))},i.prototype._checkPinchState=function(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)},i.prototype._startPinch=function(e){var t,r=(t=this._target.getBoundingClientRect())!==null&&t!==void 0?t:{left:0,top:0};this._startPinchMiddleCoordinate={x:(e[0].clientX-r.left+(e[1].clientX-r.left))/2,y:(e[0].clientY-r.top+(e[1].clientY-r.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),T(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()},i.prototype._stopPinch=function(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,T(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))},i.prototype._mouseLeaveHandler=function(e){var t,r,n;(t=this._unsubscribeMousemove)===null||t===void 0||t.call(this),(r=this._unsubscribeMouseWheel)===null||r===void 0||r.call(this),(n=this._unsubscribeContextMenu)===null||n===void 0||n.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!Ye())},i.prototype._longTapHandler=function(e){var t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)},i.prototype._firesTouchEvents=function(e){var t;return T((t=e.sourceCapabilities)===null||t===void 0?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+500},i.prototype._processEvent=function(e,t){t==null||t.call(this._handler,e)},i.prototype._makeCompatEvent=function(e,t){var r=this,n,a=t??e,s=(n=this._target.getBoundingClientRect())!==null&&n!==void 0?n:{left:0,top:0};return{x:a.clientX-s.left,y:a.clientY-s.top,pageX:a.pageX,pageY:a.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:function(){e.type!=="touchstart"&&r._preventDefault(e)}}},i.prototype._getTouchDistance=function(e,t){var r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)},i.prototype._preventDefault=function(e){e.cancelable&&e.preventDefault()},i.prototype._getCoordinate=function(e){return{x:e.pageX,y:e.pageY}},i.prototype._eventTimeStamp=function(e){var t;return(t=e.timeStamp)!==null&&t!==void 0?t:performance.now()},i.prototype._touchWithId=function(e,t){for(var r=0;r<e.length;++r)if(e[r].identifier===t)return e[r];return null},i}(),ho=function(){function i(e,t){var r=this;this._flingStartTime=new Date().getTime(),this._flingScrollRequestId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=function(n){if(n.shiftKey)switch(n.code){case"Equal":{r._chart.getChartStore().getTimeScaleStore().zoom(.5);break}case"Minus":{r._chart.getChartStore().getTimeScaleStore().zoom(-.5);break}case"ArrowLeft":{var a=r._chart.getChartStore().getTimeScaleStore();a.startScroll(),a.scroll(-3*a.getBarSpace().bar);break}case"ArrowRight":{var a=r._chart.getChartStore().getTimeScaleStore();a.startScroll(),a.scroll(3*a.getBarSpace().bar);break}}},this._container=e,this._chart=t,this._event=new co(e,this,{treatVertDragAsPageScroll:function(){return!1},treatHorzDragAsPageScroll:function(){return!1}}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}return i.prototype.pinchStartEvent=function(){return this._touchZoomed=!0,this._pinchScale=1,!0},i.prototype.pinchEvent=function(e,t){var r=this._findWidgetByEvent(e),n=r.pane,a=r.widget;if((n==null?void 0:n.getId())!==Y.X_AXIS&&(a==null?void 0:a.getName())===z.MAIN){var s=this._makeWidgetEvent(e,a),o=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().getTimeScaleStore().zoom(o,{x:s.x,y:s.y}),!0}return!1},i.prototype.mouseWheelHortEvent=function(e,t){var r=this._chart.getChartStore().getTimeScaleStore();return r.startScroll(),r.scroll(t),!0},i.prototype.mouseWheelVertEvent=function(e,t){var r=this._findWidgetByEvent(e).widget,n=this._makeWidgetEvent(e,r),a=r==null?void 0:r.getName();return a===z.MAIN?(this._chart.getChartStore().getTimeScaleStore().zoom(t,{x:n.x,y:n.y}),!0):!1},i.prototype.mouseDownEvent=function(e){var t,r,n=this._findWidgetByEvent(e),a=n.pane,s=n.widget;if(this._mouseDownWidget=s,s!==null){var o=this._makeWidgetEvent(e,s),l=s.getName();switch(l){case z.SEPARATOR:return s.dispatchEvent("mouseDownEvent",o);case z.MAIN:{var u=(t=a.getAxisComponent().getRange())!==null&&t!==void 0?t:null;return this._prevYAxisRange=u===null?u:B({},u),this._startScrollCoordinate={x:o.x,y:o.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),s.dispatchEvent("mouseDownEvent",o)}case z.X_AXIS:{var c=s.dispatchEvent("mouseDownEvent",o);return c&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:o.x,y:o.y},this._xAxisStartScaleDistance=o.pageX,c}case z.Y_AXIS:{var c=s.dispatchEvent("mouseDownEvent",o);c&&this._chart.updatePane(1);var u=(r=a.getAxisComponent().getRange())!==null&&r!==void 0?r:null;return this._prevYAxisRange=u===null?u:B({},u),this._yAxisStartScaleDistance=o.pageY,c}}}return!1},i.prototype.mouseMoveEvent=function(e){var t,r,n,a=this._findWidgetByEvent(e),s=a.pane,o=a.widget,l=this._makeWidgetEvent(e,o);if((((t=this._mouseMoveTriggerWidgetInfo.pane)===null||t===void 0?void 0:t.getId())!==(s==null?void 0:s.getId())||((r=this._mouseMoveTriggerWidgetInfo.widget)===null||r===void 0?void 0:r.getName())!==(o==null?void 0:o.getName()))&&(o==null||o.dispatchEvent("mouseEnterEvent",l),(n=this._mouseMoveTriggerWidgetInfo.widget)===null||n===void 0||n.dispatchEvent("mouseLeaveEvent",l),this._mouseMoveTriggerWidgetInfo={pane:s,widget:o}),o!==null){var u=o.getName();switch(u){case z.MAIN:{var c=o.dispatchEvent("mouseMoveEvent",l),h=this._chart.getChartStore(),f={x:l.x,y:l.y,paneId:s==null?void 0:s.getId()};return c&&h.getTooltipStore().getActiveIcon()!==null&&(f=void 0,o!==null&&(o.getContainer().style.cursor="pointer")),this._chart.getChartStore().getTooltipStore().setCrosshair(f),c}case z.SEPARATOR:case z.X_AXIS:case z.Y_AXIS:{var c=o.dispatchEvent("mouseMoveEvent",l);return this._chart.getChartStore().getTooltipStore().setCrosshair(),c}}}return!1},i.prototype.pressedMouseMoveEvent=function(e){var t,r,n,a,s;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===z.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);var o=this._findWidgetByEvent(e),l=o.pane,u=o.widget;if(u!==null&&((t=this._mouseDownWidget)===null||t===void 0?void 0:t.getPane().getId())===(l==null?void 0:l.getId())&&((r=this._mouseDownWidget)===null||r===void 0?void 0:r.getName())===u.getName()){var c=this._makeWidgetEvent(e,u),h=u.getName();switch(h){case z.MAIN:{var f=u.getBounding(),d=u.dispatchEvent("pressedMouseMoveEvent",c);if(!d&&this._startScrollCoordinate!==null){var v=l.getAxisComponent();if(this._prevYAxisRange!==null&&!v.getAutoCalcTickFlag()&&v.getScrollZoomEnabled()){var p=this._prevYAxisRange,g=p.from,m=p.to,_=p.range,S;(n=v==null?void 0:v.isReverse())!==null&&n!==void 0&&n?S=this._startScrollCoordinate.y-c.y:S=c.y-this._startScrollCoordinate.y;var y=S/f.height,x=_*y,w=g+x,b=m+x,I=v.convertToRealValue(w),C=v.convertToRealValue(b);v.setRange({from:w,to:b,range:b-w,realFrom:I,realTo:C,realRange:C-I})}var P=c.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(P)}return this._chart.getChartStore().getTooltipStore().setCrosshair({x:c.x,y:c.y,paneId:l==null?void 0:l.getId()}),d}case z.X_AXIS:{var d=u.dispatchEvent("pressedMouseMoveEvent",c);if(d)this._chart.updatePane(1);else{var M=l.getAxisComponent();if(!((a=M==null?void 0:M.getScrollZoomEnabled())!==null&&a!==void 0)||a){var y=this._xAxisStartScaleDistance/c.pageX;if(Number.isFinite(y)){var E=(y-this._xAxisScale)*10;this._xAxisScale=y,this._chart.getChartStore().getTimeScaleStore().zoom(E,(s=this._xAxisStartScaleCoordinate)!==null&&s!==void 0?s:void 0)}}}return d}case z.Y_AXIS:{var d=u.dispatchEvent("pressedMouseMoveEvent",c);if(d)this._chart.updatePane(1);else{var v=l.getAxisComponent();if(this._prevYAxisRange!==null&&v.getScrollZoomEnabled()){var D=this._prevYAxisRange,g=D.from,m=D.to,_=D.range,y=c.pageY/this._yAxisStartScaleDistance,k=_*y,x=(k-_)/2,w=g-x,b=m+x,I=v.convertToRealValue(w),C=v.convertToRealValue(b);v.setRange({from:w,to:b,range:k,realFrom:I,realTo:C,realRange:C-I}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}}return d}}}return!1},i.prototype.mouseUpEvent=function(e){var t=this._findWidgetByEvent(e).widget,r=!1;if(t!==null){var n=this._makeWidgetEvent(e,t),a=t.getName();switch(a){case z.MAIN:case z.SEPARATOR:case z.X_AXIS:case z.Y_AXIS:{r=t.dispatchEvent("mouseUpEvent",n);break}}r&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,r},i.prototype.mouseClickEvent=function(e){var t=this._findWidgetByEvent(e).widget;if(t!==null){var r=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",r)}return!1},i.prototype.mouseRightClickEvent=function(e){var t=this._findWidgetByEvent(e).widget,r=!1;if(t!==null){var n=this._makeWidgetEvent(e,t),a=t.getName();switch(a){case z.MAIN:case z.X_AXIS:case z.Y_AXIS:{r=t.dispatchEvent("mouseRightClickEvent",n);break}}r&&this._chart.updatePane(1)}return!1},i.prototype.mouseDoubleClickEvent=function(e){var t=this._findWidgetByEvent(e),r=t.pane,n=t.widget;if(n!==null){var a=n.getName();switch(a){case z.MAIN:{var s=this._makeWidgetEvent(e,n);return n.dispatchEvent("mouseDoubleClickEvent",s)}case z.Y_AXIS:{var o=r.getAxisComponent();if(!o.getAutoCalcTickFlag())return o.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0;break}}}return!1},i.prototype.mouseLeaveEvent=function(){return this._chart.getChartStore().getTooltipStore().setCrosshair(),!0},i.prototype.touchStartEvent=function(e){var t=this._findWidgetByEvent(e),r=t.pane,n=t.widget;if(n!==null){var a=this._makeWidgetEvent(e,n),s=n.getName();switch(s){case z.MAIN:{var o=this._chart.getChartStore(),l=o.getTooltipStore();if(n.dispatchEvent("mouseDownEvent",a))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0;if(this._flingScrollRequestId!==null&&(dr(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime(),this._startScrollCoordinate={x:a.x,y:a.y},o.getTimeScaleStore().startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){var u=a.x-this._touchCoordinate.x,c=a.y-this._touchCoordinate.y,h=Math.sqrt(u*u+c*c);h<uo?(this._touchCoordinate={x:a.x,y:a.y},l.setCrosshair({x:a.x,y:a.y,paneId:r==null?void 0:r.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case z.X_AXIS:case z.Y_AXIS:{var f=n.dispatchEvent("mouseDownEvent",a);return f&&this._chart.updatePane(1),f}}}return!1},i.prototype.touchMoveEvent=function(e){var t,r,n,a=this._findWidgetByEvent(e),s=a.pane,o=a.widget;if(o!==null){var l=this._makeWidgetEvent(e,o),u=o.getName(),c=this._chart.getChartStore(),h=c.getTooltipStore();switch(u){case z.MAIN:{if(o.dispatchEvent("pressedMouseMoveEvent",l))return(t=l.preventDefault)===null||t===void 0||t.call(l),h.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0;if(this._touchCoordinate!==null)(r=l.preventDefault)===null||r===void 0||r.call(l),h.setCrosshair({x:l.x,y:l.y,paneId:s==null?void 0:s.getId()});else if(this._startScrollCoordinate!==null&&Math.abs(this._startScrollCoordinate.x-l.x)>this._startScrollCoordinate.y-l.y){var f=l.x-this._startScrollCoordinate.x;c.getTimeScaleStore().scroll(f)}return!0}case z.X_AXIS:case z.Y_AXIS:{var d=o.dispatchEvent("pressedMouseMoveEvent",l);return d&&((n=l.preventDefault)===null||n===void 0||n.call(l),this._chart.updatePane(1)),d}}}return!1},i.prototype.touchEndEvent=function(e){var t=this,r=this._findWidgetByEvent(e).widget;if(r!==null){var n=this._makeWidgetEvent(e,r),a=r.getName();switch(a){case z.MAIN:{if(r.dispatchEvent("mouseUpEvent",n),this._startScrollCoordinate!==null){var s=new Date().getTime()-this._flingStartTime,o=n.x-this._startScrollCoordinate.x,l=o/(s>0?s:1)*20;if(s<200&&Math.abs(l)>0){var u=this._chart.getChartStore().getTimeScaleStore(),c=function(){t._flingScrollRequestId=Pe(function(){u.startScroll(),u.scroll(l),l=l*(1-.025),Math.abs(l)<1?t._flingScrollRequestId!==null&&(dr(t._flingScrollRequestId),t._flingScrollRequestId=null):c()})};c()}}return!0}case z.X_AXIS:case z.Y_AXIS:{var h=r.dispatchEvent("mouseUpEvent",n);h&&this._chart.updatePane(1)}}}return!1},i.prototype.tapEvent=function(e){var t=this._findWidgetByEvent(e),r=t.pane,n=t.widget,a=!1;if(n!==null){var s=this._makeWidgetEvent(e,n),o=n.dispatchEvent("mouseClickEvent",s);if(n.getName()===z.MAIN){var l=this._makeWidgetEvent(e,n),u=this._chart.getChartStore(),c=u.getTooltipStore();o?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),a=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:r==null?void 0:r.getId()},{notInvalidate:!0}),a=!0),this._touchCancelCrosshair=!1)}(a||o)&&this._chart.updatePane(1)}return a},i.prototype.doubleTapEvent=function(e){return this.mouseDoubleClickEvent(e)},i.prototype.longTapEvent=function(e){var t=this._findWidgetByEvent(e),r=t.pane,n=t.widget;if(n!==null&&n.getName()===z.MAIN){var a=this._makeWidgetEvent(e,n);return this._touchCoordinate={x:a.x,y:a.y},this._chart.getChartStore().getTooltipStore().setCrosshair({x:a.x,y:a.y,paneId:r==null?void 0:r.getId()}),!0}return!1},i.prototype._findWidgetByEvent=function(e){var t,r,n,a,s=e.x,o=e.y,l=this._chart.getAllSeparatorPanes(),u=this._chart.getChartStore().getStyles().separator.size;try{for(var c=Jt(l),h=c.next();!h.done;h=c.next()){var f=ee(h.value,2),d=f[1],v=d.getBounding(),p=v.top-Math.round((ge-u)/2);if(s>=v.left&&s<=v.left+v.width&&o>=p&&o<=p+ge)return{pane:d,widget:d.getWidget()}}}catch(P){t={error:P}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var g=this._chart.getAllDrawPanes(),m=null;try{for(var _=Jt(g),S=_.next();!S.done;S=_.next()){var y=S.value,v=y.getBounding();if(s>=v.left&&s<=v.left+v.width&&o>=v.top&&o<=v.top+v.height){m=y;break}}}catch(P){n={error:P}}finally{try{S&&!S.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}var x=null;if(m!==null){if(x===null){var w=m.getMainWidget(),b=w.getBounding();s>=b.left&&s<=b.left+b.width&&o>=b.top&&o<=b.top+b.height&&(x=w)}if(x===null){var I=m.getYAxisWidget();if(I!==null){var C=I.getBounding();s>=C.left&&s<=C.left+C.width&&o>=C.top&&o<=C.top+C.height&&(x=I)}}}return{pane:m,widget:x}},i.prototype._makeWidgetEvent=function(e,t){var r,n,a,s=(r=t==null?void 0:t.getBounding())!==null&&r!==void 0?r:null;return B(B({},e),{x:e.x-((n=s==null?void 0:s.left)!==null&&n!==void 0?n:0),y:e.y-((a=s==null?void 0:s.top)!==null&&a!==void 0?a:0)})},i.prototype.destroy=function(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()},i}(),Pt;(function(i){i.Root="root",i.Main="main",i.YAxis="yAxis"})(Pt||(Pt={}));var pi=function(){function i(e,t){this._drawPanes=[],this._separatorPanes=new Map,this._initContainer(e),this._chartEvent=new ho(this._chartContainer,this),this._chartStore=new fa(this,t),this._initPanes(t),this.adjustPaneViewport(!0,!0,!0)}return i.prototype._initContainer=function(e){this._container=e,this._chartContainer=Rt("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer)},i.prototype._initPanes=function(e){var t=this,r,n=(r=e==null?void 0:e.layout)!==null&&r!==void 0?r:[{type:"candle"}],a=!1,s=!1,o=function(l){if(!s){var u=t._createPane(oo,Y.X_AXIS,l??{});t._xAxisPane=u,s=!0}};n.forEach(function(l){var u,c,h;switch(l.type){case"candle":{if(!a){var f=(u=l.options)!==null&&u!==void 0?u:{};yt(f,{id:Y.CANDLE}),t._candlePane=t._createPane(Qa,Y.CANDLE,f);var d=(c=l.content)!==null&&c!==void 0?c:[];d.forEach(function(p){t.createIndicator(p,!0,f)}),a=!0}break}case"indicator":{var d=(h=l.content)!==null&&h!==void 0?h:[];if(d.length>0){var v;d.forEach(function(g){T(v)?t.createIndicator(g,!0,{id:v}):v=t.createIndicator(g,!0,l.options)})}break}case"xAxis":{o(l.options);break}}}),o({position:"bottom"})},i.prototype._createPane=function(e,t,r){var n=null,a=null,s=r==null?void 0:r.position;switch(s){case"top":{var o=this._drawPanes[0];T(o)&&(a=new e(this._chartContainer,o.getContainer(),this,t,r??{}),n=0);break}case"bottom":break;default:for(var l=this._drawPanes.length-1;l>-1;l--){var u=this._drawPanes[l],c=this._drawPanes[l-1];if((u==null?void 0:u.getOptions().position)==="bottom"&&(c==null?void 0:c.getOptions().position)!=="bottom"){a=new e(this._chartContainer,u.getContainer(),this,t,r??{}),n=l;break}}}T(a)||(a=new e(this._chartContainer,null,this,t,r??{}));var h;if(R(n)?(this._drawPanes.splice(n,0,a),h=n):(this._drawPanes.push(a),h=this._drawPanes.length-1),a.getId()!==Y.X_AXIS){var f=this._drawPanes[h+1];if(T(f)&&f.getId()===Y.X_AXIS&&(f=this._drawPanes[h+2]),T(f)){var d=this._separatorPanes.get(f);T(d)?d.setTopPane(a):(d=new br(this._chartContainer,f.getContainer(),this,"",a,f),this._separatorPanes.set(f,d))}var v=this._drawPanes[h-1];if(T(v)&&v.getId()===Y.X_AXIS&&(v=this._drawPanes[h-2]),T(v)){var d=new br(this._chartContainer,a.getContainer(),this,"",v,a);this._separatorPanes.set(a,d)}}return a},i.prototype._measurePaneHeight=function(){var e=this,t,r=Math.floor(this._container.clientHeight),n=this._chartStore.getStyles().separator.size,a=this._xAxisPane.getAxisComponent().getAutoSize(),s=r-a-this._separatorPanes.size*n;s<0&&(s=0);var o=0;this._drawPanes.forEach(function(c){if(c.getId()!==Y.CANDLE&&c.getId()!==Y.X_AXIS){var h=c.getBounding().height,f=c.getOptions().minHeight;h<f&&(h=f),o+h>s?(o=s,h=Math.max(s-o,0)):o+=h,c.setBounding({height:h})}});var l=s-o;(t=this._candlePane)===null||t===void 0||t.setBounding({height:l}),this._xAxisPane.setBounding({height:a});var u=0;this._drawPanes.forEach(function(c){var h=e._separatorPanes.get(c);T(h)&&(h.setBounding({height:n,top:u}),u+=n),c.setBounding({top:u}),u+=c.getBounding().height})},i.prototype._measurePaneWidth=function(){var e=this,t=Math.floor(this._container.clientWidth),r=this._chartStore.getStyles(),n=r.yAxis,a=n.position===Ht.Left,s=!n.inside,o=0,l=0,u=0,c=0;this._drawPanes.forEach(function(g){g.getId()!==Y.X_AXIS&&(l=Math.max(l,g.getAxisComponent().getAutoSize()))}),l>t&&(l=t),s?(o=t-l,a?(u=0,c=l):(u=t-l,c=0)):(o=t,c=0,a?u=0:u=t-l),this._chartStore.getTimeScaleStore().setTotalBarSpace(o);var h={width:t},f={width:o,left:c},d={width:l,left:u},v=r.separator.fill,p;s&&!v?p=f:p=h,this._drawPanes.forEach(function(g){var m;(m=e._separatorPanes.get(g))===null||m===void 0||m.setBounding(p),g.setBounding(h,f,d)})},i.prototype._setPaneOptions=function(e,t){var r,n;if(O(e.id)){var a=this.getDrawPaneById(e.id),s=!1;if(a!==null){var o=t;if(e.id!==Y.CANDLE&&R(e.height)&&e.height>0){var l=Math.max((r=e.minHeight)!==null&&r!==void 0?r:a.getOptions().minHeight,0),u=Math.max(l,e.height);a.setBounding({height:u}),o=!0,s=!0}(O((n=e.axisOptions)===null||n===void 0?void 0:n.name)||T(e.gap))&&(o=!0),a.setOptions(e),o&&this.adjustPaneViewport(s,!0,!0,!0,!0)}}},i.prototype.getDrawPaneById=function(e){if(e===Y.CANDLE)return this._candlePane;if(e===Y.X_AXIS)return this._xAxisPane;var t=this._drawPanes.find(function(r){return r.getId()===e});return t??null},i.prototype.getContainer=function(){return this._container},i.prototype.getChartStore=function(){return this._chartStore},i.prototype.getXAxisPane=function(){return this._xAxisPane},i.prototype.getAllDrawPanes=function(){return this._drawPanes},i.prototype.getAllSeparatorPanes=function(){return this._separatorPanes},i.prototype.adjustPaneViewport=function(e,t,r,n,a){e&&this._measurePaneHeight();var s=t,o=n??!1,l=a??!1;(o||l)&&this._drawPanes.forEach(function(u){var c=u.getAxisComponent().buildTicks(l);s||(s=c)}),s&&this._measurePaneWidth(),(r??!1)&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))},i.prototype.updatePane=function(e,t){if(T(t)){var r=this.getDrawPaneById(t);r==null||r.update(e)}else this._separatorPanes.forEach(function(n){n.update(e)}),this._drawPanes.forEach(function(n){n.update(e)})},i.prototype.crosshairChange=function(e){var t=this,r=this._chartStore.getActionStore();if(r.has(_t.OnCrosshairChange)){var n={};this._drawPanes.forEach(function(a){var s=a.getId(),o={},l=t._chartStore.getIndicatorStore().getInstances(s);l.forEach(function(u){var c,h=u.result;o[u.name]=h[(c=e.dataIndex)!==null&&c!==void 0?c:h.length-1]}),n[s]=o}),O(e.paneId)&&r.execute(_t.OnCrosshairChange,B(B({},e),{indicatorData:n}))}},i.prototype.getDom=function(e,t){var r,n;if(O(e)){var a=this.getDrawPaneById(e);if(a!==null){var s=t??Pt.Root;switch(s){case Pt.Root:return a.getContainer();case Pt.Main:return a.getMainWidget().getContainer();case Pt.YAxis:return(n=(r=a.getYAxisWidget())===null||r===void 0?void 0:r.getContainer())!==null&&n!==void 0?n:null}}}else return this._chartContainer;return null},i.prototype.getSize=function(e,t){var r,n;if(T(e)){var a=this.getDrawPaneById(e);if(a!==null){var s=t??Pt.Root;switch(s){case Pt.Root:return a.getBounding();case Pt.Main:return a.getMainWidget().getBounding();case Pt.YAxis:return(n=(r=a.getYAxisWidget())===null||r===void 0?void 0:r.getBounding())!==null&&n!==void 0?n:null}}}else return{width:Math.floor(this._chartContainer.clientWidth),height:Math.floor(this._chartContainer.clientHeight),left:0,top:0,right:0,bottom:0};return null},i.prototype.setStyles=function(e){var t,r;this._chartStore.setOptions({styles:e});var n;O(e)?n=Kr(e):n=e,T((t=n==null?void 0:n.yAxis)===null||t===void 0?void 0:t.type)&&((r=this._candlePane)===null||r===void 0||r.getAxisComponent().setAutoCalcTickFlag(!0)),this.adjustPaneViewport(!0,!0,!0,!0,!0)},i.prototype.getStyles=function(){return this._chartStore.getStyles()},i.prototype.setLocale=function(e){this._chartStore.setOptions({locale:e}),this.adjustPaneViewport(!0,!0,!0,!0,!0)},i.prototype.getLocale=function(){return this._chartStore.getLocale()},i.prototype.setCustomApi=function(e){this._chartStore.setOptions({customApi:e}),this.adjustPaneViewport(!0,!0,!0,!0,!0)},i.prototype.setPriceVolumePrecision=function(e,t){this._chartStore.setPrecision({price:e,volume:t})},i.prototype.getPriceVolumePrecision=function(){return this._chartStore.getPrecision()},i.prototype.setTimezone=function(e){this._chartStore.setOptions({timezone:e}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)},i.prototype.getTimezone=function(){return this._chartStore.getTimeScaleStore().getTimezone()},i.prototype.setOffsetRightDistance=function(e){this._chartStore.getTimeScaleStore().setOffsetRightDistance(e,!0)},i.prototype.getOffsetRightDistance=function(){return this._chartStore.getTimeScaleStore().getOffsetRightDistance()},i.prototype.setMaxOffsetLeftDistance=function(e){e<0||this._chartStore.getTimeScaleStore().setMaxOffsetLeftDistance(e)},i.prototype.setMaxOffsetRightDistance=function(e){e<0||this._chartStore.getTimeScaleStore().setMaxOffsetRightDistance(e)},i.prototype.setLeftMinVisibleBarCount=function(e){e<0||this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(e))},i.prototype.setRightMinVisibleBarCount=function(e){e<0||this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(e))},i.prototype.setBarSpace=function(e){this._chartStore.getTimeScaleStore().setBarSpace(e)},i.prototype.getBarSpace=function(){return this._chartStore.getTimeScaleStore().getBarSpace().bar},i.prototype.getVisibleRange=function(){return this._chartStore.getTimeScaleStore().getVisibleRange()},i.prototype.clearData=function(){this._chartStore.clear()},i.prototype.getDataList=function(){return this._chartStore.getDataList()},i.prototype.applyNewData=function(e,t,r){this._chartStore.addData(e,mt.Init,t).then(function(){}).catch(function(){}).finally(function(){r==null||r()})},i.prototype.applyMoreData=function(e,t,r){this._chartStore.addData(e,mt.Forward,t??!0).then(function(){}).catch(function(){}).finally(function(){r==null||r()})},i.prototype.updateData=function(e,t){this._chartStore.addData(e).then(function(){}).catch(function(){}).finally(function(){t==null||t()})},i.prototype.loadMore=function(e){this._chartStore.setLoadMoreCallback(e)},i.prototype.setLoadDataCallback=function(e){this._chartStore.setLoadDataCallback(e)},i.prototype.createIndicator=function(e,t,r,n){var a=this,s,o=O(e)?{name:e}:e;if($r(o.name)===null)return null;var l=r==null?void 0:r.id,u=this.getDrawPaneById(l??"");if(u!==null)this._chartStore.getIndicatorStore().addInstance(o,l??"",t??!1).then(function(f){var d;a._setPaneOptions(r??{},(d=u.getAxisComponent().buildTicks(!0))!==null&&d!==void 0?d:!1)}).catch(function(f){});else{l??(l=Yr(Y.INDICATOR));var c=this._createPane(fi,l,r??{}),h=(s=r==null?void 0:r.height)!==null&&s!==void 0?s:la;c.setBounding({height:h}),this._chartStore.getIndicatorStore().addInstance(o,l,t??!1).finally(function(){a.adjustPaneViewport(!0,!0,!0,!0,!0),n==null||n()})}return l??null},i.prototype.overrideIndicator=function(e,t,r){var n=this;this._chartStore.getIndicatorStore().override(e,t??null).then(function(a){var s=ee(a,2),o=s[0],l=s[1];(o||l)&&(n.adjustPaneViewport(!1,l,!0,l),r==null||r())}).catch(function(){})},i.prototype.getIndicatorByPaneId=function(e,t){return this._chartStore.getIndicatorStore().getInstanceByPaneId(e,t)},i.prototype.removeIndicator=function(e,t){var r,n,a,s=this._chartStore.getIndicatorStore(),o=s.removeInstance(e,t);if(o){var l=!1;if(e!==Y.CANDLE&&!s.hasInstances(e)){var u=this.getDrawPaneById(e),c=this._drawPanes.findIndex(function(m){return m.getId()===e});if(u!==null){l=!0;var h=this._separatorPanes.get(u);if(T(h)){var f=h==null?void 0:h.getTopPane();try{for(var d=Jt(this._separatorPanes),v=d.next();!v.done;v=d.next()){var p=v.value;if(p[1].getTopPane().getId()===u.getId()){p[1].setTopPane(f);break}}}catch(m){r={error:m}}finally{try{v&&!v.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}h.destroy(),this._separatorPanes.delete(u)}this._drawPanes.splice(c,1),u.destroy();var g=this._drawPanes[0];T(g)&&g.getId()===Y.X_AXIS&&(g=this._drawPanes[1]),(a=this._separatorPanes.get(g))===null||a===void 0||a.destroy(),this._separatorPanes.delete(g)}}this.adjustPaneViewport(l,!0,!0,!0,!0)}},i.prototype.createOverlay=function(e,t){var r=[];if(O(e))r=[{name:e}];else if(Ct(e))r=e.map(function(o){return O(o)?{name:o}:o});else{var n=e;r=[n]}var a=!0;(!T(t)||this.getDrawPaneById(t)===null)&&(t=Y.CANDLE,a=!1);var s=this._chartStore.getOverlayStore().addInstances(r,t,a);return Ct(e)?s:s[0]},i.prototype.getOverlayById=function(e){return this._chartStore.getOverlayStore().getInstanceById(e)},i.prototype.overrideOverlay=function(e){this._chartStore.getOverlayStore().override(e)},i.prototype.removeOverlay=function(e){var t;T(e)&&(O(e)?t={id:e}:t=e),this._chartStore.getOverlayStore().removeInstance(t)},i.prototype.setPaneOptions=function(e){this._setPaneOptions(e,!1)},i.prototype.setZoomEnabled=function(e){this._chartStore.getTimeScaleStore().setZoomEnabled(e)},i.prototype.isZoomEnabled=function(){return this._chartStore.getTimeScaleStore().getZoomEnabled()},i.prototype.setScrollEnabled=function(e){this._chartStore.getTimeScaleStore().setScrollEnabled(e)},i.prototype.isScrollEnabled=function(){return this._chartStore.getTimeScaleStore().getScrollEnabled()},i.prototype.scrollByDistance=function(e,t){var r=R(t)&&t>0?t:0,n=this._chartStore.getTimeScaleStore();if(n.startScroll(),r>0){var a=new $e({duration:r});a.doFrame(function(s){var o=e*(s/r);n.scroll(o)}),a.start()}else n.scroll(e)},i.prototype.scrollToRealTime=function(e){var t=this._chartStore.getTimeScaleStore(),r=t.getBarSpace().bar,n=t.getLastBarRightSideDiffBarCount()-t.getInitialOffsetRightDistance()/r,a=n*r;this.scrollByDistance(a,e)},i.prototype.scrollToDataIndex=function(e,t){var r=this._chartStore.getTimeScaleStore(),n=(r.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*r.getBarSpace().bar;this.scrollByDistance(n,t)},i.prototype.scrollToTimestamp=function(e,t){var r=Ue(this.getDataList(),"timestamp",e);this.scrollToDataIndex(r,t)},i.prototype.zoomAtCoordinate=function(e,t,r){var n=R(r)&&r>0?r:0,a=this._chartStore.getTimeScaleStore(),s=a.getBarSpace().bar,o=s*e,l=o-s;if(n>0){var u=0,c=new $e({duration:n});c.doFrame(function(h){var f=l*(h/n),d=(f-u)/a.getBarSpace().bar*je;a.zoom(d,t),u=f}),c.start()}else a.zoom(l/s*je,t)},i.prototype.zoomAtDataIndex=function(e,t,r){var n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:n,y:0},r)},i.prototype.zoomAtTimestamp=function(e,t,r){var n=Ue(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,n,r)},i.prototype.convertToPixel=function(e,t){var r,n=t.paneId,a=n===void 0?Y.CANDLE:n,s=t.absolute,o=s===void 0?!1:s,l=[];if(a!==Y.X_AXIS){var u=this.getDrawPaneById(a);if(u!==null){var c=this._chartStore.getTimeScaleStore(),h=u.getBounding(),f=new Array().concat(e),d=this._xAxisPane.getAxisComponent(),v=u.getAxisComponent();l=f.map(function(p){var g={},m=p.dataIndex;if(R(p.timestamp)&&(m=c.timestampToDataIndex(p.timestamp)),R(m)&&(g.x=d==null?void 0:d.convertToPixel(m)),R(p.value)){var _=v==null?void 0:v.convertToPixel(p.value);g.y=o?h.top+_:_}return g})}}return Ct(e)?l:(r=l[0])!==null&&r!==void 0?r:{}},i.prototype.convertFromPixel=function(e,t){var r,n=t.paneId,a=n===void 0?Y.CANDLE:n,s=t.absolute,o=s===void 0?!1:s,l=[];if(a!==Y.X_AXIS){var u=this.getDrawPaneById(a);if(u!==null){var c=this._chartStore.getTimeScaleStore(),h=u.getBounding(),f=new Array().concat(e),d=this._xAxisPane.getAxisComponent(),v=u.getAxisComponent();l=f.map(function(p){var g,m,_={};if(R(p.x)){var S=(g=d==null?void 0:d.convertFromPixel(p.x))!==null&&g!==void 0?g:-1;_.dataIndex=S,_.timestamp=(m=c.dataIndexToTimestamp(S))!==null&&m!==void 0?m:void 0}if(R(p.y)){var y=o?p.y-h.top:p.y;_.value=v.convertFromPixel(y)}return _})}}return Ct(e)?l:(r=l[0])!==null&&r!==void 0?r:{}},i.prototype.executeAction=function(e,t){var r;switch(e){case _t.OnCrosshairChange:{var n=B({},t);n.paneId=(r=n.paneId)!==null&&r!==void 0?r:Y.CANDLE,this._chartStore.getTooltipStore().setCrosshair(n,{notExecuteAction:!0});break}}},i.prototype.subscribeAction=function(e,t){this._chartStore.getActionStore().subscribe(e,t)},i.prototype.unsubscribeAction=function(e,t){this._chartStore.getActionStore().unsubscribe(e,t)},i.prototype.getConvertPictureUrl=function(e,t,r){var n=this,a=this._chartContainer.clientWidth,s=this._chartContainer.clientHeight,o=Rt("canvas",{width:"".concat(a,"px"),height:"".concat(s,"px"),boxSizing:"border-box"}),l=o.getContext("2d"),u=Yt(o);o.width=a*u,o.height=s*u,l.scale(u,u),l.fillStyle=r??"#FFFFFF",l.fillRect(0,0,a,s);var c=e??!1;return this._drawPanes.forEach(function(h){var f=n._separatorPanes.get(h);if(T(f)){var d=f.getBounding();l.drawImage(f.getImage(c),d.left,d.top,d.width,d.height)}var v=h.getBounding();l.drawImage(h.getImage(c),0,v.top,a,v.height)}),o.toDataURL("image/".concat(t??"jpeg"))},i.prototype.resize=function(){this.adjustPaneViewport(!0,!0,!0,!0,!0)},i.prototype.destroy=function(){this._chartEvent.destroy(),this._drawPanes.forEach(function(e){e.destroy()}),this._drawPanes=[],this._separatorPanes.forEach(function(e){e.destroy()}),this._separatorPanes.clear(),this._container.removeChild(this._chartContainer)},i}(),Te=new Map,vo=1;function fo(i,e){var t;if(O(i)?t=document.getElementById(i):t=i,t===null)return null;var r=Te.get(t.id);if(T(r))return r;var n="k_line_chart_".concat(vo++);return r=new pi(t,e),r.id=n,t.setAttribute("k-line-chart-id",n),Te.set(n,r),r}function po(i){var e,t,r;if(i instanceof pi)r=i.id;else{var n=void 0;O(i)?n=document.getElementById(i):n=i,r=(e=n==null?void 0:n.getAttribute("k-line-chart-id"))!==null&&e!==void 0?e:null}r!==null&&((t=Te.get(r))===null||t===void 0||t.destroy(),Te.delete(r))}function go(i){return De({method:"POST",url:"/klineMarket",data:i})}function mo(i){return De({method:"POST",url:"/lever/submit",data:i})}function _o(){return De({method:"GET",url:"/seconds"})}function yo(i){return De({method:"POST",url:"/MicroOrder/submit",data:i})}const So={class:"times my-2 flex space-between"},xo={key:0,class:"text-center"},bo={key:1,id:"klineChart",style:{height:"300px"}},wo={__name:"KlineChart",props:["symbol"],setup(i){const e=Rr(),t=i,r=pt([{text:"1M",value:"1min",time:1},{text:"5M",value:"5min",time:5},{text:"15M",value:"15min",time:15},{text:"30M",value:"30min",time:30},{text:"1H",value:"60min",time:60},{text:"1D",value:"1day",time:360}]);let n=null;const a=pt({text:"1M",value:"1min",time:1}),s=pt("1M"),o=pt(["1M"]),l=pt(!1),u=pt(!1),c=({selectedValues:d,selectedOptions:v})=>{l.value=!1,a.value.value!==d[0]&&(a.value=r.value.find(p=>p.value===d[0]),o.value=d,s.value=v[0].text)};Cr(()=>{e.on("kline",d=>{const{symbol:v,period:p}=d;d.timestamp=d.time*1e3,v===t.symbol&&p===a.value.value&&n&&n.updateData(d)})}),Ir(()=>{e.off("kline")});function h(){const d=a.value,v={from:Date.parse(new Date)/1e3-d.time*24*60*60,to:Date.parse(new Date)/1e3,symbol:t.symbol,period:d.value};u.value=!0,go(v).then(p=>{if((p==null?void 0:p.type)==="ok"){const g=p.data.map(m=>(m.timestamp=m.time,m))||[];setTimeout(()=>{f();const m=[...new Map(g.map(S=>[S.id,S])).values()],_=m[0];(_==null?void 0:_.open)<10?n.setPriceVolumePrecision(4,4):n.setPriceVolumePrecision(2,2),n.applyNewData(m)},300)}}).finally(()=>{u.value=!1})}we(()=>t.symbol,d=>{if(d&&n){if(s.value===r.value[0].text)return;a.value=r.value[0],s.value=r.value[0].text,o.value=[r.value[0].value]}}),Ei(()=>{h()});function f(){const d=document.getElementById("klineChart");n&&po(n),n=fo(d,{styles:{grid:{show:!1},candle:{bar:{upColor:"#85bd00",downColor:"#f6543e"},tooltip:{custom:[{title:"high",value:"{high}"},{title:"open",value:"{open}"},{title:"low",value:"{low}"}],text:{size:11,marginTop:2,marginBottom:2}}},xAxis:{axisLine:{show:!1},tickText:{marginEnd:1,marginStart:1}},yAxis:{axisLine:{show:!1}}}}),n.setZoomEnabled(!0),n.setOffsetRightDistance(10)}return(d,v)=>{const p=Er,g=Ke,m=Vr,_=Fe,S=Pr;return q(),ht(qt,null,[Z("div",So,[L(g,{onClick:v[0]||(v[0]=y=>l.value=!0),size:"medium",plain:"",type:"primary"},{default:j(()=>[ke(wt(A(s))+" ",1),L(p,{name:"arrow-down"})]),_:1}),L(_,{show:A(l),"onUpdate:show":v[3]||(v[3]=y=>me(l)?l.value=y:null),position:"bottom",round:""},{default:j(()=>[L(m,{columns:A(r),modelValue:A(o),"onUpdate:modelValue":v[1]||(v[1]=y=>me(o)?o.value=y:null),onConfirm:c,onCancel:v[2]||(v[2]=y=>l.value=!1)},null,8,["columns","modelValue"])]),_:1},8,["show"])]),A(u)?(q(),ht("div",xo,[L(S,{size:"24"})])):(q(),ht("div",bo))],64)}}},Co=Ae(wo,[["__scopeId","data-v-e1ecceb4"]]),gi="/h5/assets/success-DDPA-ryG.png",Io={class:"my-4"},Eo={class:"flex"},Po={class:"mr-3 setting"},Mo={class:"mx-4"},To={class:"setting"},Do={class:"mx-4"},Ao={class:"row py-3"},ko={class:"success"},Fo={class:"confirmed"},Ro={__name:"ContractTrade",props:["currency"],setup(i){var f;const e=Mr(),t=i;Object.keys(e.user).length||e.userInfo();const{t:r}=Tr(),n=Xt(()=>[{label:r("trade.trade"),type:1},{label:r("trade.pending_order"),type:2}]),a=pt(""),s=Xt(()=>{var v;return((v=t.currency)==null?void 0:v.multiple).map(p=>(p.text=p.value,p))});let o=Dr({multiple:(f=s[0])==null?void 0:f.value,showMultiple:!1,pickerValue:[],isStopLoss:!1,isStopgap:!1,stop_loss_price:0,target_profit_price:0,number:0,each_piece:100,target_price:0,upLoading:!1,downLoading:!1,show:!1});const l=Xt(()=>{var d;return t.currency?(((d=t.currency)==null?void 0:d.lever_trade_fee)*o.number).toFixed(5):0}),u=Xt(()=>{if(!t.currency)return 0;const{now_price:d,spread:v,lever_share_num:p,each_piece:g}=t.currency;return console.log("margin",t.currency),(d*p*o.number/o.multiple*g).toFixed(5)});we(()=>t.currency,d=>{if(d){const v=d==null?void 0:d.multiple;v.length&&(o.multiple=v[0].value)}}),we(()=>o.isStopgap,d=>{var v;d?o.target_profit_price=(v=t.currency)==null?void 0:v.now_price:o.target_profit_price=0}),we(()=>o.isStopLoss,d=>{var v;d?o.stop_loss_price=(v=t.currency)==null?void 0:v.now_price:o.stop_loss_price=0});const c=({selectedValues:d,selectedOptions:v})=>{var p;o.multiple=(p=v[0])==null?void 0:p.value,o.pickerValue=d,o.showMultiple=!1};function h(d,v){var g;const p={share:o.number,multiple:o.multiple,legal_id:1,currency_id:(g=t.currency)==null?void 0:g.currency_id,type:d,status:v,target_profit_price:o.target_profit_price,stop_loss_price:o.stop_loss_price,target_price:o.target_price};d===1?o.upLoading=!0:o.downLoading=!0,mo(p).then(m=>{m.type==="ok"&&(e.userInfo(),o.show=!0)}).finally(()=>{o.upLoading=!1,o.downLoading=!1})}return(d,v)=>{var M;const p=Br,g=Lr,m=Bi,_=qe,S=zr,y=Vr,x=Fe,w=Ri,b=Ze("i18n-t"),I=kr,C=Nr,P=Or;return q(),ht(qt,null,[L(g,{class:"mt-3",active:A(a),"onUpdate:active":v[0]||(v[0]=E=>me(a)?a.value=E:null)},{default:j(()=>[(q(!0),ht(qt,null,Ce(A(n),E=>(q(),Wt(p,{title:E.label,name:E.type,key:E.name},null,8,["title","name"]))),128))]),_:1},8,["active"]),Z("div",Io,[A(a)===2?(q(),Wt(_,{key:0,border:!1,title:d.$t("trade.price")},{value:j(()=>[L(m,{modelValue:A(o).target_price,"onUpdate:modelValue":v[1]||(v[1]=E=>A(o).target_price=E)},null,8,["modelValue"])]),_:1},8,["title"])):Ar("",!0),L(S,{modelValue:A(o).multiple,"onUpdate:modelValue":v[2]||(v[2]=E=>A(o).multiple=E),"is-link":"",readonly:"",name:"picker",label:d.$t("trade.multiplier"),placeholder:"",border:!1,onClick:v[3]||(v[3]=E=>A(o).showMultiple=!0)},null,8,["modelValue","label"]),L(x,{show:A(o).showMultiple,"onUpdate:show":v[5]||(v[5]=E=>A(o).showMultiple=E),"destroy-on-close":"",position:"bottom"},{default:j(()=>[L(y,{columns:A(s),"model-value":A(o).pickerValue,onConfirm:c,onCancel:v[4]||(v[4]=E=>A(o).showMultiple=!1)},null,8,["columns","model-value"])]),_:1},8,["show"]),Z("div",Eo,[Z("div",Po,[L(_,{center:"",title:d.$t("trade.stop_loss")},{"right-icon":j(()=>[L(w,{size:"20",modelValue:A(o).isStopLoss,"onUpdate:modelValue":v[6]||(v[6]=E=>A(o).isStopLoss=E)},null,8,["modelValue"])]),_:1},8,["title"]),Z("div",Mo,[L(m,{disabled:!A(o).isStopLoss,min:"0",modelValue:A(o).stop_loss_price,"onUpdate:modelValue":v[7]||(v[7]=E=>A(o).stop_loss_price=E)},null,8,["disabled","modelValue"])])]),Z("div",To,[L(_,{center:"",title:d.$t("trade.stop_loss")},{"right-icon":j(()=>[L(w,{size:"20",modelValue:A(o).isStopgap,"onUpdate:modelValue":v[8]||(v[8]=E=>A(o).isStopgap=E)},null,8,["modelValue"])]),_:1},8,["title"]),Z("div",Do,[L(m,{disabled:!A(o).isStopgap,min:"0",modelValue:A(o).target_profit_price,"onUpdate:modelValue":v[9]||(v[9]=E=>A(o).target_profit_price=E)},null,8,["disabled","modelValue"])])])]),L(_,{center:"",title:d.$t("trade.buy_quantity"),border:!1},{"right-icon":j(()=>{var E,D;return[L(m,{step:"0.1",min:(E=t.currency)==null?void 0:E.lever_min_share,max:(D=t.currency)==null?void 0:D.lever_max_share,modelValue:A(o).number,"onUpdate:modelValue":v[10]||(v[10]=k=>A(o).number=k)},null,8,["min","max","modelValue"])]}),_:1},8,["title"]),Z("div",Ao,[L(_,{title:d.$t("trade.each"),border:!1},{value:j(()=>{var E,D;return[ke(wt(d.$t("trade.each"))+"="+wt(A(o).each_piece)+wt((E=t.currency)==null?void 0:E.currency_name)+"/"+wt((D=t.currency)==null?void 0:D.legal_name),1)]}),_:1},8,["title"]),L(_,{border:!1,title:d.$t("trade.estimated_commission"),value:A(l)},null,8,["title","value"]),L(_,{border:!1,title:d.$t("trade.estimated_margin"),value:A(u)},null,8,["title","value"]),L(_,{border:!1,title:d.$t("trade.balance"),value:(M=A(e).user)==null?void 0:M.usdt},null,8,["title","value"])]),L(C,null,{default:j(()=>{var E,D;return[L(I,{class:"btn",type:"primary",block:"",size:"small",disabled:!((E=t.currency)!=null&&E.opening),loading:A(o).upLoading,onClick:v[11]||(v[11]=k=>h(1,1))},{default:j(()=>[L(b,{keypath:"trade.buy_up"})]),_:1},8,["disabled","loading"]),L(I,{class:"btn",type:"danger",block:"",size:"small",disabled:!((D=t.currency)!=null&&D.opening),loading:A(o).downLoading,onClick:v[12]||(v[12]=k=>h(2,1))},{default:j(()=>[L(b,{keypath:"trade.buy_down"})]),_:1},8,["disabled","loading"])]}),_:1}),L(x,{show:A(o).show,"onUpdate:show":v[13]||(v[13]=E=>A(o).show=E),position:"bottom",round:"",closeable:""},{default:j(()=>[Z("div",ko,[L(P,{src:A(gi),width:"80",height:"80"},null,8,["src"])]),Z("p",Fo,[L(b,{keypath:"trade.order_confirmed"})])]),_:1},8,["show"])])],64)}}},Bo=Ae(Ro,[["__scopeId","data-v-2e87b0a6"]]),Lo={class:"ma-4"},Vo={class:"font-md my-4"},Oo={class:"font-md my-4"},No={class:"row py-3 info"},zo={class:"success"},Wo={class:"confirmed"},Xo={__name:"SecondsTrade",props:["currency"],setup(i){const e=Mr(),t=i,r=Dr({secondList:[],seconds:null,number:null,fee:0,show:!1,upLoading:!1,downLoading:!1});Fr(()=>{Object.keys(e.user).length||e.userInfo(),_o().then(o=>{var l,u;if(o.type==="ok"){const c=((l=o.data)==null?void 0:l.data)||[];r.secondList=c,r.fee=((u=o.data)==null?void 0:u.fee)||0,c.length&&(r.seconds=c[0])}})});function n(o){r.seconds=o}const a=Xt(()=>(r.fee/100).toFixed(2));function s(o){var u,c,h;const l={number:r.number,currency_id:(u=t.currency)==null?void 0:u.currency_id,type:o,seconds:(c=r.seconds)==null?void 0:c.seconds,match_id:(h=t.currency)==null?void 0:h.match_id};o===1?r.upLoading=!0:r.downLoading=!0,yo(l).then(f=>{f.type==="ok"?(e.userInfo(),r.show=!0):Pi({type:"danger",message:f.message})}).finally(()=>{r.upLoading=!1,r.downLoading=!1})}return(o,l)=>{var m,_,S;const u=Ze("i18n-t"),c=Ke,h=Nr,f=zr,d=qe,v=kr,p=Or,g=Fe;return q(),ht("div",Lo,[Z("div",Vo,[L(u,{keypath:"trade.opening_time"})]),L(h,null,{default:j(()=>[(q(!0),ht(qt,null,Ce(A(r).secondList,y=>{var x;return q(),Wt(c,{key:y.id,size:"large",type:"primary",plain:y.seconds!==((x=A(r).seconds)==null?void 0:x.seconds),onClick:w=>n(y)},{default:j(()=>[ke(wt(y.seconds)+"S",1)]),_:2},1032,["plain","onClick"])}),128))]),_:1}),Z("div",Oo,[L(u,{keypath:"trade.open_number"}),Z("span",null,"( >= "+wt((m=A(r).seconds)==null?void 0:m.min_amount)+")",1)]),L(f,{modelValue:A(r).number,"onUpdate:modelValue":l[0]||(l[0]=y=>A(r).number=y),class:"row"},null,8,["modelValue"]),Z("div",No,[L(d,{border:!1,title:o.$t("trade.profit_rate"),value:`${(_=A(r).seconds)==null?void 0:_.profit_ratio}%`},null,8,["title","value"]),L(d,{border:!1,title:o.$t("trade.estimated_commission"),value:A(a)},null,8,["title","value"]),L(d,{border:!1,title:o.$t("trade.balance"),value:(S=A(e).user)==null?void 0:S.usdt},null,8,["title","value"])]),L(h,null,{default:j(()=>{var y,x;return[L(v,{class:"btn",type:"primary",block:"",size:"small",disabled:!((y=t.currency)!=null&&y.opening),loading:A(r).upLoading,onClick:l[1]||(l[1]=w=>s(1))},{default:j(()=>[L(u,{keypath:"trade.buy_up"})]),_:1},8,["disabled","loading"]),L(v,{class:"btn",type:"danger",block:"",size:"small",disabled:!((x=t.currency)!=null&&x.opening),loading:A(r).downLoading,onClick:l[2]||(l[2]=w=>s(2))},{default:j(()=>[L(u,{keypath:"trade.buy_down"})]),_:1},8,["disabled","loading"])]}),_:1}),L(g,{show:A(r).show,"onUpdate:show":l[3]||(l[3]=y=>A(r).show=y),position:"bottom",round:"",closeable:""},{default:j(()=>[Z("div",zo,[L(p,{src:A(gi),width:"80",height:"80"},null,8,["src"])]),Z("p",Wo,[L(u,{keypath:"trade.order_confirmed"})])]),_:1},8,["show"])])}}},Yo=Ae(Xo,[["__scopeId","data-v-87fecab5"]]),Ho={class:"main"},Go={key:0,class:"text-center"},$o={key:1,class:"flex space-between mb-1"},Uo={class:"price mr-2 bold"},jo={key:1,class:"percentage mr-2 font-sm"},Zo={class:"chart"},qo={__name:"Index",setup(i){const{t:e}=Tr(),t=Mi(),r=Rr(),n=Xt(()=>[{label:e("order.contract"),comp:Bo,id:"Contract"},{label:e("order.second_contract"),comp:Yo,id:"Seconds"}]),a=pt(null),s=pt([]),o=pt(!1),l=pt(!1),u=Xt(()=>a.value?`${a.value.currency_name}/${a.value.legal_name}`:"");Fr(async()=>{await c();const v=t.query.id;if(console.log("currency_id",v),v){const p=s.value.find(g=>g.currency_id===+v);console.log("defaultCurrency",p),a.value=p}a.value||(a.value=s.value[0])}),Cr(()=>{r.on("daymarket",v=>{var m;const{currency_name:p}=v,g=s.value.findIndex(_=>_.currency_name===p);if(p===((m=a.value)==null?void 0:m.currency_name)&&(a.value={...a.value,...v}),g>=0){const _=s.value[g];s.value[g]={..._,...v}}})}),Ir(()=>{r.off("daymarket")});function c(){return l.value=!0,Ai().then(v=>{(v==null?void 0:v.type)==="ok"&&v.data.forEach(g=>{g.quotation.forEach(_=>{const S={..._,id:_.currency_id,name:_.show_name,opening:_.currency.opening,precision_length:ki(_.now_price)};s.value.push(S)})})}).finally(()=>{l.value=!1})}function h(v){a.value=v,o.value=!1}const f=pt(""),d=Xt(()=>{const v=n.value.find(p=>p.id===f.value);return v==null?void 0:v.comp});return(v,p)=>{var C,P,M,E,D,k,V;const g=Br,m=Lr,_=Pr,S=Er,y=Ze("i18n-t"),x=Ke,w=qe,b=Di,I=Fe;return q(),ht(qt,null,[L(m,{active:A(f),"onUpdate:active":p[0]||(p[0]=F=>me(f)?f.value=F:null)},{default:j(()=>[(q(!0),ht(qt,null,Ce(A(n),F=>(q(),Wt(g,{key:F.label,title:F.label,name:F.id},null,8,["title","name"]))),128))]),_:1},8,["active"]),Z("div",Ho,[A(l)?(q(),ht("div",Go,[L(_,{size:"20"})])):(q(),ht("div",$o,[Z("div",{class:"show-name bold",onClick:p[1]||(p[1]=F=>o.value=!0)},[ke(wt((C=A(a))==null?void 0:C.show_name)+" ",1),L(S,{name:"arrow-down"})]),Z("div",{class:Oe(["trend",{up:A(Se)((P=A(a))==null?void 0:P.change),down:!A(Se)((M=A(a))==null?void 0:M.change)}])},[Z("span",Uo,wt(A(Fi)((E=A(a))==null?void 0:E.now_price,(D=A(a))==null?void 0:D.precision_length)),1),(k=A(a))!=null&&k.opening?(q(),ht("span",jo,wt((V=A(a))==null?void 0:V.change)+"%",1)):(q(),Wt(x,{key:0},{default:j(()=>[L(y,{keypath:"market.closed"})]),_:1}))],2)])),Z("div",Zo,[A(a)?(q(),Wt(Co,{key:0,symbol:A(u)},null,8,["symbol"])):Ar("",!0)]),(q(),Wt(Ti(A(d)),{currency:A(a)},null,8,["currency"])),L(I,{show:A(o),"onUpdate:show":p[2]||(p[2]=F=>me(o)?o.value=F:null),position:"left",style:{width:"60%",height:"100%"}},{default:j(()=>[L(b,null,{default:j(()=>[(q(!0),ht(qt,null,Ce(A(s),F=>(q(),Wt(w,{title:F.show_name,class:Oe({active:F.show_name===A(a).show_name}),onClick:H=>h(F)},{value:j(()=>[Z("span",{class:Oe([{up:A(Se)(F==null?void 0:F.change),down:!A(Se)(F==null?void 0:F.change)}])},wt(F.now_price),3)]),_:2},1032,["title","class","onClick"]))),256))]),_:1})]),_:1},8,["show"])])],64)}}},gs=Ae(qo,[["__scopeId","data-v-06c4ee00"]]);export{gs as default};
