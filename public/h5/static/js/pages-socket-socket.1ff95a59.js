(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-socket-socket"],{"33d1":function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("c7eb")),o=i(a("1da1"));a("e9c4"),a("ace4"),a("d3b7"),a("5cc6"),a("907a"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("986a"),a("1d02"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("b39a"),a("72f7"),a("4ec9"),a("3ca3"),a("ddb0"),a("99af"),a("14d9");var r=i(a("9088")),s=a("d7ac");function l(){}l.GetKLineOption=function(){return{Type:"历史K线图",Windows:[{Index:"MA",Modify:!1,Change:!1,Close:!1},{Index:"VOL",Modify:!1,Change:!1,Close:!1},{Index:"MACD2",Modify:!1,Change:!1,Close:!1}],IsAutoUpdate:!1,IsApiPeriod:!0,IsCorssOnlyDrawKLine:!0,CorssCursorTouchEnd:!0,Border:{Left:1,Right:1,Top:25,Bottom:25},KLine:{Right:0,Period:0,PageSize:30,IsShowTooltip:!1,DrawType:0},KLineTitle:{IsShowName:!1,IsShowSettingInfo:!1},Frame:[{SplitCount:3,IsShowLeftText:!1,SplitType:1,Custom:[{Type:0,Position:"right"}]},{SplitCount:2,IsShowLeftText:!1,SplitType:1},{SplitCount:2,IsShowLeftText:!1}],ExtendChart:[{Name:"KLineTooltip"}]}},l.GetMinuteOption=function(){return{Type:"历史K线图",Windows:[{Index:"EMPTY",Modify:!1,Change:!1,Close:!1,TitleHeight:0},{Index:"VOL",Modify:!1,Change:!1,Close:!1}],IsAutoUpdate:!1,IsApiPeriod:!0,IsCorssOnlyDrawKLine:!0,CorssCursorTouchEnd:!0,Border:{Left:1,Right:1,Top:25,Bottom:25},KLine:{Right:0,Period:4,PageSize:60,IsShowTooltip:!1,DrawType:4},KLineTitle:{IsShowName:!1,IsShowSettingInfo:!1},Frame:[{SplitCount:3,IsShowLeftText:!1,SplitType:1,Custom:[{Type:0,Position:"right"}]},{SplitCount:2,IsShowLeftText:!1,SplitType:1},{SplitCount:2,IsShowLeftText:!1}],ExtendChart:[{Name:"KLineTooltip"}]}},l.GetDepthOption=function(){return{Type:"深度图",EnableZoomUpDown:{},Symbol:"BTCBUSD.bit",IsAutoUpdate:!1,AutoUpdateFrequency:1e4,EnableScrollUpDown:!0,MaxVolRate:1.2,CorssCursorInfo:{HPenType:0,VPenType:1,IsShowTooltip:!0},Listener:{},SplashTitle:"下载数据 ......",Language:"EN",Border:{Left:1,Right:1,Bottom:25,Top:1},Frame:{SplitCount:2,IsShowLeftText:!1,XLineType:3,XSplitCount:2}}};var h={KLINE_ID:1,MINUTE_KLINE_ID:2},u={JSChart:null},c={data:function(){var t={Symbol:"btcusdt.BIT",OriginalSymbol:"btcusdt",ChartWidth:300,ChartHeight:600,KLine:{Option:l.GetKLineOption()},WSUrl:"wss://www.huobi.com/-/s/pro/ws",SocketOpen:!1,LastSubString:null,Update:{EnableLimit:!1,LastUpdateTime:null,Frequency:5e3,Cache:null}};return t},name:"KLineChart",onLoad:function(){},onReady:function(){console.log("[KLineChart::onReady]"),this.$nextTick((function(){}))},onShow:function(){var t=this;uni.getSystemInfo({success:function(e){var a=e.windowWidth,i=e.windowHeight;t.ChartWidth=a,t.ChartHeight=i-130,t.$nextTick((function(){t.InitalHQChart(),t.OnSize(),t.CreateKLineChart(h.KLINE_ID,4)}))}})},onHide:function(){this.SocketOpen&&(uni.closeSocket(),this.SocketOpen=!1),this.ClearChart()},onUnload:function(){this.SocketOpen&&(uni.closeSocket(),this.SocketOpen=!1),this.ClearChart()},methods:{ChangePeriod:function(t){-1==t?u.JSChart.KLineType!=h.MINUTE_KLINE_ID&&(this.ClearChart(),this.CreateKLineChart(h.MINUTE_KLINE_ID,4)):u.JSChart.KLineType==h.KLINE_ID?u.JSChart.ChangePeriod(t):(this.ClearChart(),this.CreateKLineChart(h.KLINE_ID,t))},ChangeSymbol:function(t){this.OriginalSymbol!=t&&(this.OriginalSymbol=t,this.Symbol=t+".BIT",u.JSChart.ChangeSymbol(this.Symbol))},ChangeIndex:function(t,e){u.JSChart.ChangeIndex(t,e)},OnSize:function(){this.OnSize_h5()},OnSize_h5:function(){var t=this.ChartHeight,e=this.ChartWidth,a=this.$refs.kline;a.style.width=e+"px",a.style.height=t+"px",u.JSChart&&u.JSChart.OnSize()},InitalHQChart:function(){r.default.MARKET_SUFFIX_NAME.GetBITDecimal=this.GetBITDecimal;var t=r.default.HQChartStyle.GetStyleConfig(r.default.STYLE_TYPE_ID.BLACK_ID);this.SetHQChartStyle(t),r.default.JSChart.SetStyle(t)},SetHQChartStyle:function(t){t.BGColor="rgb(14,24,46)",t.TooltipPaint.BGColor="rgba(14,24,46,0.8)",t.FrameTitleBGColor="rgb(14,24,46)",t.FrameSplitTextColor="rgb(101,117,138)",t.UpBarColor="rgb(37,175,142)",t.UpTextColor=t.UpBarColor,t.DownBarColor="rgb(210,73,99)",t.DownTextColor=t.DownBarColor,t.UnchagneBarColor=t.UpBarColor,t.UnchagneTextColor=t.UpBarColor,t.Index.LineColor[0]="rgb(88,106,126)",t.Index.LineColor[1]="rgb(222,217,167)",t.Index.LineColor[2]="rgb(113,161,164)",t.FrameLatestPrice.UpBarColor="rgb(37,175,142)",t.FrameLatestPrice.DownBarColor="rgb(210,73,99)",t.FrameLatestPrice.UnchagneBarColor=t.FrameLatestPrice.UpBarColor,t.Frame.XBottomOffset=2},GetBITDecimal:function(t){t.toLowerCase();return 2},ClearChart:function(){u.JSChart&&(u.JSChart.ChartDestory(),u.JSChart=null);var t=document.getElementById("kline");while(t.hasChildNodes())t.removeChild(t.lastChild)},CreateKLineChart_h5:function(t,e){if(!u.JSChart){this.KLine.Option.Symbol=this.Symbol;var a=r.default.JSChart.Init(this.$refs.kline);t==h.MINUTE_KLINE_ID?this.KLine.Option=l.GetMinuteOption():(t=h.KLINE_ID,this.KLine.Option=l.GetKLineOption()),this.KLine.Option.NetworkFilter=this.NetworkFilter,this.KLine.Option.Symbol=this.Symbol,this.KLine.Option.KLine.Period=e,a.SetOption(this.KLine.Option),u.JSChart=a,u.JSChart.KLineType=t}},CreateKLineChart_app:function(t,e){var a=this;if(!u.JSChart){var i=new JSCommon.JSCanvasElement;i.ID="kline2",i.Height=this.ChartHeight,i.Width=this.ChartWidth,u.JSChart=JSCommon.JSChart.Init(i),t==h.MINUTE_KLINE_ID?this.KLine.Option=l.GetMinuteOption():(t=h.KLINE_ID,this.KLine.Option=l.GetKLineOption()),this.KLine.Option.NetworkFilter=function(t,e){a.NetworkFilter(t,e)},this.KLine.Option.Symbol=this.Symbol,this.KLine.Option.IsClickShowCorssCursor=!0,this.KLine.Option.IsFullDraw=!0,this.KLine.Option.KLine.Period=e,u.JSChart.SetOption(this.KLine.Option),u.JSChart.KLineType=t}},CreateKLineChart:function(t,e){this.Update.Cache=null,this.CreateKLineChart_h5(t,e)},CreateDepthChart:function(){this.Update.Cache=null,this.CreateDepthChart_h5()},CreateDepthChart_h5:function(){if(!u.JSChart){var t=r.default.JSChart.Init(this.$refs.kline),e=l.GetDepthOption();e.Symbol=this.Symbol,e.NetworkFilter=this.NetworkFilter,t.SetOption(e),u.JSChart=t}},CreateDepthChart_app:function(){if(!u.JSChart){var t=new JSCommon.JSCanvasElement;t.ID="kline2",t.Height=this.ChartHeight,t.Width=this.ChartWidth;var e=JSCommon.JSChart.Init(t),a=l.GetDepthOption();a.Symbol=this.Symbol,a.IsFullDraw=!0,a.NetworkFilter=this.NetworkFilter,e.SetOption(a),u.JSChart=e}},ChangeDepthChart:function(){u.JSChart&&"DepthChartContainer"==u.JSChart.JSChartContainer.ClassName||(this.ClearChart(),this.CreateDepthChart())},NetworkFilter:function(t,e){switch(console.log("[KLineChart::NetworkFilter] data",t),t.Name){case"KLineChartContainer::ReqeustHistoryMinuteData":this.RequestHistoryMinuteData(t,e);break;case"KLineChartContainer::RequestFlowCapitalData":this.RequestFlowCapitalData(t,e);break;case"KLineChartContainer::RequestHistoryData":this.RequestHistoryData(t,e);break;case"DepthChartContainer::RequestDepthData":this.RequestDepthData(t,e);break}},SendWSHeartMessage:function(){if(this.SocketOpen){var t={pong:(new Date).getTime()},e=JSON.stringify(t);uni.sendSocketMessage({data:e})}},SendUnSubscribeMessage:function(){if(this.LastSubString&&this.SocketOpen){var t=JSON.stringify({unsub:this.LastSubString});uni.sendSocketMessage({data:t}),this.LastSubString=null}},RequestWSData:function(t,e){var a=this;if(this.SocketOpen){this.SendUnSubscribeMessage();var i=JSON.stringify(t.SendData);uni.sendSocketMessage({data:i}),t.SendData.sub&&(this.LastSubString=t.SendData.sub)}else uni.connectSocket({url:this.WSUrl}),uni.onSocketOpen((function(e){a.SocketOpen=!0,console.log(e);var i=JSON.stringify(t.SendData);uni.sendSocketMessage({data:i}),t.SendData.sub&&(a.LastSubString=t.SendData.sub)}));uni.onSocketMessage((function(i){var n=new Uint8Array(i.data),o=s.inflate(n,{to:"string"}),r=JSON.parse(o);r.ping?a.SendWSHeartMessage():r.unsubbed||r.subbed||e(r,t)})),uni.onSocketError((function(t){console.log(t)}))},GeneratePostData:function(t,e){var a=new Map([[4,"1min"],[5,"5min"],[6,"15min"],[0,"1day"],[1,"1week"],[2,"1mon"]]),i=a.get(e),n={req:"market.".concat(t,".kline.").concat(i),symbol:t,period:i},o={sub:"market.".concat(t,".kline.").concat(i),symbol:t,period:i};return{Req:n,Sub:o}},RequestHistoryMinuteData:function(t,e){t.PreventDefault=!0,this.Update.Cache=null;var a=t.Request.Data.symbol,i=t.Self.Period,n=this.GeneratePostData(this.OriginalSymbol,i),o={SendData:n.Req,Symbol:a,OriginalSymbol:this.OriginalSymbol,Period:i,Callback:e};this.RecvHistoryMinuteData({},o)},RecvHistoryMinuteData:function(t,e){var a=this;return(0,o.default)((0,n.default)().mark((function t(){var i,o,r,s,l,h,u,c,d;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={code:0,data:[]},i.symbol=e.Symbol,i.name=e.OriginalSymbol,t.next=5,a.$H.post("/api/v1/klineMarket",!0,{symbol:"BTC/USDT",period:"1min",from:1692837557,to:1692884378});case 5:if(o=t.sent,o.data.data.data)for(s in r=null,o.data.data.data)l=o.data.data.data[s],console.log(s),h=new Date,h.setTime(l.time),u=1e4*h.getFullYear()+100*(h.getMonth()+1)+h.getDate(),c=100*h.getHours()+h.getMinutes(),d=[u,r,l.open,l.high,l.low,l.close,l.amount,null,c],r=l.close,i.data.push(d);e.Callback(i),a.SubscribeMinuteRealtimeData(e);case 9:case"end":return t.stop()}}),t)})))()},SubscribeMinuteRealtimeData:function(t){var e=this,a=this.GeneratePostData(t.OriginalSymbol,t.Period),i={SendData:a.Sub,Symbol:t.Symbol,OriginalSymbol:t.OriginalSymbol,Period:t.Period};this.RequestWSData(i,(function(t,a){e.RecvMinuteRealtimeData(t,a)}))},RecvMinuteRealtimeData:function(t,e){if(console.log("___________________________"),t.ch==e.SendData.sub&&u.JSChart){console.log("+++++++++++++++++++++++++++++++++++");var a=u.JSChart.JSChartContainer;a.Period;console.log("&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&");var i={code:0,data:[],ver:2};i.symbol=e.Symbol,i.name=e.OriginalSymbol;var n=t.tick;console.log("**********recvData********************"),console.log(n),console.log(t.tick),console.log("**********recvData********************");var o=new Date;o.setTime(1e3*n.id);var r=1e4*o.getFullYear()+100*(o.getMonth()+1)+o.getDate(),s=100*o.getHours()+o.getMinutes(),l=[r,null,n.open,n.high,n.low,n.close,n.amount,null,s];if(this.Update.EnableLimit){if(this.Update.Cache){var h=this.Update.Cache;n=h.Data[h.Data.length-1];n[0]==l[0]&&n[8]==l[8]?h.Data[h.Data.length-1]=l:h.Data.push(l)}else this.Update.Cache={Data:[l]};var c=!0;if(this.Update.LastUpdateTime){var d=Date.now();d-this.Update.LastUpdateTime<this.Update.Frequency&&(c=!1)}if(!c)return;i.data=this.Update.Cache.Data,this.Update.Cache=null,this.Update.LastUpdateTime=Date.now()}else console.log("**********newItem********************"),console.log(l),console.log("**********newItem********************"),i.data.push(l);a.RecvMinuteRealtimeData(i)}},RequestHistoryData:function(t,e){var a=this;t.PreventDefault=!0,this.Update.Cache=null;var i=t.Request.Data.symbol,n=t.Self.Period,o=this.GeneratePostData(this.OriginalSymbol,n),r={SendData:o.Req,Symbol:i,OriginalSymbol:this.OriginalSymbol,Period:n,Callback:e};this.RequestWSData(r,(function(t,e){a.RecvHistoryData(t,e)}))},RecvHistoryData:function(t,e){if(t.rep==e.SendData.req){var a={code:0,data:[]};if(a.symbol=e.Symbol,a.name=e.OriginalSymbol,t.data){var i=null;for(var n in t.data){var o=t.data[n],r=new Date;r.setTime(1e3*o.id);var s=1e4*r.getFullYear()+100*(r.getMonth()+1)+r.getDate(),l=(r.getHours(),r.getMinutes(),[s,i,o.open,o.high,o.low,o.close,o.amount,null]);i=o.close,a.data.push(l)}}e.Callback(a),this.SubscribRealtimeData(e)}},SubscribRealtimeData:function(t){var e=this,a=this.GeneratePostData(t.OriginalSymbol,t.Period),i={SendData:a.Sub,Symbol:t.Symbol,OriginalSymbol:t.OriginalSymbol,Period:t.Period};this.RequestWSData(i,(function(t,a){e.RecvRealtimeData(t,a)}))},RecvRealtimeData:function(t,e){if(t.ch==e.SendData.sub&&u.JSChart){var a=u.JSChart.JSChartContainer,i=a.Period,n=a.Symbol;if(n==e.Symbol&&i==e.Period){var o={code:0,stock:[]};if(this.Update.EnableLimit){var r=Date.now();if(this.Update.LastUpdateTime&&r-this.Update.LastUpdateTime<this.Update.Frequency)return;this.Update.LastUpdateTime=r}var s={symbol:e.Symbol,name:e.OriginalSymbol},l=t.tick,h=new Date;h.setTime(1e3*l.id);var c=1e4*h.getFullYear()+100*(h.getMonth()+1)+h.getDate();h.getHours(),h.getMinutes();s.date=c,s.yclose=null,s.open=l.open,s.high=l.high,s.low=l.low,s.price=l.close,s.vol=l.amount,s.amount=null,o.stock.push(s),a.RecvRealtimeData(o)}}},GeneratePostDepthData:function(t,e){var a={sub:"market.".concat(t,".depth.").concat(e),symbol:t};return{Req:{},Sub:a}},RequestDepthData:function(t,e){var a=this;t.PreventDefault=!0,this.Update.Cache=null;var i=t.Request.Data.symbol,n=(t.Self.Period,this.GeneratePostDepthData(this.OriginalSymbol,"step1")),o={SendData:n.Sub,Symbol:i,OriginalSymbol:this.OriginalSymbol,Callback:e};this.RequestWSData(o,(function(t,e){a.RecvDepthData(t,e)}))},RecvDepthData:function(t,e){if(t.ch==e.SendData.sub&&u.JSChart){var a=u.JSChart.JSChartContainer,i=a.Symbol;if(i==e.Symbol&&"DepthChartContainer"==a.ClassName){var n=t.tick,o=[],r=[];if(n.asks)for(var s=0;s<n.asks.length;++s){var l=n.asks[s];o.push([l[0],l[1]])}if(n.bids)for(s=0;s<n.bids.length;++s){l=n.bids[s];r.push([l[0],l[1]])}var h={code:0,asks:o,bids:r,datatype:"snapshot"};a.ChartSplashPaint.EnableSplash(!1),a.RecvDepthData(h)}}},KLineTouchStart:function(t){u.JSChart&&u.JSChart.OnTouchStart(t)},KLineTouchMove:function(t){u.JSChart&&u.JSChart.OnTouchMove(t)},KLineTouchEnd:function(t){u.JSChart&&u.JSChart.OnTouchEnd(t)}}};e.default=c},"550a":function(t,e,a){"use strict";a.r(e);var i=a("33d1"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},"816b":function(t,e,a){"use strict";a.r(e);var i=a("8e09"),n=a("550a");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);var r=a("f0c5"),s=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"1883c4dc",null,!1,i["a"],void 0);e["default"]=s.exports},"8e09":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"divchart",staticStyle:{"background-color":"#0e182e"}},[a("div",[a("div",{ref:"kline",staticClass:"kline",attrs:{id:"kline"}})]),a("div",{staticClass:"button-sp-area"},[a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangePeriod(-1)}}},[t._v("分时")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangePeriod(0)}}},[t._v("日线")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangePeriod(1)}}},[t._v("周线")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangePeriod(4)}}},[t._v("1分钟")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangePeriod(6)}}},[t._v("15分钟")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangeDepthChart()}}},[t._v("深度图")])],1),a("div",{staticClass:"button-sp-area"},[a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangeSymbol("btcusdt")}}},[t._v("btcusdt")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangeSymbol("ethusdt")}}},[t._v("ethusdt")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangeIndex(0,"EMPTY")}}},[t._v("EMPTY")]),a("v-uni-button",{staticClass:"mini-btn",attrs:{type:"default",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChangeIndex(1,"MACD")}}},[t._v("MACD")])],1)])},n=[]}}]);